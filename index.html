<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="description"
    content="NERIST One – Smart Campus Operating System  ⚛︎  dashboard for students, mess secretary, and administrators." />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <title>NERIST One – Smart Campus OS ⚛︎</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

  <!-- ===== LEAFLET CSS ===== -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

  <!-- ===== LEAFLET JS ===== -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <style>
    /* ===== CSS VARIABLES FOR THEMES ===== */
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #22d3ee;
      --secondary-dark: #06b6d4;
      --dark: #0f172a;
      --darker: #020617;
      --light: #f1f5f9;
      --gray: #94a3b8;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --card-bg: rgba(255, 255, 255, 0.08);
      --card-border: rgba(255, 255, 255, 0.1);
      --nerist-green: #6366f1;
      --nerist-light-green: #8b5cf6;
      --accent-1: #8b5cf6;
      --accent-2: #ec4899;
      --accent-3: #f97316;
      /* Add these new variables for logo size */
      --logo-size: 70px;
      /* Change this value as you wish */
      --logo-font-size: 28px;
      /* Change this value as you wish */
      --logo-margin-bottom: 15px;
      /* Change this value as you wish */
    }

    body.light-theme {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      --dark: #f8fafc;
      --darker: #e2e8f0;
      --light: #1e293b;
      --gray: #64748b;
      --card-bg: rgba(255, 255, 255, 0.9);
      --card-border: rgba(0, 0, 0, 0.1);
    }

    /* ===== HIDE CONTENT UNTIL LOGGED IN ===== */
    body:not(.logged-in) #navbar,
    body:not(.logged-in) section,
    body:not(.logged-in) footer {
      display: none !important;
    }

    body.logged-in .login-page {
      display: none !important;
    }

    /* ===== PREMIUM LOGIN PAGE - REDESIGNED ===== */
    .login-page {
      position: relative;
      /* Changed from fixed */
      min-height: 100vh;
      /* Changed from height: 100% */
      background: #fafafa;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body.light-theme .login-page {
      background: #ffffff;
    }

    .login-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, #fafafa 0%, #f0f0f0 100%);
      z-index: -1;
    }

    .login-wrapper {
      display: flex;
      flex: 1;
      min-height: 100vh;
      /* Ensure it takes full viewport height */
      padding: 40px 20px;
      max-width: 1400px;
      margin: 0 auto;
      align-items: center;
      justify-content: center;
      gap: 60px;
      position: relative;
      overflow: visible;
      /* Changed to visible */
    }

    /* Left side: Form container */
    .login-form-container {
      flex: 0 1 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: slideInLeft 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
    }

    .login-form-card {
      width: 100%;
      background: #ffffff;
      border: 1px solid rgba(219, 219, 219, 0.8);
      border-radius: 20px;
      padding: 45px 40px 35px;
      margin-bottom: 15px;
      box-shadow:
        0 10px 30px rgba(0, 0, 0, 0.05),
        0 1px 2px rgba(0, 0, 0, 0.02);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .login-form-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .login-form-card:hover::before {
      transform: scaleX(1);
    }

    .login-form-card:hover {
      transform: translateY(-5px);
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.08),
        0 8px 16px rgba(0, 0, 0, 0.04);
      border-color: rgba(99, 102, 241, 0.3);
    }

    .login-brand {
      text-align: center;
      margin-bottom: 35px;
      animation: fadeInUp 0.6s ease 0.3s both;
    }

    .logo-circle {
      width: 85px;
      height: 85px;
      margin: 0 auto 20px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 34px;
      box-shadow:
        0 15px 35px rgba(99, 102, 241, 0.25),
        0 5px 15px rgba(99, 102, 241, 0.1);
      animation:
        logoFloat 6s ease-in-out infinite,
        pulse 2s ease-in-out infinite;
      position: relative;
    }

    .logo-circle::after {
      content: '';
      position: absolute;
      top: -8px;
      /* Changed from -10px */
      left: -8px;
      /* Changed from -10px */
      right: -8px;
      /* Changed from -10px */
      bottom: -8px;
      /* Changed from -10px */
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      opacity: 0.1;
      animation: pulseRing 2s ease-in-out infinite;
    }

    @keyframes logoFloat {

      0%,
      100% {
        transform: translateY(0) rotate(0deg);
      }

      33% {
        transform: translateY(-10px) rotate(5deg);
      }

      66% {
        transform: translateY(5px) rotate(-5deg);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }
    }

    @keyframes pulseRing {
      0% {
        transform: scale(0.8);
        opacity: 0.1;
      }

      100% {
        transform: scale(1.3);
        opacity: 0;
      }
    }

    .login-brand h1 {
      font-size: 2.2rem;
      /* Changed from 2.5rem */
      font-weight: 800;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      position: relative;
    }

    .login-tagline {
      color: #8e8e8e;
      font-size: 1rem;
      /* Changed from 1.1rem */
      font-weight: 400;
      letter-spacing: 0.3px;
      opacity: 0.8;
    }

    /* ===== PREMIUM INPUT FIELDS - REDESIGNED ===== */
    .input-group {
      margin-bottom: 30px;
      animation: fadeInUp 0.6s ease var(--delay) both;
      position: relative;
    }

    .input-field {
      position: relative;
      width: 100%;
      isolation: isolate;
    }

    /* Premium Text Input */
    .login-input {
      width: 100%;
      padding: 22px 20px 12px;
      background: #ffffff;
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      font-size: 16px;
      color: #1f2937;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      outline: none;
      font-weight: 500;
      letter-spacing: 0.2px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
      position: relative;
      z-index: 2;
    }

    .login-input:focus {
      border-color: transparent;
      background: #ffffff;
      box-shadow:
        0 8px 32px rgba(99, 102, 241, 0.15),
        0 0 0 1px rgba(99, 102, 241, 0.2),
        inset 0 2px 4px rgba(255, 255, 255, 0.8);
      transform: translateY(-4px);
      padding-left: 22px;
      letter-spacing: 0.3px;
    }

    .login-input:focus+.floating-label,
    .login-input:not(:placeholder-shown)+.floating-label {
      transform: translateY(-38px) scale(0.85);
      color: var(--primary);
      font-weight: 600;
      letter-spacing: 0.5px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      padding: 0 10px;
      left: 10px;
    }

    /* Premium Floating Label */
    .floating-label {
      position: fixed;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: #6b7280;
      font-size: 18px;
      pointer-events: none;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      background: #ffffff;
      padding: 0 8px;
      border-radius: 8px;
      font-weight: 500;
      z-index: 3;
      letter-spacing: 0.2px;
    }

    /* Premium Border Animation */
    .input-border {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 16px;
      overflow: hidden;
      pointer-events: none;
      z-index: 1;
    }

    .input-border::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(135deg,
          var(--primary) 0%,
          var(--secondary) 25%,
          #8b5cf6 50%,
          var(--secondary) 75%,
          var(--primary) 100%);
      border-radius: 18px;
      opacity: 0;
      transition: opacity 0.4s ease;
      z-index: -1;
      background-size: 300% 300%;
      animation: gradientShift 3s ease infinite;
    }

    .login-input:focus~.input-border::before {
      opacity: 1;
    }

    /* Premium Underline Effect */
    .input-underline {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 3px 3px 0 0;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      filter: drop-shadow(0 2px 4px rgba(99, 102, 241, 0.4));
    }

    .login-input:focus~.input-underline {
      width: calc(100% - 40px);
    }

    /* Premium Icon */
    .input-icon {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      font-size: 18px;
      transition: all 0.3s ease;
      z-index: 3;
    }

    .login-input:focus~.input-icon {
      color: var(--primary);
      transform: translateY(-50%) scale(1.1);
    }

    /* Hover Effects */
    .login-input:hover {
      border-color: #d1d5db;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.06);
    }

    .login-input:hover~.floating-label {
      color: #4b5563;
    }

    /* Success State */
    .login-input.success {
      border-color: #10b981;
    }

    .login-input.success~.input-icon {
      color: #10b981;
    }

    .login-input.success~.input-underline {
      background: linear-gradient(90deg, #10b981, #34d399);
    }

    /* Error State */
    .login-input.error {
      border-color: #ef4444;
      animation: shake 0.5s ease;
    }

    .login-input.error~.input-icon {
      color: #ef4444;
      animation: shake 0.5s ease;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-5px);
      }

      75% {
        transform: translateX(5px);
      }
    }

    /* Placeholder Styling */
    .login-input::placeholder {
      color: transparent;
    }

    .login-input:focus::placeholder {
      color: #9ca3af;
      opacity: 0.7;
    }

    /* Focus Helper Text */
    .focus-helper {
      position: absolute;
      bottom: -22px;
      left: 20px;
      font-size: 12px;
      color: #6b7280;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .login-input:focus~.focus-helper {
      opacity: 1;
      transform: translateY(0);
    }

    /* Select dropdown with enhanced styling */
    .login-select {
      width: 100%;
      padding: 16px 15px;
      background: #fafafa;
      border: 1.5px solid #dbdbdb;
      border-radius: 10px;
      font-size: 15px;
      color: #262626;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%238e8e8e'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 15px center;
      background-size: 18px;
      cursor: pointer;
      outline: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 400;
    }

    .login-select:focus {
      border-color: var(--primary);
      background-color: #ffffff;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      transform: translateY(-2px);
    }

    .login-select option {
      background: white;
      color: #262626;
      padding: 12px;
      font-size: 15px;
    }

    /* Login button with premium animation */
    .login-button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 15px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.6s ease 0.8s both;
    }

    .login-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.6s ease;
    }

    .login-button:hover::before {
      left: 100%;
    }

    .login-button:hover {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      transform: translateY(-3px);
      box-shadow:
        0 15px 30px rgba(99, 102, 241, 0.25),
        0 5px 15px rgba(99, 102, 241, 0.1);
    }

    .login-button:active {
      transform: translateY(-1px);
    }

    /* Divider */
    .divider {
      display: flex;
      align-items: center;
      margin: 25px 0;
      color: #8e8e8e;
      font-size: 14px;
      font-weight: 600;
      animation: fadeIn 0.6s ease 0.9s both;
    }

    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #dbdbdb;
      transition: all 0.3s ease;
    }

    .divider:hover::before,
    .divider:hover::after {
      background: var(--primary);
    }

    .divider span {
      padding: 0 20px;
      background: #ffffff;
      border-radius: 20px;
      z-index: 1;
    }

    /* Demo login button */
    .demo-login-button {
      width: 100%;
      padding: 15px;
      background: transparent;
      color: var(--primary);
      border: 1.5px solid #dbdbdb;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      animation: fadeInUp 0.6s ease 1s both;
    }

    .demo-login-button:hover {
      background: rgba(99, 102, 241, 0.05);
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    /* Links */
    .login-links {
      text-align: center;
      margin-top: 25px;
      animation: fadeIn 0.6s ease 1.1s both;
    }

    .forgot-link {
      color: var(--primary);
      font-size: 14px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s ease;
      position: relative;
    }

    .forgot-link::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1px;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    .forgot-link:hover::after {
      width: 100%;
    }

    /* Signup prompt */
    .signup-prompt {
      width: 100%;
      background: #ffffff;
      border: 1px solid rgba(219, 219, 219, 0.8);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      margin-bottom: 15px;
      font-size: 14px;
      animation: fadeIn 0.6s ease 1.2s both;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.02);
      /* Add explicit text color */
      color: #262626;
    }

    /* Dark theme adjustments for signup prompt */
    body:not(.light-theme) .signup-prompt {
      background: rgba(15, 23, 42, 0.9);
      /* Dark background */
      border-color: rgba(255, 255, 255, 0.1);
      color: #f1f5f9;
      /* Light text for dark mode */
    }

    .signup-link {
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s ease;
      position: relative;
    }

    .signup-link::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1.5px;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    .signup-link:hover::after {
      width: 100%;
    }

    /* Dark mode adjustment for better visibility */
    body:not(.light-theme) .signup-link {
      color: var(--secondary);
      /* Brighter color in dark mode */
    }

    /* App links */
    .app-links {
      text-align: center;
      margin-top: 10px;
      animation: fadeIn 0.6s ease 1.3s both;
    }

    .app-links p {
      font-size: 14px;
      color: #262626;
      margin-bottom: 15px;
      opacity: 0.8;
    }

    .app-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .app-button {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      background: #f5f5f5;
      border: 1px solid #dbdbdb;
      border-radius: 10px;
      text-decoration: none;
      color: #262626;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .app-button:hover {
      background: #f0f0f0;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      border-color: var(--primary);
    }

    .app-button i {
      font-size: 16px;
    }

    /* Right side: Preview */
    .login-preview {
      flex: 0 1 500px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      animation: slideInRight 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.4s both;
    }

    .preview-content {
      position: relative;
      max-width: 500px;
      width: 100%;
    }

    .preview-phone {
      position: relative;
      width: 300px;
      height: 600px;
      margin: 0 auto 40px;
      animation:
        floatPhone 8s ease-in-out infinite,
        fadeInUp 0.8s ease 0.5s both;
    }

    @keyframes floatPhone {

      0%,
      100% {
        transform: translateY(0) rotate(0deg);
      }

      25% {
        transform: translateY(-15px) rotate(2deg);
      }

      50% {
        transform: translateY(0) rotate(0deg);
      }

      75% {
        transform: translateY(10px) rotate(-2deg);
      }
    }

    .phone-frame {
      position: relative;
      width: 100%;
      height: 100%;
      background: #ffffff;
      border-radius: 45px;
      box-shadow:
        0 30px 60px -12px rgba(0, 0, 0, 0.2),
        0 0 0 12px #262626,
        0 0 0 13px #e0e0e0,
        inset 0 0 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .phone-frame:hover {
      transform: perspective(1000px) rotateY(5deg) rotateX(2deg);
      box-shadow:
        0 40px 80px -20px rgba(0, 0, 0, 0.3),
        0 0 0 12px #262626,
        0 0 0 13px #e0e0e0,
        inset 0 0 30px rgba(0, 0, 0, 0.15);
    }

    .phone-notch {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 180px;
      height: 25px;
      background: #262626;
      border-radius: 0 0 20px 20px;
      z-index: 2;
      box-shadow: inset 0 -2px 5px rgba(0, 0, 0, 0.3);
    }

    .phone-screen {
      position: absolute;
      top: 30px;
      left: 12px;
      right: 12px;
      bottom: 12px;
      background: linear-gradient(135deg, var(--darker) 0%, #1e1b4b 100%);
      border-radius: 33px;
      overflow: hidden;
      padding: 30px 25px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .screen-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 30px;
      animation: screenContentFade 1s ease 0.8s both;
    }

    @keyframes screenContentFade {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .dashboard-preview {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .preview-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
      animation: slideInLeft 0.6s ease 1s both;
    }

    .preview-header i {
      font-size: 36px;
      color: var(--secondary);
      filter: drop-shadow(0 0 10px rgba(34, 211, 238, 0.5));
    }

    .preview-header h3 {
      color: white;
      font-size: 26px;
      font-weight: 700;
      margin: 0;
      background: linear-gradient(135deg, white, var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .preview-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      border-radius: 25px;
      padding: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: fadeInUp 0.6s ease 1.2s both;
      box-shadow:
        0 10px 30px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .preview-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 18px;
      color: white;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      animation: previewItemSlide 0.5s ease var(--delay, 1.4s) both;
    }

    @keyframes previewItemSlide {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .preview-item:nth-child(1) {
      --delay: 1.4s;
    }

    .preview-item:nth-child(2) {
      --delay: 1.5s;
    }

    .preview-item:nth-child(3) {
      --delay: 1.6s;
    }

    .preview-item:last-child {
      border-bottom: none;
    }

    .preview-item:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateX(8px);
      border-radius: 12px;
    }

    .preview-item i {
      font-size: 22px;
      color: var(--secondary);
      width: 24px;
      transition: all 0.3s ease;
    }

    .preview-item:hover i {
      transform: scale(1.2) rotate(10deg);
    }

    .preview-item span {
      font-size: 17px;
      font-weight: 500;
      letter-spacing: 0.3px;
    }

    .preview-text {
      text-align: center;
      animation: fadeInUp 0.8s ease 1.8s both;
    }

    .preview-text h2 {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 15px;
      color: #262626;
      line-height: 1.3;
      background: linear-gradient(135deg, #262626, #4f46e5);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .preview-text p {
      color: #8e8e8e;
      font-size: 17px;
      font-weight: 400;
      line-height: 1.5;
    }

    /* Global footer */
    .login-footer-global {
      text-align: center;
      padding: 25px;
      color: #8e8e8e;
      font-size: 13px;
      border-top: 1px solid rgba(219, 219, 219, 0.5);
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      width: 100%;
      animation: fadeIn 0.6s ease 2s both;
    }

    /* Dark theme adjustments */
    body.light-theme .login-form-card,
    body.light-theme .signup-prompt,
    body.light-theme .app-button {
      background: #f8fafc;
      border-color: rgba(226, 232, 240, 0.8);
    }

    body.light-theme .login-input,
    body.light-theme .login-select,
    body.light-theme .demo-login-button {
      background: #ffffff;
      border-color: #cbd5e1;
    }

    body.light-theme .preview-text h2 {
      background: linear-gradient(135deg, #1e293b, #4f46e5);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    body.light-theme .preview-text p {
      color: #64748b;
    }

    /* Responsive adjustments */
    @media (max-width: 1200px) {
      .login-wrapper {
        gap: 40px;
      }

      .preview-phone {
        width: 280px;
        height: 560px;
      }

      .phone-frame {
        border-radius: 40px;
      }
    }

    @media (max-width: 1024px) {
      .login-wrapper {
        gap: 30px;
        padding: 40px 20px;
      }

      .preview-phone {
        width: 250px;
        height: 500px;
      }

      .phone-frame {
        border-radius: 35px;
      }
    }

    @media (max-width: 900px) {
      .login-wrapper {
        flex-direction: column;
        gap: 40px;
        /* Reduced from 50px */
        padding: 30px 20px;
        /* Added more padding */
        min-height: auto;
        /* Let it adjust naturally */
      }

      .login-form-container {
        flex: 0 1 auto;
        max-width: 450px;
        width: 100%;
      }

      .login-preview {
        flex: 0 1 auto;
        max-width: 500px;
        width: 100%;
      }

      .preview-phone {
        width: 280px;
        height: 560px;
      }
    }

    @media (max-width: 480px) {
      .login-wrapper {
        padding: 20px 15px;
        /* Added more padding */
        gap: 30px;
        /* Reduced gap */
      }

      .login-form-card {
        padding: 25px 20px;
        /* Reduced padding */
      }

      .preview-phone {
        width: 200px;
        /* Smaller phone */
        height: 400px;
        margin-bottom: 20px;
      }

      .phone-frame {
        border-radius: 25px;
        /* Smaller radius */
      }

      .phone-screen {
        top: 20px;
        left: 10px;
        right: 10px;
        bottom: 10px;
        padding: 20px 15px;
      }
    }

    @media (max-width: 768px) {
      .login-wrapper {
        padding: 30px 20px;
      }

      .login-form-card {
        padding: 35px 30px 25px;
        border: none;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
      }

      .preview-phone {
        width: 250px;
        height: 500px;
      }

      .preview-text h2 {
        font-size: 28px;
      }

      .preview-text p {
        font-size: 15px;
      }
    }

    @media (max-width: 480px) {
      .login-wrapper {
        padding: 20px 15px;
        gap: 30px;
      }

      .login-form-card {
        padding: 25px 20px 20px;
      }

      .logo-circle {
        width: 65px;
        height: 65px;
        font-size: 26px;
        margin-bottom: 15px;
      }

      .login-brand h1 {
        font-size: 1.8rem;
        /* Reduced from 2.2rem */
        line-height: 1.2;
        margin-bottom: 6px;
      }

      .login-tagline {
        font-size: 0.9rem;
        /* Reduced from 1rem */
      }

      /* Phone preview adjustments */
      .preview-phone {
        width: 200px;
        /* Slightly smaller */
        height: 420px;
        /* Adjusted height */
        margin-bottom: 25px;
      }

      .phone-frame {
        border-radius: 28px;
      }

      .phone-screen {
        padding: 18px 15px;
        /* Reduced padding */
        top: 18px;
        left: 10px;
        right: 10px;
        bottom: 10px;
        border-radius: 24px;
      }

      .preview-header {
        gap: 12px;
        margin-bottom: 5px;
      }

      .preview-header i {
        font-size: 26px;
        /* Reduced from 30px */
      }

      .preview-header h3 {
        font-size: 19px;
        /* Reduced from 22px */
        line-height: 1.2;
      }

      .preview-card {
        padding: 20px 15px;
        /* Reduced padding */
      }

      .preview-item {
        padding: 12px 10px;
        /* Reduced padding */
        gap: 12px;
      }

      .preview-item i {
        font-size: 18px;
        /* Reduced from 22px */
        min-width: 20px;
        /* Fixed width */
      }

      .preview-item span {
        font-size: 13px;
        /* Reduced from 15px */
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      .preview-text h2 {
        font-size: 1.5rem;
        /* Reduced for mobile */
        line-height: 1.3;
        margin-bottom: 10px;
      }

      .preview-text p {
        font-size: 0.85rem;
        /* Reduced for mobile */
        line-height: 1.4;
      }

      /* Ensure text doesn't overflow in the phone */
      .screen-content {
        gap: 20px;
        /* Reduced gap */
      }

      .dashboard-preview {
        gap: 15px;
        /* Reduced gap */
      }
    }



    /* Add these animations to your existing keyframes section */
    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-50px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(50px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* ===== CSS RESET & GLOBAL STYLES ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      scroll-behavior: smooth;
      overflow-x: hidden;
    }

    body {
      background: var(--dark);
      color: var(--light);
      overflow-x: hidden;
      line-height: 1.6;
      transition: background-color 0.5s ease, color 0.5s ease;
      min-height: 100vh;
      width: 100%;
      position: relative;
    }

    .container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 15px !important;
        /* Reduced padding for mobile */
      }
    }

    /* ===== RESPONSIVE DESIGN HELPER CLASSES ===== */
    .desktop-only {
      display: block;
    }

    .mobile-only {
      display: none;
    }

    @media (max-width: 768px) {
      .desktop-only {
        display: none !important;
      }

      .mobile-only {
        display: block !important;
      }
    }

    /* ===== UTILITY CLASSES ===== */
    .glow {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 700;
    }

    .nerist-glow {
      background: linear-gradient(90deg, var(--nerist-green), var(--nerist-light-green));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 800;
    }

    .btn {
      display: inline-block;
      padding: 14px 32px;
      border-radius: 50px;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: none;
      font-size: 1rem;
      position: relative;
      overflow: hidden;
      letter-spacing: 0.5px;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(99, 102, 241, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
      color: white;
      box-shadow: 0 6px 20px rgba(34, 211, 238, 0.3);
    }

    .btn-secondary:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(34, 211, 238, 0.4);
    }

    .btn-nerist {
      background: linear-gradient(135deg, var(--nerist-green), var(--nerist-light-green));
      color: white;
      box-shadow: 0 6px 20px rgba(26, 95, 35, 0.3);
    }

    .btn-nerist:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(26, 95, 35, 0.4);
    }

    .btn-outline {
      background: transparent;
      color: var(--light);
      border: 2px solid var(--primary);
    }

    .btn-outline:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-4px);
    }

    .section-title {
      font-size: clamp(2rem, 5vw, 2.8rem);
      margin-bottom: 1.2rem;
      position: relative;
      display: inline-block;
      animation: fadeInUp 0.8s ease;
      line-height: 1.2;
    }

    .section-title:after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 0;
      width: 100px;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 3px;
      animation: expandWidth 0.8s ease 0.5s both;
    }

    .section-subtitle {
      color: var(--gray);
      font-size: clamp(1rem, 3vw, 1.2rem);
      max-width: 700px;
      margin-bottom: 2.5rem;
      animation: fadeInUp 0.8s ease 0.2s both;
      line-height: 1.6;
    }

    /* ===== NAVBAR ===== */
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 5%;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      z-index: 1000;
      border-bottom: 1px solid var(--card-border);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body.light-theme nav {
      background: rgba(248, 250, 252, 0.95);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    nav.scrolled {
      padding: 15px 5%;
      box-shadow: 0 5px 30px rgba(0, 0, 0, 0.1);
    }

    .nav-logo {
      display: flex;
      align-items: center;
      gap: 15px;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .nav-logo {
        margin-left: 10px;
        /* Adjusted for mobile */
        gap: 12px;
        /* Reduced gap for mobile */
      }

      .nav-logo h1 {
        font-size: 1.2rem;
        /* Smaller font for mobile */
      }

      .nav-logo-icon {
        font-size: 1.3rem;
        /* Smaller icon for mobile */
      }
    }

    .nav-logo h1 {
      font-size: clamp(1.3rem, 4vw, 1.8rem);
      font-weight: 800;
      background: linear-gradient(135deg, var(--nerist-green), var(--nerist-light-green));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .nav-logo-icon {
      color: var(--nerist-light-green);
      font-size: clamp(1.5rem, 4vw, 2rem);
    }

    .nav-menu {
      list-style: none;
      display: flex;
      gap: clamp(15px, 2vw, 25px);
    }

    .nav-menu li {
      position: relative;
      cursor: pointer;
      color: var(--gray);
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 10px 0;
      font-size: clamp(0.8rem, 2vw, 0.95rem);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .nav-menu li:hover {
      color: var(--primary);
    }

    .nav-menu li.active {
      color: var(--primary);
      font-weight: 600;
    }

    .nav-menu li.active:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 2px;
      animation: slideIn 0.3s ease;
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-avatar {
      width: clamp(40px, 8vw, 48px);
      height: clamp(40px, 8vw, 48px);
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      cursor: pointer;
      font-size: clamp(0.9rem, 2vw, 1.1rem);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      flex-shrink: 0;
    }

    .user-avatar:hover {
      transform: scale(1.1);
      box-shadow: 0 0 25px rgba(99, 102, 241, 0.4);
    }

    .theme-toggle {
      background: none;
      border: none;
      color: var(--light);
      font-size: clamp(1.2rem, 3vw, 1.5rem);
      cursor: pointer;
      padding: 10px;
      border-radius: 50%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .theme-toggle:hover {
      background: var(--card-bg);
      transform: rotate(30deg);
    }

    .mobile-menu-btn {
      display: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--light);
      padding: 8px;
      border-radius: 8px;
      transition: all 0.3s ease;
      background: none;
      border: none;
    }

    .mobile-menu-btn:hover {
      background: var(--card-bg);
    }

    /* ===== SECTIONS ===== */
    section {
      padding: clamp(60px, 10vw, 120px) 0;
      display: none;
      opacity: 0;
      transform: translateY(30px);
      animation: sectionFadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @media (max-width: 768px) {
      section {
        padding: 20px 0 30px 0;
        /* REDUCED from clamp(40px, 8vw, 100px) */
      }

      #home {
        padding-top: 40px;
        /* REDUCED from clamp(80px, 12vw, 140px) */
        padding-bottom: 30px;
        /* REDUCED from clamp(60px, 8vw, 100px) */
      }
    }

    section.active {
      display: block;
    }

    @keyframes sectionFadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== HOME SECTION ===== */
    #home {
      padding-top: clamp(100px, 15vw, 160px);
      padding-bottom: clamp(80px, 10vw, 120px);
      position: relative;
      overflow: hidden;
    }

    .hero-content {
      max-width: 1200px;
      margin: 0 auto;
      text-align: center;
      position: relative;
      z-index: 2;
    }

    .hero-title {
      font-size: clamp(2.5rem, 8vw, 4.5rem);
      font-weight: 800;
      margin-bottom: 1.5rem;
      line-height: 1.1;
      animation: fadeInUp 0.8s ease 0.1s both;
      text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .hero-subtitle {
      font-size: clamp(1.1rem, 3vw, 1.4rem);
      color: var(--gray);
      margin-bottom: clamp(2rem, 6vw, 4rem);
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      animation: fadeInUp 0.8s ease 0.3s both;
      line-height: 1.8;
    }

    .hero-buttons {
      display: flex;
      gap: 25px;
      justify-content: center;
      margin-bottom: clamp(2rem, 6vw, 4rem);
      animation: fadeInUp 0.8s ease 0.5s both;
      flex-wrap: wrap;
    }

    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(380px, 100%), 1fr));
      gap: clamp(25px, 4vw, 35px);
      margin: clamp(40px, 8vw, 70px) 0;
      animation: fadeInUp 0.8s ease 0.7s both;
    }

    /* Add extra space between the first card (Schedule) and second card (Weather) */
    .dashboard-cards .card:nth-child(1) {
      margin-bottom: 50px;
    }

    /* For the Campus Alerts and Vision Mission to take full width */
    .dashboard-cards .card:nth-child(n+3) {
      grid-column: span 2;
    }

    .card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 25px;
      padding: clamp(25px, 4vw, 35px);
      backdrop-filter: blur(20px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid var(--card-border);
      position: relative;
      overflow: hidden;
      width: 100%;
    }

    .card {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      margin-bottom: 12px;
      /* Add this */
    }

    /* .card:hover {
  transform: translateY(-12px) scale(1.02);
  margin-bottom: 0;
  z-index: 10;
} */


    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.7s ease;
    }

    .card:hover::before {
      left: 100%;
    }

    .card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .card-title {
      font-size: clamp(1.2rem, 3vw, 1.4rem);
      font-weight: 600;
      color: var(--light);
    }

    .card-icon {
      font-size: clamp(1.5rem, 3vw, 2rem);
      color: var(--primary);
      transition: transform 0.3s ease;
    }

    .card:hover .card-icon {
      transform: scale(1.2) rotate(10deg);
    }

    .card-body {
      color: var(--gray);
      line-height: 1.8;
      font-size: clamp(0.95rem, 2vw, 1.05rem);
    }

    .card-footer {
      margin-top: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    /* Enhanced Schedule Card */
    .schedule-items {
      max-height: 200px;
      overflow: hidden;
      transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .schedule-items.expanded {
      max-height: 500px;
      overflow-y: auto;
    }

    .schedule-item {
      padding: 15px 0;
      border-bottom: 1px solid var(--card-border);
      animation: fadeIn 0.5s ease;
    }

    .schedule-item:last-child {
      border-bottom: none;
    }

    .schedule-time {
      font-weight: 600;
      color: var(--light);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: clamp(1rem, 2vw, 1.1rem);
    }

    .schedule-detail {
      color: var(--gray);
      font-size: clamp(0.9rem, 2vw, 1rem);
      margin-left: 30px;
      line-height: 1.6;
    }

    .view-all-btn {
      background: transparent;
      border: none;
      color: var(--primary);
      font-weight: 600;
      cursor: pointer;
      padding: 10px 20px;
      border-radius: 25px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
      white-space: nowrap;
    }

    .view-all-btn:hover {
      background: rgba(99, 102, 241, 0.1);
      transform: translateY(-2px);
    }

    .view-all-btn i {
      transition: transform 0.3s ease;
    }

    .view-all-btn.expanded i {
      transform: rotate(180deg);
    }

    .hero-stats {
      display: flex;
      justify-content: center;
      gap: clamp(20px, 4vw, 60px);
      margin-top: clamp(3rem, 6vw, 5rem);
      flex-wrap: wrap;
      animation: fadeInUp 0.8s ease 0.9s both;
    }

    .stat-item {
      text-align: center;
      padding: clamp(15px, 3vw, 25px);
      min-width: clamp(140px, 25vw, 180px);
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 20px;
      border: 1px solid var(--card-border);
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      flex: 1;
      min-width: 0;
    }

    .stat-item:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .stat-number {
      font-size: clamp(2rem, 6vw, 3rem);
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 8px;
      line-height: 1;
    }

    .stat-label {
      color: var(--gray);
      font-size: clamp(0.8rem, 2vw, 0.95rem);
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-weight: 600;
    }

    /* ===== CAMPUS ALERTS REDESIGN ===== */
    .campus-alerts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(280px, 100%), 1fr));
      gap: clamp(15px, 3vw, 25px);
      margin-top: 40px;
    }

    .alert-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 20px;
      padding: clamp(15px, 3vw, 25px);
      border: 1px solid var(--card-border);
      transition: all 0.3s ease;
      display: flex;
      align-items: flex-start;
      gap: clamp(12px, 3vw, 18px);
    }

    .alert-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
    }

    .alert-icon {
      font-size: 1.5rem;
      padding: 12px;
      border-radius: 12px;
      background: rgba(34, 211, 238, 0.1);
      color: var(--secondary);
      flex-shrink: 0;
    }

    .alert-content h4 {
      color: var(--light);
      margin-bottom: 8px;
      font-size: clamp(1rem, 2vw, 1.1rem);
    }

    .alert-content p {
      color: var(--gray);
      font-size: clamp(0.85rem, 2vw, 0.95rem);
      line-height: 1.6;
    }

    /* ===== VISION & MISSION REDESIGN ===== */
    .vision-mission-section {
      margin: clamp(40px, 8vw, 100px) 0;
      padding: clamp(40px, 8vw, 80px) 0;
      background: linear-gradient(135deg, var(--darker), rgba(26, 95, 35, 0.1));
      border-radius: 40px;
      animation: fadeInUp 0.8s ease 1.1s both;
      position: relative;
      overflow: hidden;
    }

    .vision-mission-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--nerist-green), var(--nerist-light-green), var(--secondary));
      animation: gradientShift 3s infinite alternate;
    }

    .vision-mission-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: clamp(25px, 4vw, 35px);
      max-width: 1200px;
      margin: 0 auto;
    }

    .vision-card,
    .mission-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border-radius: 25px;
      padding: clamp(25px, 4vw, 40px);
      border: 1px solid var(--card-border);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      height: 100%;
    }

    .vision-card:hover,
    .mission-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
    }

    .vision-card h3,
    .mission-card h3 {
      font-size: clamp(1.4rem, 3vw, 1.8rem);
      margin-bottom: 20px;
      color: var(--light);
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .vision-card h3 i,
    .mission-card h3 i {
      color: var(--secondary);
      font-size: clamp(1.4rem, 3vw, 1.8rem);
    }

    .vision-card p,
    .mission-card p {
      color: var(--gray);
      line-height: 1.8;
      font-size: clamp(1rem, 2vw, 1.1rem);
    }

    /* ===== ABOUT NERIST ONE - SIMPLIFIED ===== */
    .about-nerist-section {
      margin: clamp(40px, 6vw, 80px) 0;
      padding: clamp(40px, 6vw, 60px) 0;
    }

    .about-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: clamp(30px, 6vw, 70px);
      align-items: center;
    }

    .about-text h2 {
      font-size: clamp(2rem, 6vw, 3.2rem);
      margin-bottom: 30px;
      line-height: 1.2;
      background: linear-gradient(135deg, var(--nerist-green), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .about-text p {
      font-size: clamp(1rem, 3vw, 1.2rem);
      color: var(--gray);
      margin-bottom: 30px;
      line-height: 1.9;
    }

    /* ===== RESULTS SECTION ===== */
    .results-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: clamp(25px, 4vw, 35px);
      margin-top: 50px;
      animation: fadeInUp 0.8s ease 0.3s both;
    }

    .semester-selector {
      display: flex;
      gap: 15px;
      margin-bottom: 35px;
      flex-wrap: wrap;
      align-items: center;
      animation: fadeInUp 0.8s ease 0.4s both;
    }

    .semester-btn {
      padding: 12px 24px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      color: var(--light);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 10px;
      white-space: nowrap;
    }

    .semester-btn:hover {
      background: rgba(99, 102, 241, 0.1);
      border-color: var(--primary);
      transform: translateY(-3px);
    }

    .semester-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
    }

    .gpa-display {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .gpa-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 20px;
      padding: clamp(25px, 3vw, 35px);
      text-align: center;
      border: 1px solid var(--card-border);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .gpa-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .gpa-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.4s ease;
    }

    .gpa-card:hover::before {
      transform: scaleX(1);
    }

    .gpa-value {
      font-size: clamp(2.5rem, 6vw, 3.5rem);
      font-weight: 800;
      margin-bottom: 15px;
      line-height: 1;
    }

    .gpa-label {
      color: var(--gray);
      font-size: clamp(1rem, 2vw, 1.1rem);
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .gpa-status {
      display: inline-block;
      padding: 8px 20px;
      border-radius: 50px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-top: 15px;
    }

    .status-excellent {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .status-good {
      background: rgba(34, 211, 238, 0.2);
      color: var(--secondary);
    }

    .status-average {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .results-table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin-top: 35px;
      animation: fadeInUp 0.8s ease 0.5s both;
    }

    .results-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }

    .results-table th,
    .results-table td {
      padding: clamp(15px, 3vw, 20px);
      text-align: left;
      border-bottom: 1px solid var(--card-border);
      font-size: clamp(0.95rem, 2vw, 1.05rem);
    }

    .results-table th {
      color: var(--gray);
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 0.5px;
      background: rgba(255, 255, 255, 0.05);
      white-space: nowrap;
    }

    .results-table tbody tr {
      transition: all 0.3s ease;
    }

    .results-table tbody tr:hover {
      background: rgba(255, 255, 255, 0.05);
      transform: translateX(5px);
    }

    .grade-badge {
      padding: 8px 16px;
      border-radius: 50px;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-block;
      white-space: nowrap;
    }

    .grade-a {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .grade-b {
      background: rgba(34, 211, 238, 0.2);
      color: var(--secondary);
    }

    .grade-c {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .grade-d {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    .grade-f {
      background: rgba(239, 68, 68, 0.3);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.5);
    }

    .progress-chart-container {
      margin-top: 50px;
      animation: fadeInUp 0.8s ease 0.6s both;
    }

    .progress-timeline {
      display: flex;
      justify-content: space-between;
      position: relative;
      margin-top: 30px;
      padding: 0 20px;
    }

    .progress-timeline::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--card-bg);
      border-radius: 2px;
    }

    .progress-fill {
      position: absolute;
      top: 20px;
      left: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 2px;
      transition: width 1s ease;
    }

    .timeline-point {
      position: relative;
      text-align: center;
      z-index: 2;
      flex: 1;
    }

    .point-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--card-bg);
      border: 3px solid var(--card-border);
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: var(--light);
      transition: all 0.3s ease;
    }

    .point-circle.active {
      background: var(--primary);
      border-color: var(--primary);
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
    }

    .point-circle.completed {
      background: var(--success);
      border-color: var(--success);
    }

    .point-label {
      color: var(--gray);
      font-size: 0.9rem;
      font-weight: 500;
    }

    .point-sgpa {
      color: var(--light);
      font-weight: 600;
      margin-top: 5px;
      font-size: 1.1rem;
    }

    /* ===== WEATHER WIDGET ===== */
    .weather-widget {
      background: linear-gradient(135deg, var(--primary), var(--secondary-dark));
      border-radius: 30px;
      padding: clamp(25px, 4vw, 40px);
      color: white;
      text-align: center;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      width: 100%;
    }

    .weather-widget:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 25px 50px rgba(99, 102, 241, 0.3);
    }

    .weather-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      position: relative;
      z-index: 2;
    }

    .weather-temp {
      font-size: clamp(2.5rem, 8vw, 4rem);
      font-weight: 700;
      text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .weather-location {
      font-size: clamp(1.2rem, 3vw, 1.5rem);
      font-weight: 600;
    }

    .weather-details {
      display: flex;
      justify-content: center;
      gap: clamp(20px, 4vw, 40px);
      margin-top: 25px;
      font-size: clamp(1rem, 2vw, 1.1rem);
      flex-wrap: wrap;
    }

    .weather-icon {
      font-size: clamp(3rem, 8vw, 5rem);
      margin-bottom: 20px;
      transition: transform 0.5s ease;
      filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.2));
    }

    .weather-widget:hover .weather-icon {
      transform: rotate(20deg) scale(1.1);
    }

    /* ===== ATTENDANCE SECTION ===== */
    .attendance-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: clamp(25px, 4vw, 35px);
      margin-top: 50px;
      animation: fadeInUp 0.8s ease 0.3s both;
    }

    .attendance-chart-container {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 25px;
      padding: clamp(25px, 4vw, 35px);
      border: 1px solid var(--card-border);
    }

    .attendance-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
      gap: 25px;
    }

    .stat-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 20px;
      padding: clamp(20px, 3vw, 30px);
      text-align: center;
      border: 1px solid var(--card-border);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
    }

    .stat-card h4 {
      font-size: clamp(1rem, 2vw, 1.1rem);
      margin-bottom: 15px;
      color: var(--gray);
    }

    .stat-card .value {
      font-size: clamp(2rem, 6vw, 3rem);
      font-weight: 700;
      margin-bottom: 10px;
      line-height: 1;
    }

    .stat-card .value.present {
      color: var(--success);
    }

    .stat-card .value.absent {
      color: var(--danger);
    }

    .attendance-table-container {
      margin-top: 35px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .attendance-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }

    .attendance-table th,
    .attendance-table td {
      padding: clamp(12px, 3vw, 18px);
      text-align: left;
      border-bottom: 1px solid var(--card-border);
      font-size: clamp(0.9rem, 2vw, 1rem);
    }

    .attendance-table th {
      color: var(--gray);
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 0.5px;
      background: rgba(255, 255, 255, 0.05);
      white-space: nowrap;
    }

    .attendance-table tbody tr {
      transition: all 0.3s ease;
    }

    .attendance-table tbody tr:hover {
      background: rgba(255, 255, 255, 0.05);
      transform: translateX(5px);
    }

    /* ===== ADMIN APPLICATIONS TABLE ===== */
    #studentApplicationsTable {
      min-width: 800px;
    }

    .application-status-badge {
      padding: 8px 16px;
      border-radius: 50px;
      font-size: 0.85rem;
      font-weight: 600;
      display: inline-block;
      white-space: nowrap;
    }

    .status-pending {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .status-accepted {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .status-rejected {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    .status-under-review {
      background: rgba(34, 211, 238, 0.2);
      color: var(--secondary);
    }

    .action-buttons {
      display: flex;
      gap: 6px;
      flex-wrap: nowrap;
      align-items: center;
    }

    .action-btn {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      min-width: 70px;
      height: 32px;
      text-align: center;
    }

    .action-btn.accept {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .action-btn.accept:hover {
      background: var(--success);
      color: white;
      border-color: var(--success);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .action-btn.reject {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .action-btn.reject:hover {
      background: var(--danger);
      color: white;
      border-color: var(--danger);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    .action-btn.view {
      background: rgba(99, 102, 241, 0.2);
      color: var(--primary);
      border: 1px solid rgba(99, 102, 241, 0.3);
    }

    .action-btn.view:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    /* Ensure all action buttons have same size */
    .action-btn i {
      font-size: 0.7rem;
      width: 12px;
      text-align: center;
    }

    /* Make buttons in the modal also uniform */
    .modal .action-buttons {
      gap: 8px;
    }

    .modal .action-btn {
      min-width: 80px;
      height: 36px;
      font-size: 0.8rem;
    }

    /* Bulk action buttons */
    .bulk-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .bulk-action-btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      min-width: 120px;
      height: 36px;
    }

    .bulk-select {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      border: 1px solid var(--card-border);
    }

    .status-badge {
      padding: 8px 18px;
      border-radius: 50px;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-block;
      white-space: nowrap;
    }

    .status-present {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .status-absent {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    .status-late {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    /* ===== FORM CONTROLS ===== */
    .form-group {
      margin-bottom: 30px;
      animation: fadeInUp 0.5s ease;
    }

    .form-group label {
      display: block;
      margin-bottom: 10px;
      color: var(--light);
      font-weight: 500;
      font-size: clamp(0.9rem, 2vw, 1rem);
    }

    .form-control {
      width: 100%;
      padding: 16px 20px;
      border-radius: 15px;
      border: 2px solid var(--card-border);
      background: var(--card-bg);
      color: var(--light);
      font-size: 1rem;
      transition: all 0.3s ease;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }

    /* Style for select dropdown options */
    .form-control option {
      background: var(--dark);
      color: var(--light);
      padding: 12px 15px;
      font-size: 1rem;
    }

    /* For Webkit browsers (Chrome, Safari, Edge) */
    .form-control::-webkit-scrollbar {
      width: 8px;
    }

    .form-control::-webkit-scrollbar-track {
      background: var(--card-bg);
      border-radius: 10px;
    }

    .form-control::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }

    /* Add dropdown arrow for select elements */
    select.form-control {
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2394a3b8'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 20px center;
      background-size: 16px;
      padding-right: 50px;
      cursor: pointer;
    }

    /* Light theme select arrow */
    body.light-theme select.form-control {
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%231e293b'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    }

    /* ===== TOGGLE SWITCH STYLES ===== */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--gray);
      transition: .4s;
      border-radius: 34px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    .toggle-switch input:checked+.toggle-slider {
      background-color: var(--success);
    }

    .toggle-switch input:checked+.toggle-slider:before {
      transform: translateX(26px);
    }

    /* Avatar color button active state */
    .avatar-color-btn.active {
      border: 3px solid var(--light) !important;
      transform: scale(1.1);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    /* ===== SOS SOUND CONTROLS ===== */
    .sos-sound-controls {
      text-align: center;
      margin-top: 25px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      border: 1px solid var(--card-border);
    }

    .sound-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .sound-toggle label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      color: var(--light);
      font-weight: 500;
    }

    .volume-control {
      width: 100%;
      max-width: 300px;
      margin: 0 auto;
    }

    .volume-control label {
      display: block;
      margin-bottom: 10px;
      color: var(--light);
      font-weight: 500;
    }

    .volume-slider {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      appearance: none;
      background: var(--card-bg);
      border-radius: 4px;
      outline: none;
      opacity: 0.9;
      transition: opacity 0.2s;
    }

    .volume-slider:hover {
      opacity: 1;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--danger);
      cursor: pointer;
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
    }

    .volume-slider::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--danger);
      cursor: pointer;
      border: none;
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
    }

    .sound-indicator {
      margin-top: 15px;
      font-size: 0.9rem;
      color: var(--gray);
    }

    .sound-indicator.active {
      color: var(--success);
      font-weight: 600;
    }

    /* ===== SAFETY SECTION ===== */
    .safety-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: clamp(25px, 4vw, 35px);
      margin-top: 50px;
      animation: fadeInUp 0.8s ease 0.3s both;
    }

    /* ===== SAFETY SECTION ===== */
    .safety-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: clamp(25px, 4vw, 35px);
      margin-top: 50px;
      animation: fadeInUp 0.8s ease 0.3s both;
    }

    .sos-button-container {
      text-align: center;
      margin-bottom: clamp(40px, 6vw, 60px);
      animation: fadeInUp 0.8s ease 0.2s both;
    }

    .sos-button {
      width: clamp(150px, 40vw, 220px);
      height: clamp(150px, 40vw, 220px);
      border-radius: 50%;
      background: linear-gradient(135deg, var(--danger), #dc2626);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 0 rgba(239, 68, 68, 0.4);
      animation: pulse 2s infinite;
      position: relative;
      overflow: hidden;
    }

    .sos-button:hover {
      transform: scale(1.12);
      box-shadow: 0 0 60px rgba(239, 68, 68, 0.8);
    }

    .sos-button:active {
      transform: scale(0.98);
    }

    .sos-button::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0) 70%);
      transform: rotate(0deg);
      animation: rotate 20s linear infinite;
    }

    .sos-icon {
      font-size: clamp(3rem, 8vw, 4.5rem);
      margin-bottom: 20px;
      position: relative;
      z-index: 1;
    }

    .sos-text {
      font-size: clamp(1.5rem, 4vw, 2rem);
      font-weight: 800;
      position: relative;
      z-index: 1;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.8);
      }

      70% {
        box-shadow: 0 0 0 40px rgba(239, 68, 68, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
      }
    }

    .emergency-contacts {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(min(240px, 100%), 1fr));
      gap: 25px;
      margin-top: 35px;
    }

    .contact-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 20px;
      padding: clamp(20px, 3vw, 30px);
      text-align: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .contact-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .contact-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.4s ease;
    }

    .contact-card:hover::before {
      transform: scaleX(1);
    }

    .contact-icon {
      font-size: clamp(2rem, 4vw, 2.5rem);
      color: var(--secondary);
      margin-bottom: 25px;
    }

    .contact-name {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: clamp(1.1rem, 2vw, 1.2rem);
      color: var(--light);
    }

    .contact-role {
      color: var(--gray);
      font-size: clamp(0.9rem, 2vw, 1rem);
      margin-bottom: 20px;
    }

    .contact-number {
      color: var(--light);
      font-weight: 500;
      font-size: clamp(1rem, 2vw, 1.1rem);
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 20px;
      border-radius: 50px;
      display: inline-block;
      transition: all 0.3s ease;
      word-break: break-all;
    }

    .contact-card:hover .contact-number {
      background: var(--primary);
      color: white;
      transform: scale(1.05);
    }

    /* ===== FIXED RATING SYSTEM ===== */
    .star-rating {
      display: flex;
      flex-direction: row-reverse;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .star-rating input {
      display: none;
    }

    .star-rating label {
      font-size: clamp(1.8rem, 4vw, 2.2rem);
      color: var(--gray);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .star-rating label:hover,
    .star-rating label:hover~label {
      color: var(--warning);
      transform: scale(1.2);
    }

    .star-rating input:checked~label {
      color: var(--warning);
    }

    /* ===== MESS SECTION ===== */
    .meal-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 25px;
      padding: clamp(25px, 4vw, 35px);
      border: 1px solid var(--card-border);
      margin-bottom: 30px;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      width: 100%;
    }

    .meal-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
    }

    .meal-card::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      opacity: 0.05;
      border-radius: 0 0 0 100px;
    }

    .meal-time {
      font-size: clamp(1.2rem, 3vw, 1.4rem);
      font-weight: 600;
      margin-bottom: 25px;
      color: var(--light);
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .meal-time i {
      color: var(--secondary);
      font-size: clamp(1.4rem, 3vw, 1.6rem);
    }

    .meal-items {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 30px;
    }

    .meal-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 20px;
      border-radius: 50px;
      font-size: clamp(0.9rem, 2vw, 1rem);
      border: 1px solid var(--card-border);
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .meal-item:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-3px);
    }

    .meal-stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1rem;
      flex-wrap: wrap;
      gap: 15px;
    }

    /* Inactive dinner styling */
    /* ===== FIX FOR DINNER CARD - MAKE SAME AS BREAKFAST/LUNCH ===== */
    .meal-card.inactive {
      opacity: 1 !important;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02)) !important;
      border: 1px solid var(--card-border) !important;
    }

    /* Remove the gray styling from inactive items inside dinner card */
    .meal-card.inactive .meal-time {
      color: var(--light) !important;
    }

    .meal-card.inactive .meal-items span {
      background: rgba(255, 255, 255, 0.1) !important;
      color: var(--light) !important;
      opacity: 1 !important;
    }

    .meal-card.inactive .meal-stats {
      color: var(--light) !important;
    }

    .inactive-badge {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .prediction-meter {
      height: 12px;
      background: var(--card-bg);
      border-radius: 6px;
      overflow: hidden;
      margin-top: 50px;
      position: relative;
    }

    .prediction-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--success), var(--warning));
      border-radius: 6px;
      width: 75%;
      position: relative;
      animation: fillWidth 2s ease-in-out;
    }

    .prediction-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 2s infinite;
    }

    /* ===== NAVIGATION SECTION - OFFLINE MAP ===== */
    .navigation-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: clamp(25px, 4vw, 35px);
      margin-top: 50px;
      animation: fadeInUp 0.8s ease 0.3s both;
    }

    /* Spacing for navigation sections */
    .navigation-container>div {
      margin-bottom: 0;
    }

    /* Ensure consistent spacing between sections */
    .navigation-container>div>*:not(:first-child) {
      margin-top: 50px;
    }

    /* Specific spacing for Live Event Directions section */
    .map-container+div {
      margin-top: 50px !important;
      display: block;
      width: 100%;
    }

    /* Spacing for Find Locations header */
    .navigation-container>div:nth-child(2)>h3 {
      margin-bottom: 25px;
    }

    /* Ensure the search box has proper spacing */
    .search-box {
      margin: 0 0 35px 0 !important;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      border-radius: 20px;
      overflow: hidden;
      animation: fadeInUp 0.5s ease 0.4s both;
      width: 100%;
    }

    /* Leaflet Map Container */
    #neristMap {
      width: 100%;
      height: 100%;
      border-radius: 15px;
      z-index: 1;
      position: relative;
    }

    /* Ensure Leaflet controls are visible */
    .leaflet-control-container {
      z-index: 1000 !important;
    }

    .leaflet-bar {
      background: var(--dark) !important;
      border: 1px solid var(--card-border) !important;
      border-radius: 10px !important;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2) !important;
    }

    .leaflet-bar a {
      background: var(--card-bg) !important;
      color: var(--light) !important;
      border-bottom: 1px solid var(--card-border) !important;
      width: 30px !important;
      height: 30px !important;
      line-height: 30px !important;
      text-align: center !important;
      text-decoration: none !important;
    }

    .leaflet-bar a:hover {
      background: var(--primary) !important;
      color: white !important;
    }

    .leaflet-bar a:first-child {
      border-top-left-radius: 10px !important;
      border-top-right-radius: 10px !important;
    }

    .leaflet-bar a:last-child {
      border-bottom-left-radius: 10px !important;
      border-bottom-right-radius: 10px !important;
      border-bottom: none !important;
    }

    .leaflet-popup-content-wrapper {
      background: var(--dark) !important;
      color: var(--light) !important;
      border: 1px solid var(--card-border) !important;
      border-radius: 12px !important;
    }

    .leaflet-popup-tip {
      background: var(--dark) !important;
    }

    .leaflet-popup-close-button {
      color: var(--light) !important;
    }

    .leaflet-popup-close-button:hover {
      color: var(--primary) !important;
    }

    /* Custom marker icons */
    .custom-marker {
      background: var(--primary);
      border: 3px solid white;
      border-radius: 50%;
      width: 40px !important;
      height: 40px !important;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
    }

    /* Map overlay */
    .map-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.7);
      z-index: 2;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      backdrop-filter: blur(5px);
    }

    /* Add spacing between navigation sections */
    .navigation-container>div:nth-child(2) {
      padding-left: 20px;
    }

    @media (max-width: 768px) {
      .navigation-container>div:nth-child(2) {
        padding-left: 10px;
        margin-top: 30px;
      }
    }

    .map-container {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 25px;
      padding: 25px;
      border: 1px solid var(--card-border);
      height: clamp(400px, 50vh, 550px);
      position: relative;
      overflow: hidden;
    }

    .campus-map-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 15px;
      background: linear-gradient(135deg, var(--darker), rgba(26, 95, 35, 0.1));
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray);
      font-size: clamp(1rem, 3vw, 1.2rem);
      text-align: center;
      padding: 20px;
    }

    .map-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.8);
      z-index: 2;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
    }

    .map-overlay h3 {
      color: var(--light);
      margin-bottom: 15px;
      font-size: clamp(1.2rem, 3vw, 1.5rem);
    }

    .map-overlay p {
      color: var(--gray);
      margin-bottom: 25px;
      max-width: 400px;
      font-size: clamp(0.9rem, 2vw, 1rem);
    }

    .search-box {
      display: flex;
      margin: 30px 0 35px 0;
      /* Added top margin */
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      border-radius: 20px;
      overflow: hidden;
      animation: fadeInUp 0.5s ease 0.4s both;
      width: 100%;
    }

    .search-box input {
      flex: 1;
      padding: 15px 20px;
      border: none;
      background: var(--card-bg);
      color: var(--light);
      font-size: clamp(1rem, 2vw, 1.1rem);
      transition: all 0.3s ease;
      min-width: 0;
    }

    .search-box input:focus {
      outline: none;
      background: var(--card-bg);
    }

    .search-box button {
      padding: 0 25px;
      border: none;
      background: var(--primary);
      color: white;
      font-weight: 600;
      cursor: pointer;
      font-size: clamp(1rem, 2vw, 1.1rem);
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .search-box button:hover {
      background: var(--primary-dark);
    }

    .location-list {
      max-height: 500px;
      overflow-y: auto;
      padding: 0 15px 0 20px;
      /* Added left padding */
      position: relative;
      background: transparent;
      margin-top: 20px;
      /* Added top margin */
    }

    @media (max-width: 768px) {
      .location-list {
        padding: 0 10px 0 15px;
        /* Adjust for mobile */
        margin-top: 15px;
      }
    }

    .location-list::-webkit-scrollbar {
      width: 8px;
    }

    .location-list::-webkit-scrollbar-track {
      background: var(--card-bg);
      border-radius: 10px;
    }

    .location-list::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }

    /* Ensure all location items are fully visible */
    /* Ensure all location items have consistent styling */
    .location-item {
      background: rgba(255, 255, 255, 0.03) !important;
      border: 1px solid var(--card-border) !important;
      border-radius: 15px !important;
      padding: 20px 20px 20px 25px !important;
      /* Added extra left padding */
      margin-bottom: 12px !important;
      cursor: pointer !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
      opacity: 1 !important;
      position: relative !important;
      z-index: 1 !important;
      margin-left: 0 !important;
      /* Ensure no left margin */
    }

    @media (max-width: 768px) {
      .location-item {
        padding: 18px 15px 18px 20px !important;
        /* Adjusted for mobile */
      }
    }

    .location-item:hover {
      background: rgba(255, 255, 255, 0.08) !important;
      transform: translateY(-5px) !important;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1) !important;
      border-color: var(--primary) !important;
    }

    .location-name {
      font-weight: 600 !important;
      margin-bottom: 10px !important;
      font-size: 1.2rem !important;
      color: var(--light) !important;
    }

    .location-desc {
      color: var(--gray) !important;
      font-size: 1rem !important;
      display: flex !important;
      align-items: center !important;
      gap: 10px !important;
      flex-wrap: wrap !important;
    }



    /* ===== CAREER SECTION ===== */
    .career-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: clamp(25px, 4vw, 35px);
      margin-top: 50px;
      animation: fadeInUp 0.8s ease 0.3s both;
    }

    .opportunity-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 25px;
      padding: clamp(25px, 4vw, 35px);
      border: 1px solid var(--card-border);
      margin-bottom: 30px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      width: 100%;
    }

    .opportunity-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
    }

    .opportunity-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .opportunity-title {
      font-size: clamp(1.2rem, 3vw, 1.5rem);
      font-weight: 600;
      color: var(--light);
      line-height: 1.4;
      flex: 1;
      min-width: 200px;
    }

    .opportunity-type {
      padding: 8px 20px;
      border-radius: 50px;
      font-size: 0.9rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .type-scholarship {
      background: rgba(34, 211, 238, 0.2);
      color: var(--secondary);
    }

    .type-internship {
      background: rgba(99, 102, 241, 0.2);
      color: var(--primary);
    }

    .type-fellowship {
      background: rgba(139, 92, 246, 0.2);
      color: #8b5cf6;
    }

    .type-placement {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .opportunity-details {
      color: var(--gray);
      margin-bottom: 30px;
      line-height: 1.8;
      font-size: clamp(1rem, 2vw, 1.1rem);
    }

    .opportunity-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .opportunity-deadline {
      color: var(--warning);
      font-weight: 600;
      font-size: clamp(1rem, 2vw, 1.1rem);
      display: flex;
      align-items: center;
      gap: 10px;
      white-space: nowrap;
    }

    .match-badge {
      padding: 10px 20px;
      border-radius: 50px;
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      font-size: clamp(0.9rem, 2vw, 1rem);
      font-weight: 600;
      white-space: nowrap;
    }

    /* ===== MODALS ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
      padding: 20px;
    }

    body.light-theme .modal {
      background: rgba(0, 0, 0, 0.8);
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--dark);
      border-radius: 30px;
      padding: clamp(25px, 5vw, 50px);
      max-width: min(650px, 95vw);
      width: 100%;
      border: 1px solid var(--card-border);
      box-shadow: 0 40px 80px rgba(0, 0, 0, 0.6);
      position: relative;
      animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      transform-origin: center;
      max-height: 90vh;
      overflow-y: auto;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(30px);
      }

      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 1.8rem;
      cursor: pointer;
      color: var(--gray);
      transition: all 0.3s ease;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      background: var(--card-bg);
    }

    .modal-close:hover {
      color: var(--light);
      background: var(--primary);
      transform: rotate(90deg);
    }

    .modal-title {
      font-size: clamp(1.5rem, 4vw, 2.2rem);
      margin-bottom: 25px;
      color: var(--light);
    }

    .modal-body {
      color: var(--gray);
      margin-bottom: 40px;
      line-height: 1.8;
      font-size: clamp(1rem, 2vw, 1.1rem);
    }

    /* ===== MODALS ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
      padding: 20px;
    }

    /* Ensure modal is visible when active */
    .modal.active {
      display: flex !important;
      opacity: 1 !important;
    }

    /* ===== FOOTER ===== */
    footer {
      text-align: center;
      padding: clamp(40px, 8vw, 80px) 20px;
      color: var(--gray);
      font-size: 1rem;
      border-top: 1px solid var(--card-border);
      background: linear-gradient(135deg, var(--darker), rgba(26, 95, 35, 0.1));
      margin-top: clamp(60px, 10vw, 120px);
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: clamp(15px, 3vw, 40px);
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .footer-links a {
      color: var(--gray);
      text-decoration: none;
      transition: all 0.3s ease;
      font-size: clamp(0.9rem, 2vw, 1.05rem);
      font-weight: 500;
    }

    .footer-links a:hover {
      color: var(--primary);
      transform: translateY(-3px);
    }

    .footer-social {
      display: flex;
      gap: 15px;
      margin-bottom: 40px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .social-icon {
      width: clamp(45px, 8vw, 60px);
      height: clamp(45px, 8vw, 60px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--card-bg);
      color: var(--light);
      font-size: clamp(1.4rem, 3vw, 1.8rem);
      transition: all 0.3s ease;
      cursor: pointer;
      text-decoration: none;
    }

    .social-icon:hover {
      transform: translateY(-8px) scale(1.1);
      background: var(--primary);
      color: white;
    }

    .social-icon.yt:hover {
      background: #FF0000;
    }

    .social-icon.insta:hover {
      background: #E4405F;
    }

    .social-icon.fb:hover {
      background: #1877F2;
    }

    .social-icon.linkedin:hover {
      background: #0A66C2;
    }

    .social-icon.x:hover {
      background: #000000;
    }

    /* ===== ANIMATIONS ===== */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes expandWidth {
      from {
        width: 0;
      }

      to {
        width: 100px;
      }
    }

    @keyframes fillWidth {
      from {
        width: 0;
      }
    }

    @keyframes slideIn {
      from {
        transform: scaleX(0);
      }

      to {
        transform: scaleX(1);
      }
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%);
      }

      100% {
        transform: translateX(100%);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }

      100% {
        background-position: 100% 50%;
      }
    }

    @keyframes rotate {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    /* ===== BACKGROUND ELEMENTS ===== */
    .floating-elements {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }

    .floating-element {
      position: absolute;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), transparent);
      animation: floatElement 20s infinite linear;
      opacity: 0.1;
    }

    @keyframes floatElement {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }

      33% {
        transform: translate(30px, -50px) rotate(120deg);
      }

      66% {
        transform: translate(-20px, 20px) rotate(240deg);
      }

      100% {
        transform: translate(0, 0) rotate(360deg);
      }
    }

    /* ===== LOADING ANIMATIONS ===== */
    .loading-shimmer {
      background: linear-gradient(90deg,
          rgba(255, 255, 255, 0.1) 25%,
          rgba(255, 255, 255, 0.2) 50%,
          rgba(255, 255, 255, 0.1) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 1200px) {
      .hero-title {
        font-size: clamp(2.2rem, 7vw, 3.8rem);
      }

      .dashboard-cards {
        grid-template-columns: repeat(auto-fit, minmax(min(320px, 100%), 1fr));
      }
    }

    @media (max-width: 992px) {
      .hero-title {
        font-size: clamp(2rem, 6vw, 3.2rem);
      }

      .section-title {
        font-size: clamp(1.8rem, 5vw, 2.5rem);
      }

      .nav-menu {
        position: fixed;
        top: 90px;
        right: -100%;
        flex-direction: column;
        background: var(--dark);
        width: min(300px, 90vw);
        padding: 35px;
        border-radius: 0 0 0 25px;
        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(20px);
        border-left: 1px solid var(--card-border);
        border-bottom: 1px solid var(--card-border);
        box-shadow: -15px 15px 40px rgba(0, 0, 0, 0.2);
        height: calc(100vh - 90px);
        overflow-y: auto;
        z-index: 1000;
        gap: 20px;
      }

      .nav-menu.active {
        right: 0;
      }

      .mobile-menu-btn {
        display: block;
      }

      .hero-buttons {
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      .btn {
        width: 100%;
        max-width: 350px;
        text-align: center;
      }

      .about-text h2 {
        font-size: clamp(1.8rem, 5vw, 2.8rem);
      }
    }


    /* ===== FIX FOR SEMESTER BUTTONS ON MOBILE ===== */
    @media (max-width: 768px) {
      .semester-selector {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 25px;
        justify-content: center;
      }

      .semester-btn {
        width: 100%;
        padding: 14px 12px;
        font-size: 0.9rem;
        justify-content: center;
        text-align: center;
        min-height: 52px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .semester-btn i {
        font-size: 0.9rem;
        margin-right: 6px;
      }
    }

    @media (max-width: 480px) {
      .semester-selector {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .semester-btn {
        padding: 12px 8px;
        font-size: 0.85rem;
        min-height: 48px;
      }

      .semester-btn i {
        font-size: 0.85rem;
        margin-right: 5px;
      }
    }

    @media (max-width: 375px) {
      .semester-selector {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }

      .semester-btn {
        padding: 10px 6px;
        font-size: 0.8rem;
        min-height: 46px;
      }

      .semester-btn i {
        display: none;
        /* Hide icon on very small screens */
      }
    }

    /* Ensure proper spacing between results section elements on mobile */
    @media (max-width: 768px) {
      .results-container {
        gap: 20px;
      }

      .gpa-display {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .gpa-card {
        padding: 25px 20px;
      }

      .gpa-value {
        font-size: 2.2rem;
      }

      .results-table-container {
        margin-top: 25px;
      }

      .progress-chart-container {
        margin-top: 30px;
      }
    }

    @media (max-width: 768px) {

      /* Fix navbar spacing */
      nav {
        padding: 15px 20px;
        /* Reduced padding for mobile */
      }

      /* Fix hero title visibility */
      .hero-title {
        font-size: clamp(1.8rem, 5vw, 2.8rem);
        margin-top: 20px;
        /* Added space */
        padding: 0 10px;
        /* Add side padding */
      }

      .hero-subtitle {
        font-size: clamp(1rem, 3vw, 1.2rem);
        padding: 0 10px;
        /* Add side padding */
      }

      /* Fix section headings */
      .section-title {
        font-size: clamp(1.6rem, 5vw, 2rem);
        padding-top: 20px !important;
        margin-top: 10px !important;
        display: block;
        width: 100%;
        text-align: center;
      }

      .section-subtitle {
        padding: 0 15px;
        /* Add side padding */
        text-align: center;
      }

      /* Adjust all sections */
      section {
        padding: 80px 15px 40px 15px !important;
        /* Added side padding */
      }

      /* Fix home section specifically */
      #home {
        padding-top: 100px !important;
        padding-bottom: 60px !important;
      }

      /* Fix the navigation menu */
      .nav-menu {
        top: 80px;
        /* Adjusted for smaller navbar */
      }
    }

    .dashboard-cards {
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .attendance-stats {
      grid-template-columns: repeat(auto-fit, minmax(min(150px, 100%), 1fr));
    }

    .emergency-contacts {
      grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
    }

    .stat-number {
      font-size: clamp(1.8rem, 5vw, 2.5rem);
    }

    .sos-button {
      width: clamp(120px, 35vw, 200px);
      height: clamp(120px, 35vw, 200px);
    }

    .sos-icon {
      font-size: clamp(2.5rem, 6vw, 4rem);
    }

    .sos-text {
      font-size: clamp(1.3rem, 3vw, 1.8rem);
    }

    .map-container {
      height: clamp(300px, 40vh, 450px);
    }

    .card {
      padding: 25px;
    }

    .footer-links {
      gap: 15px;
    }

    .modal-content {
      padding: 25px;
    }

    .modal-title {
      font-size: clamp(1.3rem, 4vw, 1.8rem);
    }

    .about-text h2 {
      font-size: clamp(1.6rem, 4vw, 2.2rem);
    }

    .vision-card,
    .mission-card {
      padding: 25px;
    }

    .login-container {
      padding: 30px 25px;
    }


    @media (max-width: 576px) {
      .hero-title {
        font-size: clamp(1.6rem, 5vw, 2.4rem);
      }

      .hero-subtitle {
        font-size: clamp(0.95rem, 3vw, 1.1rem);
      }

      .section-title {
        font-size: clamp(1.5rem, 4vw, 2rem);
      }

      .nav-logo h1 {
        font-size: clamp(1.1rem, 3vw, 1.5rem);
      }

      .user-avatar {
        width: 36px;
        height: 36px;
        font-size: 0.9rem;
      }

      .footer-links {
        gap: 12px;
        flex-direction: column;
      }

      .footer-links a {
        font-size: 0.95rem;
      }

      .modal-content {
        padding: 20px;
      }

      .modal-title {
        font-size: clamp(1.2rem, 3vw, 1.6rem);
      }

      .about-text h2 {
        font-size: clamp(1.4rem, 4vw, 2rem);
      }

      .vision-card,
      .mission-card {
        padding: 20px;
      }

      .login-container {
        padding: 25px 20px;
      }

      .nav-menu {
        padding: 25px;
      }
    }

    @media (max-width: 375px) {
      .hero-title {
        font-size: 1.8rem;
      }

      .section-title {
        font-size: 1.6rem;
      }

      .btn {
        padding: 12px 24px;
        font-size: 0.9rem;
      }

      .card {
        padding: 20px;
      }
    }

    /* ===== TOUCH DEVICE OPTIMIZATIONS ===== */
    @media (hover: none) and (pointer: coarse) {
      .card:hover {
        transform: none;
      }

      .btn:hover::before {
        width: 0;
        height: 0;
      }

      .card:hover::before {
        left: -100%;
      }

      .nav-menu li:hover {
        color: var(--gray);
      }

      .nav-menu li.active:hover {
        color: var(--primary);
      }
    }

    /* ===== DARK MODE SPECIFIC ===== */
    @media (prefers-color-scheme: dark) {
      body:not(.light-theme) {
        color-scheme: dark;
      }
    }

    /* ===== PRINT STYLES ===== */
    @media print {

      .login-page,
      .modal,
      .mobile-menu-btn,
      .theme-toggle,
      .sos-button,
      .btn {
        display: none !important;
      }

      body {
        background: white !important;
        color: black !important;
      }

      .card {
        border: 1px solid #ddd !important;
        box-shadow: none !important;
      }
    }

    /* ===== FIX FOR INVISIBLE CARDS ===== */
    .card,
    .opportunity-card,
    .location-item {
      opacity: 1 !important;
      background: rgba(255, 255, 255, 0.1) !important;
      position: relative;
      z-index: 1;
    }

    .card::before,
    .opportunity-card::before,
    .location-item::before {
      content: none !important;
    }

    /* ===== FIX FOR LUNCH CARD - MAKE IT SAME AS BREAKFAST ===== */
    .meal-card:not(.inactive) {
      opacity: 1 !important;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02)) !important;
    }

    /* Ensure all meal cards have same text color */
    .meal-time,
    .meal-items span,
    .meal-stats {
      color: var(--light) !important;
    }

    .meal-items span {
      background: rgba(255, 255, 255, 0.1) !important;
    }

    /* Add this to your existing CSS, preferably in the Navigation Section styles */
    .location-list {
      min-height: 200px;
      transition: min-height 0.3s ease;
    }

    /* Ensure location items maintain consistent height */
    .location-item {
      min-height: 100px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* Fix for the location list scrollbar */
    .location-list::-webkit-scrollbar {
      width: 10px;
    }

    .location-list::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }

    .location-list::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }

    .location-list::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }

    /* Ensure content fits within viewport */
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow-x: hidden;
    }

    /* Make sure footer stays at bottom */
    .login-page {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .login-wrapper {
      flex: 1 0 auto;
      /* This will make it expand */
    }

    .login-footer-global {
      flex-shrink: 0;
      /* Prevent footer from shrinking */
      width: 100%;
    }


    /* ===== NEW BUTTON STYLES FOR ADMIN APPLICATIONS ===== */
    /* Button styles for bulk actions */
    .btn-success {
      background: linear-gradient(135deg, var(--success), #0d966b);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 14px 32px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      letter-spacing: 0.5px;
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #c53030);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 14px 32px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      letter-spacing: 0.5px;
    }

    .btn-success:hover,
    .btn-danger:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    /* Quick fix for signup prompt visibility in dark mode */
    body:not(.light-theme) .signup-prompt {
      color: #e2e8f0 !important;
      background: rgba(30, 41, 59, 0.9) !important;
      border-color: rgba(148, 163, 184, 0.2) !important;
    }

    body:not(.light-theme) .signup-link {
      color: #60a5fa !important;
      /* Brighter blue for dark mode */
    }

    /* ===== FIX LEAFLET LAYER CONTROL IN DARK MODE ===== */
    /* Fix for layer control text visibility */
    .leaflet-control-layers label {
      color: var(--light) !important;
      font-size: 14px !important;
      margin-bottom: 8px !important;
      display: flex !important;
      align-items: center !important;
      gap: 8px !important;
      cursor: pointer !important;
    }

    .leaflet-control-layers label:hover {
      color: var(--primary) !important;
    }

    .leaflet-control-layers input[type="radio"],
    .leaflet-control-layers input[type="checkbox"] {
      margin-right: 8px !important;
      accent-color: var(--primary) !important;
    }

    .leaflet-control-layers-expanded {
      background: var(--dark) !important;
      border: 1px solid var(--card-border) !important;
      border-radius: 12px !important;
      padding: 15px !important;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3) !important;
      max-height: 300px !important;
      overflow-y: auto !important;
    }

    .leaflet-control-layers-expanded::-webkit-scrollbar {
      width: 8px !important;
    }

    .leaflet-control-layers-expanded::-webkit-scrollbar-track {
      background: var(--card-bg) !important;
      border-radius: 4px !important;
    }

    .leaflet-control-layers-expanded::-webkit-scrollbar-thumb {
      background: var(--primary) !important;
      border-radius: 4px !important;
    }

    /* Fix the layer control button (the icon) */
    .leaflet-control-layers-toggle {
      background-image: none !important;
      background-color: var(--card-bg) !important;
      border: 1px solid var(--card-border) !important;
      border-radius: 10px !important;
      width: 36px !important;
      height: 36px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      transition: all 0.3s ease !important;
    }

    .leaflet-control-layers-toggle:hover {
      background-color: var(--primary) !important;
      border-color: var(--primary) !important;
    }

    .leaflet-control-layers-toggle:after {
      content: '' !important;
      display: none !important;
    }

    .leaflet-control-layers-toggle:before {
      content: '🗺️' !important;
      font-size: 18px !important;
      color: var(--light) !important;
    }

    .leaflet-control-layers-toggle:hover:before {
      color: white !important;
    }

    /* Fix layer separator */
    .leaflet-control-layers-separator {
      border-top: 1px solid var(--card-border) !important;
      margin: 10px 0 !important;
    }

    /* Ensure radio buttons are visible in dark mode */
    .leaflet-control-layers-base label span {
      color: var(--light) !important;
      font-weight: 500 !important;
    }

    /* Active/selected layer styling */
    .leaflet-control-layers-base input[type="radio"]:checked+span {
      color: var(--primary) !important;
      font-weight: 600 !important;
    }

    /* Better scrollbar for layer control */
    .leaflet-control-layers-list {
      max-height: 200px !important;
      overflow-y: auto !important;
      padding-right: 5px !important;
    }

    /* Light theme adjustments */
    body.light-theme .leaflet-control-layers-expanded {
      background: var(--card-bg) !important;
      border-color: rgba(0, 0, 0, 0.1) !important;
    }

    body.light-theme .leaflet-control-layers label {
      color: var(--light) !important;
    }

    body.light-theme .leaflet-control-layers-toggle {
      background-color: var(--card-bg) !important;
      border-color: rgba(0, 0, 0, 0.1) !important;
    }

    body.light-theme .leaflet-control-layers-toggle:before {
      color: var(--light) !important;
    }

    /* ===== AI SEARCH BUTTON ===== */
    .ai-search-button {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      cursor: pointer;
      z-index: 999;
      box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      animation: pulse-glow 3s infinite;
    }

    .ai-search-button:hover {
      transform: scale(1.15) rotate(15deg);
      box-shadow: 0 15px 40px rgba(99, 102, 241, 0.5);
    }

    .ai-search-button:active {
      transform: scale(0.95);
    }

    @keyframes pulse-glow {

      0%,
      100% {
        box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
      }

      50% {
        box-shadow: 0 10px 40px rgba(99, 102, 241, 0.6), 0 0 30px rgba(99, 102, 241, 0.4);
      }
    }

    /* AI Search Modal */
    .ai-search-modal .modal-content {
      max-width: 500px;
      max-height: 80vh;
    }

    .search-input-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .search-input-container input {
      flex: 1;
      padding: 15px 20px;
      border-radius: 15px;
      border: 2px solid var(--card-border);
      background: var(--card-bg);
      color: var(--light);
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .search-input-container input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }

    .search-input-container button {
      padding: 15px 25px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .search-input-container button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
    }

    .search-input-container button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .search-results {
      max-height: 400px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .search-result-item {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .search-result-item:hover {
      transform: translateX(5px);
      border-color: var(--primary);
      background: rgba(99, 102, 241, 0.1);
    }

    .search-result-item h4 {
      color: var(--light);
      margin-bottom: 8px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .search-result-item p {
      color: var(--gray);
      font-size: 14px;
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .search-result-item .result-meta {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 12px;
      color: var(--gray);
    }

    .result-meta span {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .result-meta i {
      color: var(--primary);
    }

    .search-loading {
      text-align: center;
      padding: 40px 20px;
    }

    .search-loading .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid var(--card-bg);
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .no-results {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
    }

    .no-results i {
      font-size: 48px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    /* ===== MOBILE FIXES ===== */
    @media (max-width: 768px) {

      /* Ensure content doesn't hide under navbar */
      body {
        padding-top: 0;
      }

      /* Fix section visibility */
      section.active {
        padding-top: 90px !important;
        /* Extra space for fixed navbar */
      }

      /* Fix all section titles */
      h2.section-title {
        margin-top: 10px !important;
        padding-top: 10px !important;
        font-size: 1.8rem !important;
        line-height: 1.3;
      }

      /* Fix home page cards */
      .dashboard-cards {
        margin-top: 30px;
      }

      /* Fix navbar items spacing */
      .nav-logo {
        flex: 1;
        min-width: 0;
      }

      .nav-actions {
        flex: 0;
      }

      /* Make sure text doesn't overflow */
      .hero-title,
      .section-title,
      .card-title {
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
      }
    }

    /* Responsive adjustment for side-by-side layout */
    @media (max-width: 992px) {
      .dashboard-cards {
        grid-template-columns: 1fr;
      }

      .dashboard-cards .card:nth-child(n+3) {
        grid-column: span 1;
      }
    }

    /* GLOBAL HOVER FIX */
    .card:hover,
    .stat-item:hover,
    .alert-card:hover,
    .vision-card:hover,
    .mission-card:hover,
    .gpa-card:hover,
    .stat-card:hover,
    .contact-card:hover,
    .meal-card:hover,
    .location-item:hover,
    .opportunity-card:hover {
      transform: translateY(-5px) !important;
      z-index: 1 !important;
    }
  </style>
</head>

<body>

  <!-- Premium Login Page -->
  <!-- Premium Login Page - Instagram Style -->
  <div class="login-page" id="loginPage">
    <div class="login-background"></div>

    <div class="login-wrapper">
      <!-- Left side: Form -->
      <div class="login-form-container">
        <div class="login-form-card">
          <!-- Instagram-like logo -->
          <div class="login-brand">
            <div class="logo-circle">
              <i class="fas fa-graduation-cap"></i>
            </div>
            <h1 class="nerist-glow">NERIST One</h1>
            <p class="login-tagline">Smart Campus OS ⚛︎</p>
          </div>

          <form class="login-form" onsubmit="event.preventDefault(); performLoginFromPage()">
            <div class="input-group">
              <div class="input-field">
                <input type="text" id="loginUserId" class="login-input" placeholder=" " required>
                <span class="floating-label">ID Number</span>
                <div class="input-border"></div>
                <div class="input-underline"></div>
                <i class="fas fa-user input-icon"></i>
                <span class="focus-helper">Enter your NERIST ID number</span>
              </div>
            </div>

            <div class="input-group">
              <div class="input-field">
                <input type="password" id="loginUserPassword" class="login-input" placeholder=" " required>
                <span class="floating-label">Password</span>
                <div class="input-border"></div>
                <div class="input-underline"></div>
                <i class="fas fa-lock input-icon"></i>
                <span class="focus-helper">Minimum 8 characters</span>
              </div>
            </div>

            <div class="input-group">
              <div class="input-field">
                <select id="loginUserType" class="login-select" required>
                  <option value="" disabled selected>Select User Type</option>
                  <option value="student">Student</option>
                  <option value="admin">Admin</option>
                  <option value="mess">Mess Secretary</option>
                </select>
                <div class="select-line"></div>
              </div>
            </div>

            <button type="submit" class="login-button">
              <span>Login</span>
              <i class="fas fa-arrow-right"></i>
            </button>

            <div class="divider">
              <span>OR</span>
            </div>

            <button type="button" class="demo-login-button" onclick="quickDemoLogin()">
              <i class="fas fa-rocket"></i>
              <span>Quick Demo Access</span>
            </button>

            <div class="login-links">
              <a href="#" class="forgot-link">Forgot password?</a>
            </div>
          </form>
        </div>

        <div class="signup-prompt">
          <p>New to NERIST? <a href="#" class="signup-link">Get access</a></p>
        </div>

        <div class="app-links">
          <p>Get the app.</p>
          <div class="app-buttons">
            <a href="#" class="app-button">
              <i class="fab fa-google-play"></i>
              <span>Google Play</span>
            </a>
            <a href="#" class="app-button">
              <i class="fab fa-apple"></i>
              <span>App Store</span>
            </a>
          </div>
        </div>
      </div>

      <!-- Right side: Screenshot/Preview -->
      <div class="login-preview">
        <div class="preview-content">
          <div class="preview-phone">
            <div class="phone-frame">
              <div class="phone-screen">
                <div class="screen-content">
                  <div class="dashboard-preview">
                    <div class="preview-header">
                      <i class="fas fa-graduation-cap"></i>
                      <h3>NERIST One</h3>
                    </div>
                    <div class="preview-card">
                      <div class="preview-item">
                        <i class="fas fa-calendar-check"></i>
                        <span>Smart Attendance</span>
                      </div>
                      <div class="preview-item">
                        <i class="fas fa-utensils"></i>
                        <span>Mess System</span>
                      </div>
                      <div class="preview-item">
                        <i class="fas fa-shield-alt"></i>
                        <span>Campus Safety</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="phone-notch"></div>
            </div>
          </div>
          <div class="preview-text">
            <h2>Everything Campus, One Platform</h2>
            <p>Attendance • Mess • Navigation • Safety • Career</p>
          </div>
        </div>
      </div>
    </div>

    <div class="login-footer-global">
      <p>© 2026 NERIST One • Built with ❤️ for NERIST Innovation</p>
    </div>
  </div>

  <!-- Background Elements -->
  <div class="floating-elements" id="floatingElements"></div>

  <!-- Emergency Sound -->
  <audio id="emergencySound" preload="auto" style="display: none;">
    <source src="emergency_alarm.mp3" type="audio/mpeg">
    <source src="emergency_alarm.wav" type="audio/wav">
    <source src="emergency_alarm.ogg" type="audio/ogg">
    Your browser does not support the audio element.
  </audio>

  <!-- Navigation -->
  <nav id="navbar" style="display: none;">
    <div class="nav-logo" onclick="showPage('home')">
      <div class="nav-logo-icon">
        <i class="fas fa-graduation-cap"></i>
      </div>
      <h1 class="nerist-glow">NERIST One</h1>
    </div>

    <ul class="nav-menu" id="navMenu">
      <!-- Menu items will be populated based on user role -->
    </ul>

    <div class="nav-actions">
      <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
        <i class="fas fa-moon"></i>
      </button>
      <div class="user-avatar" onclick="toggleUserMenu(event)">
        <span id="userInitials">GU</span>
      </div>
      <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </nav>

  <!-- User Menu Modal -->
  <div class="modal" id="userModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('userModal')">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">User Profile</h2>
      <div class="modal-body">
        <div style="display: flex; align-items: center; gap: 25px; margin-bottom: 35px; flex-wrap: wrap;">
          <div class="user-avatar" style="width: 90px; height: 90px; font-size: 2.2rem;">
            <span id="profileInitials">GU</span>
          </div>
          <div>
            <h3 style="color: var(--light); margin-bottom: 8px; font-size: 1.5rem;" id="profileName">Guest User</h3>
            <p style="color: var(--gray); font-size: 1.05rem;" id="profileId">Please login</p>
            <p style="color: var(--gray); font-size: 1.05rem;" id="profileDept">Select your role</p>
            <p style="color: var(--primary); font-size: 1.05rem; font-weight: 600;" id="profileRole">Guest</p>
          </div>
        </div>

        <div style="margin-bottom: 30px;">
          <h4 style="color: var(--light); margin-bottom: 20px; font-size: 1.2rem;">Account Settings</h4>
          <button class="btn btn-outline" style="width: 100%; margin-bottom: 15px; padding: 15px;"
            onclick="editProfile()">
            <i class="fas fa-user-cog"></i> Edit Profile
          </button>
          <button class="btn btn-outline" style="width: 100%; margin-bottom: 15px; padding: 15px;"
            onclick="notificationSettings()">
            <i class="fas fa-bell"></i> Notifications
          </button>
          <button class="btn btn-outline" style="width: 100%; padding: 15px;" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- SOS Modal -->
  <div class="modal" id="sosModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('sosModal'); stopEmergencySound();">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">Emergency SOS Activated</h2>
      <div class="modal-body">
        <p>Your SOS alert has been sent to campus security, wardens, and nearby peers.</p>
        <p>Your current location has been shared with emergency contacts.</p>
        <p><strong>Help is on the way. Stay calm and find a safe location if possible.</strong></p>
      </div>
      <button class="btn btn-primary" onclick="closeModal('sosModal'); stopEmergencySound();">Cancel SOS</button>
    </div>
  </div>

  <!-- Add Attendance Modal -->
  <div class="modal" id="addAttendanceModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('addAttendanceModal')">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">Mark Group Attendance</h2>
      <div class="modal-body">
        <div class="form-group">
          <label for="attendanceDegree">Degree</label>
          <select id="attendanceDegree" class="form-control" onchange="updateYearOptions()">
            <option value="">Select Degree</option>
            <option value="btech">B.Tech</option>
            <option value="msc">M.Sc</option>
            <option value="mba">MBA</option>
            <option value="phd">Ph.D</option>
            <option value="bsc">B.Sc (Forestry)</option>
          </select>
        </div>

        <div class="form-group">
          <label for="attendanceYear">Year</label>
          <select id="attendanceYear" class="form-control" onchange="updateSemesterOptions()">
            <option value="">Select Year</option>
            <!-- Will be populated by JavaScript -->
          </select>
        </div>

        <div class="form-group">
          <label for="attendanceSemester">Semester</label>
          <select id="attendanceSemester" class="form-control">
            <option value="">Select Semester</option>
            <!-- Will be populated by JavaScript -->
          </select>
        </div>

        <div class="form-group">
          <label for="attendanceBranch">Branch/Department</label>
          <select id="attendanceBranch" class="form-control" onchange="loadStudentList()">
            <option value="">Select Branch</option>
            <option value="agricultural">Agricultural Engineering</option>
            <option value="civil">Civil Engineering</option>
            <option value="cse">Computer Science & Engineering</option>
            <option value="electrical">Electrical Engineering</option>
            <option value="ece">Electronics & Communication Engineering</option>
            <option value="mechanical">Mechanical Engineering</option>
            <option value="forestry">B.Sc. in Forestry</option>
          </select>
        </div>

        <div class="form-group">
          <label for="attendanceSubject">Subject</label>
          <select id="attendanceSubject" class="form-control">
            <option value="">Select Subject</option>
            <option value="cs301">Data Structures (CS-301)</option>
            <option value="cs302">Algorithms Lab (CS-302)</option>
            <option value="cs303">Computer Networks (CS-303)</option>
            <option value="math">Mathematics</option>
            <option value="physics">Physics</option>
            <option value="english">English Communication</option>
            <option value="chemistry">Chemistry</option>
            <option value="workshop">Workshop Practice</option>
          </select>
        </div>

        <div class="form-group">
          <label>Attendance Status for Selected Students</label>
          <div style="display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="radio" name="status" value="present" checked>
              <span class="status-badge status-present">Present</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="radio" name="status" value="absent">
              <span class="status-badge status-absent">Absent</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="radio" name="status" value="late">
              <span class="status-badge status-late">Late</span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <label>Student List</label>
            <div>
              <button class="btn btn-outline" style="padding: 8px 16px; font-size: 0.85rem;"
                onclick="selectAllStudents()">
                <i class="fas fa-check-square"></i> Select All
              </button>
              <button class="btn btn-outline" style="padding: 8px 16px; font-size: 0.85rem; margin-left: 10px;"
                onclick="deselectAllStudents()">
                <i class="fas fa-square"></i> Deselect All
              </button>
            </div>
          </div>

          <div id="studentListContainer"
            style="max-height: 300px; overflow-y: auto; padding: 15px; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--card-border);">
            <p style="color: var(--gray); text-align: center; padding: 30px;">
              Please select Degree, Year, Semester, and Branch to load student list
            </p>
          </div>
        </div>
      </div>

      <div style="display: flex; gap: 15px;">
        <button class="btn btn-secondary" onclick="closeModal('addAttendanceModal')" style="flex: 1;">Cancel</button>
        <button class="btn btn-primary" onclick="addGroupAttendance()" style="flex: 2;">
          <i class="fas fa-check-double"></i> Mark Selected Students
        </button>
      </div>
    </div>
  </div>

  <!-- Mess Management Modal -->
  <div class="modal" id="messManageModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('messManageModal')">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">Manage Mess Menu</h2>
      <div class="modal-body">
        <div class="form-group">
          <label for="mealType">Meal Type</label>
          <select id="mealType" class="form-control">
            <option value="breakfast">Breakfast</option>
            <option value="lunch">Lunch</option>
            <option value="dinner">Dinner</option>
          </select>
        </div>
        <div class="form-group">
          <label for="mealDate">Date</label>
          <input type="date" id="mealDate" class="form-control" value="2026-05-15">
        </div>
        <div class="form-group">
          <label for="menuItems">Menu Items (comma separated)</label>
          <textarea id="menuItems" class="form-control" rows="3" placeholder="e.g., Rice, Dal, Roti, Paneer"></textarea>
        </div>
        <div class="form-group">
          <label for="predictedDemand">Predicted Demand (%)</label>
          <input type="range" id="predictedDemand" class="form-control" min="0" max="100" value="75">
          <span id="demandValue" style="color: var(--primary); font-weight: 600;">75%</span>
        </div>
        <div class="form-group">
          <label for="mealActive">Meal Active</label>
          <div style="display: flex; gap: 20px; margin-top: 10px; flex-wrap: wrap;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="radio" name="mealActive" value="active" checked>
              <span style="color: var(--success); font-weight: 600;">Active</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="radio" name="mealActive" value="inactive">
              <span style="color: var(--danger); font-weight: 600;">Inactive</span>
            </label>
          </div>
        </div>
      </div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
        <button class="btn btn-primary" onclick="addFoodItem()">Add</button>
        <button class="btn btn-secondary" onclick="updateFoodItem()">Update</button>
        <button class="btn btn-danger" onclick="deleteFoodItem()">Delete</button>
      </div>
      <button class="btn btn-outline" style="width: 100%; margin-top: 20px;" onclick="addMessNotice()">
        <i class="fas fa-bullhorn"></i> Add Notice
      </button>
    </div>
  </div>

  <!-- Report Attendance Modal -->
  <div class="modal" id="reportAttendanceModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('reportAttendanceModal')">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">Report Attendance Issue</h2>
      <div class="modal-body">
        <div class="form-group">
          <label for="reportAttendanceDate">Attendance Date</label>
          <input type="date" id="reportAttendanceDate" class="form-control" value="2026-05-15">
        </div>

        <div class="form-group">
          <label for="reportSubject">Subject</label>
          <select id="reportSubject" class="form-control">
            <option value="">Select Subject</option>
            <option value="cs301">Data Structures (CS-301)</option>
            <option value="cs302">Algorithms Lab (CS-302)</option>
            <option value="cs303">Computer Networks (CS-303)</option>
            <option value="math">Mathematics</option>
            <option value="physics">Physics</option>
            <option value="english">English Communication</option>
          </select>
        </div>

        <div class="form-group">
          <label for="reportIssueType">Issue Type</label>
          <select id="reportIssueType" class="form-control">
            <option value="">Select Issue Type</option>
            <option value="mark-missing">Marked absent but was present</option>
            <option value="wrong-subject">Wrong subject marked</option>
            <option value="wrong-time">Incorrect time recorded</option>
            <option value="technical">Technical error</option>
            <option value="other">Other issue</option>
          </select>
        </div>

        <div class="form-group">
          <label for="reportDetails">Detailed Explanation</label>
          <textarea id="reportDetails" class="form-control" rows="4"
            placeholder="Please provide details about the attendance issue..."></textarea>
        </div>

        <div class="form-group">
          <label for="reportEvidence">Supporting Evidence (Optional)</label>
          <div style="margin-top: 10px;">
            <div style="display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="checkbox" id="evidence-classwork">
                <span>Classwork/Notes</span>
              </label>
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="checkbox" id="evidence-peers">
                <span>Peer Verification</span>
              </label>
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="checkbox" id="evidence-other">
                <span>Other Evidence</span>
              </label>
            </div>
            <input type="file" id="fileUpload" class="form-control" style="display: none;">
            <button class="btn btn-outline" onclick="document.getElementById('fileUpload').click()"
              style="width: 100%; padding: 12px;">
              <i class="fas fa-upload"></i> Upload Supporting Document
            </button>
          </div>
        </div>

        <div class="form-group">
          <label>Preferred Resolution</label>
          <div style="margin-top: 10px;">
            <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; cursor: pointer;">
              <input type="radio" name="resolution" value="update" checked>
              <span>Update attendance record</span>
            </label>
            <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; cursor: pointer;">
              <input type="radio" name="resolution" value="meeting">
              <span>Schedule meeting with faculty</span>
            </label>
            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
              <input type="radio" name="resolution" value="review">
              <span>Review by department</span>
            </label>
          </div>
        </div>
      </div>

      <div style="display: flex; gap: 15px;">
        <button class="btn btn-secondary" onclick="closeModal('reportAttendanceModal')" style="flex: 1;">
          Cancel
        </button>
        <button class="btn btn-primary" onclick="submitAttendanceReport()" style="flex: 2;">
          <i class="fas fa-paper-plane"></i> Submit Report
        </button>
      </div>
    </div>
  </div>

  <!-- Full Schedule Modal -->
  <div class="modal" id="scheduleModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('scheduleModal')">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">Complete Schedule</h2>
      <div class="modal-body">
        <div id="fullScheduleContent">
          <!-- Full schedule will be populated here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Career Opportunity Management Modal -->
  <div class="modal" id="careerManageModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('careerManageModal')">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">Manage Career Opportunity</h2>
      <div class="modal-body">
        <div class="form-group">
          <label for="opportunityTitle">Opportunity Title</label>
          <input type="text" id="opportunityTitle" class="form-control" placeholder="e.g., Google Summer Internship">
        </div>
        <div class="form-group">
          <label for="opportunityType">Type</label>
          <select id="opportunityType" class="form-control">
            <option value="scholarship">Scholarship</option>
            <option value="internship">Internship</option>
            <option value="fellowship">Fellowship</option>
            <option value="placement">Placement</option>
          </select>
        </div>
        <div class="form-group">
          <label for="opportunityDetails">Details</label>
          <textarea id="opportunityDetails" class="form-control" rows="4"
            placeholder="Detailed description..."></textarea>
        </div>
        <div class="form-group">
          <label for="opportunityDeadline">Deadline</label>
          <input type="date" id="opportunityDeadline" class="form-control">
        </div>
        <div class="form-group">
          <label for="eligibilityCriteria">Eligibility Criteria</label>
          <textarea id="eligibilityCriteria" class="form-control" rows="3"
            placeholder="CGPA requirements, year, department, etc."></textarea>
        </div>
      </div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
        <button class="btn btn-primary" onclick="addCareerOpportunity()">Add</button>
        <button class="btn btn-secondary" onclick="updateCareerOpportunity()">Update</button>
        <button class="btn btn-danger" onclick="deleteCareerOpportunity()">Delete</button>
      </div>
    </div>
  </div>

  <!-- Privacy Policy Modal -->
  <div class="modal" id="privacyModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('privacyModal')">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">Privacy Policy</h2>
      <div class="modal-body">
        <div style="margin-bottom: 25px;">
          <h3 style="color: var(--light); margin-bottom: 15px;">NERIST One - Privacy Commitment</h3>
          <p>We respect your privacy and are committed to protecting your personal data. This privacy policy explains
            how we handle your information within the NERIST One platform.</p>
        </div>

        <div style="margin-bottom: 25px;">
          <h4 style="color: var(--light); margin-bottom: 10px;">Data We Collect</h4>
          <ul style="padding-left: 20px; color: var(--gray);">
            <li>Student ID and academic information</li>
            <li>Attendance records (for academic purposes only)</li>
            <li>Meal preferences (for mess optimization)</li>
            <li>Emergency contact information</li>
          </ul>
        </div>

        <div style="margin-bottom: 25px;">
          <h4 style="color: var(--light); margin-bottom: 10px;">How We Use Your Data</h4>
          <ul style="padding-left: 20px; color: var(--gray);">
            <li>To provide campus services and facilities</li>
            <li>To ensure campus safety and security</li>
            <li>To improve academic and hostel services</li>
            <li>For emergency response purposes only</li>
          </ul>
        </div>

        <div style="margin-bottom: 25px;">
          <h4 style="color: var(--light); margin-bottom: 10px;">Data Protection</h4>
          <ul style="padding-left: 20px; color: var(--gray);">
            <li>All data is encrypted and stored securely</li>
            <li>Only authorized NERIST personnel have access</li>
            <li>No data is shared with third parties without consent</li>
            <li>Data is retained only as long as necessary</li>
          </ul>
        </div>

        <div style="background: var(--card-bg); padding: 20px; border-radius: 15px; margin-top: 30px;">
          <p style="color: var(--light); margin-bottom: 10px;"><strong>Contact for Privacy Concerns:</strong></p>
          <p style="color: var(--gray); margin-bottom: 5px;">Email: registrar@nerist.ac.in</p>
          <p style="color: var(--gray); margin-bottom: 5px;">Phone: +91 360 2257401-408</p>
          <p style="color: var(--gray);">Office: Administration Block, NERIST Campus</p>
        </div>

        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--card-border);">
          <p style="color: var(--gray); font-size: 0.9rem;">
            <strong>Last Updated:</strong> May 15, 2026<br>
            <strong>Effective Date:</strong> May 15, 2026<br>
            <em>This is an official NERIST system - Your data is protected under Institute regulations.</em>
          </p>
        </div>
      </div>
      <button class="btn btn-primary" onclick="closeModal('privacyModal')" style="width: 100%; padding: 15px;">I
        Understand</button>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal" id="editProfileModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('editProfileModal')">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">Edit Profile</h2>
      <div class="modal-body">
        <div class="form-group">
          <label for="editName">Full Name</label>
          <input type="text" id="editName" class="form-control" placeholder="Enter your full name">
        </div>
        <div class="form-group">
          <label for="editEmail">Email Address</label>
          <input type="email" id="editEmail" class="form-control" placeholder="Enter your email">
        </div>
        <div class="form-group">
          <label for="editPhone">Phone Number</label>
          <input type="tel" id="editPhone" class="form-control" placeholder="Enter your phone number">
        </div>
        <div class="form-group">
          <label for="editDept">Department</label>
          <select id="editDept" class="form-control">
            <option value="Computer Science & Engineering">Computer Science & Engineering</option>
            <option value="Electronics & Communication Engineering">Electronics & Communication Engineering</option>
            <option value="Civil Engineering">Civil Engineering</option>
            <option value="Mechanical Engineering">Mechanical Engineering</option>
            <option value="Forestry">Forestry</option>
            <option value="Agriculture">Agriculture</option>
            <option value="Administration">Administration</option>
          </select>
        </div>
        <div class="form-group">
          <label for="editYear">Academic Year</label>
          <select id="editYear" class="form-control">
            <option value="1st Year">1st Year</option>
            <option value="2nd Year">2nd Year</option>
            <option value="3rd Year">3rd Year</option>
            <option value="4th Year">4th Year</option>
            <option value="5th Year">5th Year</option>
            <option value="Post Graduate">Post Graduate</option>
            <option value="PhD">PhD</option>
          </select>
        </div>
        <div class="form-group">
          <label for="editAvatarColor">Avatar Color</label>
          <div style="display: flex; gap: 15px; margin-top: 10px;">
            <button class="avatar-color-btn" data-color="primary"
              style="background: var(--primary); width: 40px; height: 40px; border-radius: 50%; border: 3px solid transparent;"></button>
            <button class="avatar-color-btn" data-color="secondary"
              style="background: var(--secondary); width: 40px; height: 40px; border-radius: 50%; border: 3px solid transparent;"></button>
            <button class="avatar-color-btn" data-color="nerist-green"
              style="background: var(--nerist-green); width: 40px; height: 40px; border-radius: 50%; border: 3px solid transparent;"></button>
            <button class="avatar-color-btn" data-color="accent-1"
              style="background: var(--accent-1); width: 40px; height: 40px; border-radius: 50%; border: 3px solid transparent;"></button>
            <button class="avatar-color-btn" data-color="accent-2"
              style="background: var(--accent-2); width: 40px; height: 40px; border-radius: 50%; border: 3px solid transparent;"></button>
          </div>
        </div>
        <div class="form-group">
          <label>Email Preferences</label>
          <div style="margin-top: 10px;">
            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
              <input type="checkbox" id="emailAttendance" checked>
              <span>Attendance updates</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
              <input type="checkbox" id="emailMess" checked>
              <span>Mess menu changes</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
              <input type="checkbox" id="emailCareer" checked>
              <span>Career opportunities</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
              <input type="checkbox" id="emailAlerts">
              <span>Campus alerts</span>
            </label>
          </div>
        </div>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <button class="btn btn-secondary" onclick="closeModal('editProfileModal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Notification Settings Modal -->
  <div class="modal" id="notificationSettingsModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('notificationSettingsModal')">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">Notification Settings</h2>
      <div class="modal-body">
        <div class="form-group">
          <label>Push Notifications</label>
          <div style="margin-top: 10px;">
            <label
              style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; cursor: pointer; padding: 12px; background: var(--card-bg); border-radius: 12px;">
              <span>Enable Push Notifications</span>
              <label class="toggle-switch">
                <input type="checkbox" id="pushNotifications" checked>
                <span class="toggle-slider"></span>
              </label>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>Notification Types</label>
          <div style="margin-top: 10px;">
            <label
              style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer; padding: 12px; background: var(--card-bg); border-radius: 12px;">
              <input type="checkbox" id="notifyAttendance" checked>
              <span>Attendance updates</span>
            </label>
            <label
              style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer; padding: 12px; background: var(--card-bg); border-radius: 12px;">
              <input type="checkbox" id="notifyMess" checked>
              <span>Mess menu & bookings</span>
            </label>
            <label
              style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer; padding: 12px; background: var(--card-bg); border-radius: 12px;">
              <input type="checkbox" id="notifyCareer" checked>
              <span>Career opportunities</span>
            </label>
            <label
              style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer; padding: 12px; background: var(--card-bg); border-radius: 12px;">
              <input type="checkbox" id="notifySafety" checked>
              <span>Safety alerts</span>
            </label>
            <label
              style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer; padding: 12px; background: var(--card-bg); border-radius: 12px;">
              <input type="checkbox" id="notifyCampusAlerts" checked>
              <span>Campus announcements</span>
            </label>
            <label
              style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer; padding: 12px; background: var(--card-bg); border-radius: 12px;">
              <input type="checkbox" id="notifyEvents">
              <span>Events & workshops</span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>Notification Frequency</label>
          <select id="notificationFrequency" class="form-control">
            <option value="immediate">Immediate</option>
            <option value="hourly">Hourly digest</option>
            <option value="daily">Daily digest</option>
            <option value="weekly">Weekly summary</option>
          </select>
        </div>

        <div class="form-group">
          <label>Quiet Hours</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
            <div>
              <label for="quietStart">Start Time</label>
              <input type="time" id="quietStart" class="form-control" value="22:00">
            </div>
            <div>
              <label for="quietEnd">End Time</label>
              <input type="time" id="quietEnd" class="form-control" value="06:00">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Sound & Vibration</label>
          <div style="margin-top: 10px;">
            <label
              style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; cursor: pointer; padding: 12px; background: var(--card-bg); border-radius: 12px;">
              <span>Play sound for notifications</span>
              <label class="toggle-switch">
                <input type="checkbox" id="soundEnabled" checked>
                <span class="toggle-slider"></span>
              </label>
            </label>
            <label
              style="display: flex; align-items: center; justify-content: space-between; cursor: pointer; padding: 12px; background: var(--card-bg); border-radius: 12px;">
              <span>Vibrate on notifications</span>
              <label class="toggle-switch">
                <input type="checkbox" id="vibrationEnabled" checked>
                <span class="toggle-slider"></span>
              </label>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>Test Notification</label>
          <div style="margin-top: 10px;">
            <button class="btn btn-outline" style="width: 100%; padding: 12px;" onclick="testNotification()">
              <i class="fas fa-bell"></i> Send Test Notification
            </button>
          </div>
        </div>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <button class="btn btn-secondary" onclick="resetNotificationSettings()">Reset to Default</button>
        <button class="btn btn-primary" onclick="saveNotificationSettings()">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- Main Content Sections -->
  <section id="home" class="active">
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title glow">Smart Campus OS ⚛︎</h1>
        <p class="hero-subtitle">One unified platform integrating attendance tracking, campus safety, hostel management,
          disaster alerts, navigation, and career opportunities for NERIST.</p>


        <div class="dashboard-cards">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Today's Schedule</h3>
              <i class="fas fa-calendar-day card-icon"></i>
            </div>
            <div class="card-body">
              <div class="schedule-items" id="scheduleItems">
                <div class="schedule-item">
                  <div class="schedule-time">
                    <i class="far fa-clock"></i> 9:00 AM
                  </div>
                  <div class="schedule-detail">Data Structures (CS-301) - Room 201</div>
                </div>
                <div class="schedule-item">
                  <div class="schedule-time">
                    <i class="far fa-clock"></i> 11:00 AM
                  </div>
                  <div class="schedule-detail">Algorithms Lab (CS-302) - Lab 3</div>
                </div>
                <div class="schedule-item">
                  <div class="schedule-time">
                    <i class="far fa-clock"></i> 2:00 PM
                  </div>
                  <div class="schedule-detail">Computer Networks (CS-303) - Room 305</div>
                </div>
                <div class="schedule-item">
                  <div class="schedule-time">
                    <i class="far fa-clock"></i> 4:00 PM
                  </div>
                  <div class="schedule-detail">Project Meeting - Conference Room</div>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <span style="color: var(--gray); font-size: 1rem;">Next: Data Structures in 45 min</span>
              <button class="view-all-btn" id="viewScheduleBtn" onclick="toggleScheduleView()">
                View All <i class="fas fa-chevron-down"></i>
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Weather</h3>
              <i class="fas fa-cloud-sun card-icon"></i>
            </div>
            <div class="card-body">
              <div class="weather-info">
                <div class="weather-icon">
                  <i class="fas fa-sun" id="weatherIcon"></i>
                </div>
                <div class="weather-temp" id="weatherTemp">26°C</div>
                <div class="weather-location" id="weatherLocation">NERIST Campus</div>
                <div class="weather-details">
                  <div><i class="fas fa-wind"></i> <span id="weatherWind">12 km/h</span></div>
                  <div><i class="fas fa-tint"></i> <span id="weatherHumidity">65%</span></div>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-outline" style="padding: 10px 20px; font-size: 0.95rem;" onclick="updateWeather()">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
            </div>
          </div>
        </div>

        <!-- Campus Alerts Section -->
        <div style="margin-top: 80px;">
          <h2 class="section-title">Campus Alerts</h2>
          <p class="section-subtitle">Important announcements and notifications for the campus community</p>

          <div class="campus-alerts">
            <div class="alert-card">
              <div class="alert-icon">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
              <div class="alert-content">
                <h4>Library Closure</h4>
                <p>The library shall close at 2:00 AM daily.</p>
              </div>
            </div>

            <div class="alert-card">
              <div class="alert-icon">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="alert-content">
                <h4>Sports Complex Reopening</h4>
                <p>The sports complex is open daily for students.</p>
              </div>
            </div>

            <div class="alert-card">
              <div class="alert-icon">
                <i class="fas fa-info-circle"></i>
              </div>
              <div class="alert-content">
                <h4>Opportunities</h4>
                <p>Career opportunities are available on the Career section.</p>
              </div>
            </div>

            <div class="alert-card">
              <div class="alert-icon">
                <i class="fas fa-cloud-rain"></i>
              </div>
              <div class="alert-content">
                <h4>Weather Alert</h4>
                <p>Live weather updates are provided on the home page.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- About NERIST One Section -->
        <div class="about-nerist-section">
          <div class="about-content">
            <div class="about-text">
              <h2 class="nerist-glow">About NERIST One</h2>
              <p>NERIST One is a comprehensive Smart Campus Operating System ⚛︎ designed specifically for the North
                Eastern
                Regional Institute of Science and Technology. Our platform integrates all essential campus services into
                one unified, intuitive interface.</p>
              <p>From attendance tracking to emergency alerts, mess management to career opportunities - we've built a
                digital ecosystem that enhances campus life, improves safety, and streamlines administrative processes.
              </p>
            </div>

            <div class="card">
              <div class="card-header">
                <h3 class="card-title">System Features</h3>
                <i class="fas fa-cogs card-icon"></i>
              </div>
              <div class="card-body">
                <div
                  style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-check-circle" style="color: var(--success);"></i>
                    <span>Smart Attendance</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-check-circle" style="color: var(--success);"></i>
                    <span>Mess Management</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-check-circle" style="color: var(--success);"></i>
                    <span>AI Meal Planning</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-check-circle" style="color: var(--success);"></i>
                    <span>Campus Navigation</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-check-circle" style="color: var(--success);"></i>
                    <span>Results and Career</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-check-circle" style="color: var(--success);"></i>
                    <span>Emergency SOS</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Vision & Mission Section (Separated from About) -->
        <div style="margin: 100px 0; padding: 80px 0; animation: fadeInUp 0.8s ease 1.1s both;">
          <div class="vision-mission-grid">
            <div>
              <h3
                style="font-size: 1.8rem; margin-bottom: 20px; color: var(--light); display: flex; align-items: center; gap: 15px;">
                <i class="fas fa-eye" style="color: var(--secondary); font-size: 1.8rem;"></i> Our Vision
              </h3>
              <p style="color: var(--gray); line-height: 1.8; font-size: 1.1rem;">
                To create a fully connected, intelligent campus environment that empowers students, faculty, and staff
                through technology-driven solutions, fostering innovation and excellence in education.
              </p>
            </div>
            <div>
              <h3
                style="font-size: 1.8rem; margin-bottom: 20px; color: var(--light); display: flex; align-items: center; gap: 15px;">
                <i class="fas fa-bullseye" style="color: var(--secondary); font-size: 1.8rem;"></i> Our Mission
              </h3>
              <p style="color: var(--gray); line-height: 1.8; font-size: 1.1rem;">
                To provide a seamless digital experience that improves campus operations, enhances safety, fosters
                academic excellence, and transforms NERIST into a model smart campus for the nation.
              </p>
            </div>
          </div>
        </div>
        <div class="hero-stats">
          <div class="stat-item">
            <div class="stat-number" id="activeStudents">2,809</div>
            <div class="stat-label">Active Students</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="attendanceRate">94%</div>
            <div class="stat-label">Attendance Rate</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="liveAlerts">12</div>
            <div class="stat-label">Live Alerts</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="opportunities">28</div>
            <div class="stat-label">Opportunities</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Attendance Section -->
  <section id="attendance">
    <div class="container">
      <h2 class="section-title">Smart Attendance</h2>
      <p class="section-subtitle">Real-time attendance tracking with offline capabilities and detailed analytics for
        students and faculty.</p>

      <div class="attendance-container">
        <div class="attendance-chart-container">
          <div
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
            <h3 style="color: var(--light); font-size: 1.4rem;">Attendance Overview (This Month)</h3>
            <button class="btn btn-primary" onclick="openAddAttendanceModal()" id="addAttendanceBtn"
              style="display: none;">
              <i class="fas fa-plus"></i> Add Attendance
            </button>
          </div>
          <canvas id="attendanceChart" height="250"></canvas>

          <div class="attendance-table-container">
            <table class="attendance-table" id="attendanceTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Student ID</th>
                  <th>Subject</th>
                  <th>Status</th>
                  <th>Time</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Attendance data will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <div>
          <div class="attendance-stats">
            <div class="stat-card">
              <h4>Overall Attendance</h4>
              <div class="value present" id="overallAttendance">87%</div>
              <p style="color: var(--gray); font-size: 0.95rem;">This Semester</p>
            </div>
            <div class="stat-card">
              <h4>Classes Attended</h4>
              <div class="value present" id="classesAttended">42</div>
              <p style="color: var(--gray); font-size: 0.95rem;">Out of 48</p>
            </div>
            <div class="stat-card">
              <h4>Late Arrivals</h4>
              <div class="value absent" id="lateArrivals">6</div>
              <p style="color: var(--gray); font-size: 0.95rem;">This Month</p>
            </div>
            <div class="stat-card">
              <h4>Absences</h4>
              <div class="value absent" id="absences">3</div>
              <p style="color: var(--gray); font-size: 0.95rem;">This Month</p>
            </div>
          </div>

          <div class="card" style="margin-top: 35px;">
            <div class="card-header">
              <h3 class="card-title">Offline Mode</h3>
              <i class="fas fa-wifi card-icon"></i>
            </div>
            <div class="card-body">
              <p>Attendance works even without internet connectivity. Data syncs automatically when connection is
                restored.</p>
              <div id="syncStatus"
                style="margin-top: 20px; padding: 15px; background: rgba(34, 211, 238, 0.1); border-radius: 12px;">
                <span style="color: var(--success); font-weight: 600;">
                  <i class="fas fa-check-circle"></i> Last sync: 10 minutes ago
                </span>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-outline" style="padding: 10px 20px; font-size: 0.95rem;" onclick="forceSync()">
                <i class="fas fa-sync-alt"></i> Sync Now
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Mess Section -->
  <section id="mess">
    <div class="container">
      <h2 class="section-title">Hostel & Mess System</h2>
      <p class="section-subtitle">AI-powered meal planning, waste reduction analytics, and digital meal booking system.
      </p>

      <div class="attendance-container">
        <div>
          <!-- Replace this section in the mess section -->
          <div
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
            <h3 style="color: var(--light); font-size: 1.5rem;">Today's Menu</h3>
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
              <button class="btn btn-outline" onclick="showPreviousDay()" style="padding: 10px 20px;">
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span
                style="color: var(--light); font-weight: 600; padding: 10px 20px; background: var(--card-bg); border-radius: 12px; min-width: 150px; text-align: center;">
                May 15, 2026
              </span>
              <button class="btn btn-outline" onclick="showNextDay()" style="padding: 10px 20px;">
                Next <i class="fas fa-chevron-right"></i>
              </button>
              <button class="btn btn-primary" onclick="openMessManageModal()" id="messManageBtn" style="display: none;">
                <i class="fas fa-edit"></i> Manage
              </button>
            </div>
          </div>

          <div class="meal-card">
            <div class="meal-time">
              <i class="fas fa-sun"></i> Breakfast (7:00 - 9:00 AM)
            </div>
            <div class="meal-items">
              <span class="meal-item">Poha</span>
              <span class="meal-item">Bread & Butter</span>
              <span class="meal-item">Boiled Eggs</span>
              <span class="meal-item">Tea/Coffee</span>
            </div>
            <div class="meal-stats">
              <span style="color: var(--gray);">AI Predicted demand: <strong
                  style="color: var(--light);">85%</strong></span>
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="checkbox" checked>
                <span style="color: var(--success);">
                  <i class="fas fa-check-circle"></i> Booked
                </span>
              </label>
            </div>
          </div>

          <div class="meal-card">
            <div class="meal-time">
              <i class="fas fa-cloud-sun"></i> Lunch (12:30 - 2:30 PM)
            </div>
            <div class="meal-items">
              <span class="meal-item">Rice</span>
              <span class="meal-item">Roti</span>
              <span class="meal-item">Dal Fry</span>
              <span class="meal-item">Paneer Butter Masala</span>
              <span class="meal-item">Mix Veg</span>
              <span class="meal-item">Salad</span>
            </div>
            <div class="meal-stats">
              <span style="color: var(--gray);">AI Predicted demand: <strong
                  style="color: var(--light);">92%</strong></span>
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="checkbox" checked>
                <span style="color: var(--success);">
                  <i class="fas fa-check-circle"></i> Booked
                </span>
              </label>
            </div>
          </div>

          <!-- Inactive Dinner Card -->
          <div class="meal-card inactive" id="dinnerCard">
            <div class="meal-time">
              <i class="fas fa-moon"></i> Dinner (7:30 - 9:30 PM)
              <span class="inactive-badge" id="inactiveBadge">
                <i class="fas fa-times-circle"></i> Inactive
              </span>
            </div>
            <div class="meal-items">
              <span class="meal-item">Jeera Rice</span>
              <span class="meal-item">Roti</span>
              <span class="meal-item">Chole Masala</span>
              <span class="meal-item">Aloo Gobhi</span>
              <span class="meal-item">Raita</span>
            </div>
            <div class="meal-stats">
              <span style="color: var(--gray);">AI Predicted demand: <strong
                  style="color: var(--light);">78%</strong></span>
              <span style="color: var(--danger);">
                <i class="fas fa-info-circle"></i> Inactive - Only mess secretary can activate
              </span>
            </div>
          </div>

          <div style="margin-top: 50px;">
            <div
              style="display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
              <span style="color: var(--light); font-weight: 600;">AI Prediction Accuracy</span>
              <span style="color: var(--primary); font-weight: 600;">75%</span>
            </div>
            <div class="prediction-meter">
              <div class="prediction-fill"></div>
            </div>
          </div>
        </div>

        <div>
          <h3 style="margin-bottom: 25px; color: var(--light); font-size: 1.5rem;">Mess Analytics</h3>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Waste Reduction</h3>
              <i class="fas fa-recycle card-icon"></i>
            </div>
            <div class="card-body">
              <p>Compared to last month, food waste has reduced by <strong style="color: var(--success);">32%</strong>
                due to AI-based meal planning.</p>
              <div style="margin-top: 25px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                  <span style="color: var(--gray);">This Month</span>
                  <span style="color: var(--light); font-weight: 600;">₹8,500</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                  <span style="color: var(--gray);">Last Month</span>
                  <span style="color: var(--light); font-weight: 600;">₹12,500</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top: 25px;">
            <div class="card-header">
              <h3 class="card-title">Meal Booking</h3>
              <i class="fas fa-calendar-check card-icon"></i>
            </div>
            <div class="card-body">
              <p>Book your meals in advance to help mess plan accurately and reduce waste.</p>
              <div style="margin-top: 25px;">
                <div
                  style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 18px; margin-bottom: 25px;">
                  <button class="btn btn-outline" style="padding: 12px;" onclick="bookMeal('breakfast')">
                    <i class="fas fa-sun"></i> Breakfast
                  </button>
                  <button class="btn btn-outline" style="padding: 12px;" onclick="bookMeal('lunch')">
                    <i class="fas fa-cloud-sun"></i> Lunch
                  </button>
                  <button class="btn btn-outline" style="padding: 12px;" onclick="bookMeal('dinner')" id="bookDinnerBtn"
                    disabled>
                    <i class="fas fa-moon"></i> Dinner
                  </button>
                  <button class="btn btn-primary" style="padding: 12px;" onclick="bookAllMeals()" id="bookAllBtn">
                    <i class="fas fa-check-double"></i> All
                  </button>
                </div>
                <div>
                  <label for="bookingDate" style="display: block; margin-bottom: 10px; color: var(--gray);">Booking
                    Date:</label>
                  <input type="date" id="bookingDate" class="form-control" value="2026-05-15">
                </div>
              </div>
            </div>
          </div>

          <!-- Feedback & Ratings Card - Hidden for Mess Secretary -->
          <div class="card" style="margin-top: 25px;" id="feedbackCard">
            <div class="card-header">
              <h3 class="card-title">Feedback & Ratings</h3>
              <i class="fas fa-star card-icon"></i>
            </div>
            <div class="card-body">
              <p>Rate today's meals and provide feedback to improve mess quality.</p>
              <div style="margin-top: 25px; text-align: center;">
                <div style="font-size: 2.2rem; color: var(--warning); margin-bottom: 20px;">
                  <div class="star-rating">
                    <input type="radio" id="star5" name="rating" value="5" />
                    <label for="star5" title="5 stars">★</label>
                    <input type="radio" id="star4" name="rating" value="4" />
                    <label for="star4" title="4 stars">★</label>
                    <input type="radio" id="star3" name="rating" value="3" />
                    <label for="star3" title="3 stars">★</label>
                    <input type="radio" id="star2" name="rating" value="2" />
                    <label for="star2" title="2 stars">★</label>
                    <input type="radio" id="star1" name="rating" value="1" />
                    <label for="star1" title="1 star">★</label>
                  </div>
                  <span style="font-size: 1.2rem; color: var(--light); margin-left: 12px;" id="currentRating">Not
                    Rated</span>
                </div>
                <textarea id="feedbackText" class="form-control" rows="3" placeholder="Your feedback..."
                  style="margin-bottom: 20px;"></textarea>
                <button class="btn btn-outline" style="width: 100%; padding: 15px;" onclick="submitFeedback()">
                  <i class="fas fa-paper-plane"></i> Submit Feedback
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Navigation Section -->
  <section id="navigation">
    <div class="container">
      <h2 class="section-title">Campus Navigation</h2>
      <p class="section-subtitle">Interactive campus maps with indoor navigation and real-time directions.</p>

      <div class="navigation-container">
        <div>
          <div class="map-container">
            <!-- Leaflet Interactive Map -->
            <div id="neristMap"></div>
            <div class="map-overlay" id="mapOverlay">
              <h3>NERIST Campus Map</h3>
              <p>Interactive map showing all campus locations. Click on markers for details.</p>
              <p><strong>Zoom in/out and drag to explore campus</strong></p>
              <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="hideMapOverlay()">
                  <i class="fas fa-play"></i> Start Exploring
                </button>
                <button class="btn btn-outline" onclick="centerMapToUser()">
                  <i class="fas fa-location-arrow"></i> My Location
                </button>
              </div>
            </div>
          </div>

          <div style="margin-top: 50px;">
            <h3 style="margin-bottom: 25px; color: var(--light); font-size: 1.5rem;">Live Event Directions</h3>
            <div class="card">
              <div class="card-body">
                <div style="display: grid; grid-template-columns: 1fr; gap: 18px;">
                  <div
                    style="display: flex; justify-content: space-between; align-items: center; padding: 18px; background: var(--card-bg); border-radius: 12px; flex-wrap: wrap; gap: 15px;">
                    <div>
                      <strong style="color: var(--light);">🎤 Tech Talk - Auditorium</strong>
                      <p style="color: var(--gray); margin-top: 8px;">Ends: 4:00 PM • 0.8km away</p>
                    </div>
                    <button class="btn btn-outline" style="padding: 10px 20px;" onclick="getDirections('auditorium')">
                      <i class="fas fa-directions"></i> Go
                    </button>
                  </div>
                  <div
                    style="display: flex; justify-content: space-between; align-items: center; padding: 18px; background: var(--card-bg); border-radius: 12px; flex-wrap: wrap; gap: 15px;">
                    <div>
                      <strong style="color: var(--light);">🏀 Basketball Tournament</strong>
                      <p style="color: var(--gray); margin-top: 8px;">Ends: 6:00 PM • 1.2km away</p>
                    </div>
                    <button class="btn btn-outline" style="padding: 10px 20px;"
                      onclick="getDirections('sports-complex')">
                      <i class="fas fa-directions"></i> Go
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div>
          <h3 style="margin-bottom: 25px; color: var(--light); font-size: 1.5rem;">Find Locations</h3>

          <div class="search-box">
            <input type="text" id="locationSearch" placeholder="Search for classrooms, offices, facilities..."
              onkeyup="searchLocations()">
            <button onclick="performSearch()"><i class="fas fa-search"></i></button>
          </div>

          <div class="location-list" id="locationList">
            <!-- Locations will be populated by JavaScript -->
          </div>

          <div class="card" style="margin-top: 35px;">
            <div class="card-header">
              <h3 class="card-title">Offline Navigation</h3>
              <i class="fas fa-wifi-slash card-icon"></i>
            </div>
            <div class="card-body">
              <p>Download campus maps for offline use. Navigate without internet connectivity.</p>
              <div style="margin-top: 25px;">
                <div style="margin-bottom: 18px;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: var(--light);">Main Campus Map</span>
                    <span style="color: var(--success);">✅ Downloaded</span>
                  </div>
                  <div style="height: 8px; background: var(--card-bg); border-radius: 4px; overflow: hidden;">
                    <div style="width: 100%; height: 100%; background: var(--success);"></div>
                  </div>
                </div>
                <div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: var(--light);">Indoor Maps</span>
                    <span style="color: var(--warning);">⚠ Partial (65%)</span>
                  </div>
                  <div style="height: 8px; background: var(--card-bg); border-radius: 4px; overflow: hidden;">
                    <div style="width: 65%; height: 100%; background: var(--warning);"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Career Section -->
  <section id="career">
    <div class="container">
      <h2 class="section-title">Scholarships & Internships</h2>
      <p class="section-subtitle">Personalized opportunity matching, deadline alerts, and application tracking for
        students.</p>

      <div class="career-container">
        <div>
          <div
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
            <h3 style="color: var(--light); font-size: 1.5rem;">Recommended For You</h3>
            <div>
              <button class="btn btn-secondary" onclick="openCareerManageModal()" id="careerManageBtn"
                style="display: none;">
                <i class="fas fa-cog"></i> Manage
              </button>
            </div>
          </div>

          <div class="opportunity-card" onclick="viewOpportunity('google-internship')">
            <div class="opportunity-header">
              <div class="opportunity-title">Google Summer Internship 2026</div>
              <div class="opportunity-type type-internship">Internship</div>
            </div>
            <div class="opportunity-details">
              Software engineering internship for 3rd/4th year CS students. Projects in ML, cloud computing, or Android
              development. Stipend: ₹90,000/month.
            </div>
            <div class="opportunity-footer">
              <div class="opportunity-deadline">
                <i class="far fa-clock"></i> Deadline: Jun 15, 2026
              </div>
              <div class="match-badge">98% Match</div>
            </div>
          </div>

          <div class="opportunity-card" onclick="viewOpportunity('nerist-scholarship')">
            <div class="opportunity-header">
              <div class="opportunity-title">NERIST Merit Scholarship</div>
              <div class="opportunity-type type-scholarship">Scholarship</div>
            </div>
            <div class="opportunity-details">
              Full tuition waiver for students with CGPA above 8.5. Additional monthly stipend of ₹5,000 for deserving
              candidates.
            </div>
            <div class="opportunity-footer">
              <div class="opportunity-deadline">
                <i class="far fa-clock"></i> Deadline: May 30, 2026
              </div>
              <div class="match-badge">92% Match</div>
            </div>
          </div>

          <div class="opportunity-card" onclick="viewOpportunity('microsoft-fellowship')">
            <div class="opportunity-header">
              <div class="opportunity-title">Microsoft Research Fellowship</div>
              <div class="opportunity-type type-fellowship">Fellowship</div>
            </div>
            <div class="opportunity-details">
              1-year research fellowship for final year students interested in AI/ML research. Includes mentorship and
              publication support.
            </div>
            <div class="opportunity-footer">
              <div class="opportunity-deadline">
                <i class="far fa-clock"></i> Deadline: Jul 10, 2026
              </div>
              <div class="match-badge">87% Match</div>
            </div>
          </div>

          <div class="opportunity-card" onclick="viewOpportunity('tcs-hiring')">
            <div class="opportunity-header">
              <div class="opportunity-title">TCS Campus Hiring</div>
              <div class="opportunity-type type-placement">Placement</div>
            </div>
            <div class="opportunity-details">
              Campus recruitment drive for 2026 batch. Positions in software development, testing, and consulting.
              Package: ₹8-12 LPA.
            </div>
            <div class="opportunity-footer">
              <div class="opportunity-deadline">
                <i class="far fa-clock"></i> Deadline: Aug 20, 2026
              </div>
              <div class="match-badge">85% Match</div>
            </div>
          </div>
        </div>

        <div>
          <h3 style="margin-bottom: 25px; color: var(--light); font-size: 1.5rem;">Application Tracker</h3>

          <!-- Application Tracker - For Students -->
          <div class="card" id="studentApplicationCard">
            <div class="card-header">
              <h3 class="card-title">Your Applications</h3>
              <i class="fas fa-tasks card-icon"></i>
            </div>
            <div class="card-body">
              <div style="margin-bottom: 30px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 18px;">
                  <div style="width: 14px; height: 14px; background: var(--success); border-radius: 50%;"></div>
                  <strong style="color: var(--light);">✅ Submitted (3)</strong>
                </div>
                <div style="padding-left: 26px;">
                  <p>• Infosys Internship</p>
                  <p>• MHRD Scholarship</p>
                  <p>• IEEE Conference Grant</p>
                </div>
              </div>

              <div style="margin-bottom: 30px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 18px;">
                  <div style="width: 14px; height: 14px; background: var(--warning); border-radius: 50%;"></div>
                  <strong style="color: var(--light);">⏳ In Progress (2)</strong>
                </div>
                <div style="padding-left: 26px;">
                  <p>• Google Internship</p>
                  <p>• Campus Ambassador Program</p>
                </div>
              </div>

              <div>
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 18px;">
                  <div style="width: 14px; height: 14px; background: var(--gray); border-radius: 50%;"></div>
                  <strong style="color: var(--light);">📅 Upcoming Deadlines (5)</strong>
                </div>
                <div style="padding-left: 26px;">
                  <p>• May 30: Merit Scholarship</p>
                  <p>• Jun 15: Google Internship</p>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-outline" style="padding: 10px 20px; font-size: 0.95rem;"
                onclick="viewAllApplications()">
                <i class="fas fa-list"></i> View All
              </button>
            </div>
          </div>

          <!-- Student Applications Tracker - For Admin Only -->
          <div class="card" id="adminApplicationsCard" style="display: none; margin-top: 25px;">
            <div class="card-header">
              <h3 class="card-title">Student Applications Tracker</h3>
              <i class="fas fa-user-check card-icon"></i>
            </div>
            <div class="card-body">
              <!-- Search and Filter Bar -->
              <div style="display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                  <input type="text" id="searchApplications" class="form-control"
                    placeholder="Search students or opportunities..." onkeyup="searchStudentApplications()">
                </div>
                <div>
                  <select id="applicationStatusFilter" class="form-control" onchange="filterApplications()"
                    style="min-width: 150px;">
                    <option value="all">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="accepted">Accepted</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>
                <button class="btn btn-primary" onclick="refreshApplications()">
                  <i class="fas fa-sync-alt"></i> Refresh
                </button>
              </div>

              <!-- Applications Table -->
              <div style="max-height: 400px; overflow-y: auto; margin-top: 20px;">
                <table class="attendance-table" id="studentApplicationsTable">
                  <thead>
                    <tr>
                      <th>Student ID</th>
                      <th>Student Name</th>
                      <th>Opportunity</th>
                      <th>Applied On</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="applicationsTableBody">
                    <!-- Applications will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>

              <!-- Statistics -->
              <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--card-border);">
                <div style="text-align: center;">
                  <div style="font-size: 1.8rem; color: var(--light); font-weight: 700;" id="totalApplications">0</div>
                  <div style="color: var(--gray); font-size: 0.9rem;">Total Applications</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-size: 1.8rem; color: var(--warning); font-weight: 700;" id="pendingApplications">0
                  </div>
                  <div style="color: var(--gray); font-size: 0.9rem;">Pending</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-size: 1.8rem; color: var(--success); font-weight: 700;" id="acceptedApplications">0
                  </div>
                  <div style="color: var(--gray); font-size: 0.9rem;">Accepted</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-size: 1.8rem; color: var(--danger); font-weight: 700;" id="rejectedApplications">0
                  </div>
                  <div style="color: var(--gray); font-size: 0.9rem;">Rejected</div>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-outline" onclick="downloadApplicationsReport()"
                style="padding: 10px 20px; font-size: 0.95rem;">
                <i class="fas fa-download"></i> Export Report
              </button>
              <button class="btn btn-primary" onclick="bulkUpdateApplications()"
                style="padding: 10px 20px; font-size: 0.95rem; margin-left: 10px;">
                <i class="fas fa-check-double"></i> Bulk Update
              </button>
            </div>
          </div>

          <div class="card" style="margin-top: 25px;">
            <div class="card-header">
              <h3 class="card-title">Profile Strength</h3>
              <i class="fas fa-chart-line card-icon"></i>
            </div>
            <div class="card-body">
              <p>Your profile matches <strong style="color: var(--light);">87%</strong> of top opportunities.</p>
              <div style="margin-top: 25px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px; flex-wrap: wrap;">
                  <span style="color: var(--light);">CGPA</span>
                  <span style="color: var(--success);">8.7/10 ✅</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px; flex-wrap: wrap;">
                  <span style="color: var(--light);">Projects</span>
                  <span style="color: var(--success);">4 completed ✅</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px; flex-wrap: wrap;">
                  <span style="color: var(--light);">Skills</span>
                  <span style="color: var(--warning);">Python, Java, SQL ⚠</span>
                </div>
              </div>
              <div style="margin-top: 30px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; flex-wrap: wrap;">
                  <span style="color: var(--gray);">Profile Completion</span>
                  <span style="color: var(--light); font-weight: 600;">87%</span>
                </div>
                <div style="height: 10px; background: var(--card-bg); border-radius: 5px; overflow: hidden;">
                  <div
                    style="width: 87%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 5px;">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Safety Section (Moved to last as requested) -->
  <section id="safety">
    <div class="container">
      <h2 class="section-title">Campus Safety & SOS</h2>
      <p class="section-subtitle">Instant emergency alerts, safety network, and real-time location sharing for campus
        security.</p>

      <div class="sos-button-container">
        <div class="sos-button" onclick="activateSOS()" id="sosBtn">
          <i class="fas fa-exclamation-triangle sos-icon"></i>
          <div class="sos-text">SOS</div>
        </div>

        <!-- Sound Controls -->
        <div class="sos-sound-controls">
          <div class="sound-toggle">
            <label for="enableSound">
              <input type="checkbox" id="enableSound" checked>
              <span>Enable Emergency Sound</span>
            </label>
          </div>

          <p
            style="color: var(--gray); margin-top: 25px; max-width: 500px; margin-left: auto; margin-right: auto; font-size: 1.1rem;">
            This will immediately alert campus security, nearby wardens, and others with your live location.
          </p>
        </div>

        <div class="safety-container">
          <div>
            <h3 style="margin-bottom: 25px; color: var(--light); font-size: 1.5rem;">Emergency Contacts</h3>
            <div class="emergency-contacts">
              <div class="contact-card" onclick="callEmergency('campus-security')">
                <i class="fas fa-shield-alt contact-icon"></i>
                <div class="contact-name">Campus Security</div>
                <div class="contact-role">24/7 Emergency</div>
                <div class="contact-number">+91 98765 43210</div>
              </div>
              <div class="contact-card" onclick="callEmergency('medical-center')">
                <i class="fas fa-user-md contact-icon"></i>
                <div class="contact-name">Medical Center</div>
                <div class="contact-role">Health Emergency</div>
                <div class="contact-number">+91 98620 85987</div>
              </div>
              <div class="contact-card" onclick="callEmergency('womens-warden')">
                <i class="fas fa-female contact-icon"></i>
                <div class="contact-name">Miss. Piyali Das</div>
                <div class="contact-role">Women's Warden</div>
                <div class="contact-number">+91 84150 23777</div>
              </div>
              <div class="contact-card" onclick="callEmergency('mens-warden')">
                <i class="fas fa-male contact-icon"></i>
                <div class="contact-name">Dr. Ashish Paul</div>
                <div class="contact-role">Men's Warden</div>
                <div class="contact-number">+91 70177 18821</div>
              </div>
            </div>

            <!-- Emergency Protocols -->
            <div class="card" style="margin-top: 35px;">
              <div class="card-header">
                <h3 class="card-title">Emergency Protocols</h3>
                <i class="fas fa-file-alt card-icon"></i>
              </div>
              <div class="card-body">
                <p>Access emergency procedures for medical issues, natural disasters, fire, and other critical
                  situations.
                </p>
                <div style="margin-top: 20px;">
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                    <button class="btn btn-outline" style="padding: 12px; font-size: 0.9rem;"
                      onclick="viewProtocol('medical')">
                      <i class="fas fa-heartbeat"></i> Medical
                    </button>
                    <button class="btn btn-outline" style="padding: 12px; font-size: 0.9rem;"
                      onclick="viewProtocol('fire')">
                      <i class="fas fa-fire"></i> Fire
                    </button>
                    <button class="btn btn-outline" style="padding: 12px; font-size: 0.9rem;"
                      onclick="viewProtocol('earthquake')">
                      <i class="fas fa-mountain"></i> Earthquake
                    </button>
                    <button class="btn btn-outline" style="padding: 12px; font-size: 0.9rem;"
                      onclick="viewProtocol('flood')">
                      <i class="fas fa-water"></i> Flood
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div>
            <h3 style="margin-bottom: 25px; color: var(--light); font-size: 1.5rem;">Safety Features</h3>

            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Safe Walk</h3>
                <i class="fas fa-walking card-icon"></i>
              </div>
              <div class="card-body">
                <p>Request a security escort or share your live location with friends when walking across campus at
                  night.
                </p>
                <div style="margin-top: 20px;">
                  <label for="safeWalkDuration"
                    style="display: block; margin-bottom: 10px; color: var(--gray);">Duration:</label>
                  <select id="safeWalkDuration" class="form-control">
                    <option value="15">15 minutes</option>
                    <option value="30">30 minutes</option>
                    <option value="45">45 minutes</option>
                    <option value="60">1 hour</option>
                  </select>
                </div>
              </div>
              <div class="card-footer">
                <button class="btn btn-outline" style="padding: 10px 20px; font-size: 0.95rem;"
                  onclick="requestSafeWalk()">
                  <i class="fas fa-walking"></i> Request Escort
                </button>
              </div>
            </div>

            <!-- Evacuation Routes -->
            <div class="card" style="margin-top: 25px;">
              <div class="card-header">
                <h3 class="card-title">Evacuation Routes</h3>
                <i class="fas fa-route card-icon"></i>
              </div>
              <div class="card-body">
                <p>Designated safe zones and evacuation paths for different types of emergencies.</p>
                <div style="margin-top: 25px;">
                  <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 18px; margin-bottom: 25px;">
                    <button class="btn btn-outline" style="padding: 12px;" onclick="showRoute('landslide')">
                      <i class="fas fa-mountain"></i> Landslide
                    </button>
                    <button class="btn btn-outline" style="padding: 12px;" onclick="showRoute('flood')">
                      <i class="fas fa-water"></i> Flood
                    </button>
                    <button class="btn btn-outline" style="padding: 12px;" onclick="showRoute('earthquake')">
                      <i class="fas fa-shield-alt"></i> Earthquake
                    </button>
                    <button class="btn btn-outline" style="padding: 12px;" onclick="showRoute('fire')">
                      <i class="fas fa-fire"></i> Fire
                    </button>
                  </div>
                  <div id="nearestSafeZone"
                    style="padding: 18px; background: rgba(34, 211, 238, 0.1); border-radius: 12px;">
                    <strong style="color: var(--light);">Nearest to you:</strong>
                    <p style="margin-top: 8px; color: var(--gray);">📍 Main Auditorium (Landslide/Flood) - 0.3km</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Emergency Kit Checklist -->
            <div class="card" style="margin-top: 25px;">
              <div class="card-header">
                <h3 class="card-title">Emergency Kit Checklist</h3>
                <i class="fas fa-first-aid card-icon"></i>
              </div>
              <div class="card-body">
                <p>Essential items to keep in your room for emergencies:</p>
                <div style="margin-top: 25px;">
                  <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px; cursor: pointer;">
                    <input type="checkbox" id="item1" checked>
                    <span>Flashlight & batteries</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px; cursor: pointer;">
                    <input type="checkbox" id="item2" checked>
                    <span>First aid kit</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px; cursor: pointer;">
                    <input type="checkbox" id="item3">
                    <span>Bottled water (2L)</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px; cursor: pointer;">
                    <input type="checkbox" id="item4">
                    <span>Non-perishable food</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </section>

  <!-- Results Section (Students Only) -->
  <section id="results" style="display: none;">
    <div class="container">
      <h2 class="section-title">Academic Results</h2>
      <p class="section-subtitle">Track your academic performance, view semester-wise grades, and monitor your CGPA
        progress.</p>

      <div class="results-container">
        <div>
          <!-- Semester Navigation -->
          <div class="semester-selector">
            <button class="semester-btn active" onclick="selectSemester(1)">
              <i class="fas fa-graduation-cap"></i> Semester 1
            </button>
            <button class="semester-btn" onclick="selectSemester(2)">
              <i class="fas fa-graduation-cap"></i> Semester 2
            </button>
            <button class="semester-btn" onclick="selectSemester(3)">
              <i class="fas fa-graduation-cap"></i> Semester 3
            </button>
            <button class="semester-btn" onclick="selectSemester(4)">
              <i class="fas fa-graduation-cap"></i> Semester 4
            </button>
            <button class="semester-btn" onclick="selectSemester(5)">
              <i class="fas fa-graduation-cap"></i> Semester 5
            </button>
            <button class="semester-btn" onclick="selectSemester(6)">
              <i class="fas fa-graduation-cap"></i> Semester 6
            </button>
          </div>

          <!-- GPA Display -->
          <div class="gpa-display">
            <div class="gpa-card">
              <div class="gpa-label">Current Semester SGPA</div>
              <div class="gpa-value" id="currentSGPA">8.75</div>
              <div class="gpa-status status-excellent">Excellent</div>
            </div>

            <div class="gpa-card">
              <div class="gpa-label">Cumulative CGPA</div>
              <div class="gpa-value" id="cumulativeCGPA">8.62</div>
              <div class="gpa-status status-good">Good Standing</div>
            </div>

            <div class="gpa-card">
              <div class="gpa-label">Credits Earned</div>
              <div class="gpa-value" id="creditsEarned">128</div>
              <div class="gpa-status status-excellent">On Track</div>
            </div>
          </div>

          <!-- Results Table -->
          <div class="results-table-container">
            <table class="results-table" id="resultsTable">
              <thead>
                <tr>
                  <th>Subject Code</th>
                  <th>Subject Name</th>
                  <th>Credits</th>
                  <th>Grade</th>
                  <th>Grade Points</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <!-- Results will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <div>
          <!-- Academic Progress Chart -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Academic Progress</h3>
              <i class="fas fa-chart-line card-icon"></i>
            </div>
            <div class="card-body">
              <p>Your academic journey at NERIST - track your performance across semesters.</p>

              <div class="progress-chart-container">
                <canvas id="progressChart" height="250"></canvas>
              </div>

              <!-- Timeline View -->
              <div style="margin-top: 40px;">
                <h4 style="color: var(--light); margin-bottom: 20px; font-size: 1.2rem;">Semester Timeline</h4>
                <div class="progress-timeline" id="semesterTimeline">
                  <!-- Timeline will be populated by JavaScript -->
                </div>
              </div>
            </div>
          </div>

          <!-- Performance Summary -->
          <div class="card" style="margin-top: 30px;">
            <div class="card-header">
              <h3 class="card-title">Performance Summary</h3>
              <i class="fas fa-award card-icon"></i>
            </div>
            <div class="card-body">
              <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 20px; margin-top: 20px;">
                <div style="text-align: center;">
                  <div style="font-size: 2rem; color: var(--success); font-weight: 700;" id="totalSubjects">24</div>
                  <div style="color: var(--gray); font-size: 0.9rem;">Subjects Completed</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-size: 2rem; color: var(--primary); font-weight: 700;" id="totalCredits">128</div>
                  <div style="color: var(--gray); font-size: 0.9rem;">Credits Earned</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-size: 2rem; color: var(--secondary); font-weight: 700;" id="averageGrade">8.6</div>
                  <div style="color: var(--gray); font-size: 0.9rem;">Average Grade</div>
                </div>
              </div>

              <div style="margin-top: 30px;">
                <h4 style="color: var(--light); margin-bottom: 15px; font-size: 1.1rem;">Grade Distribution</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                  <div
                    style="background: rgba(16, 185, 129, 0.1); padding: 12px; border-radius: 10px; text-align: center;">
                    <div style="font-weight: 600; color: var(--success);">A/A+</div>
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--light);" id="gradeA">14</div>
                  </div>
                  <div
                    style="background: rgba(34, 211, 238, 0.1); padding: 12px; border-radius: 10px; text-align: center;">
                    <div style="font-weight: 600; color: var(--secondary);">B/B+</div>
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--light);" id="gradeB">8</div>
                  </div>
                  <div
                    style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 10px; text-align: center;">
                    <div style="font-weight: 600; color: var(--warning);">C/C+</div>
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--light);" id="gradeC">2</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-outline" style="padding: 10px 20px; font-size: 0.95rem;"
                onclick="downloadTranscript()">
                <i class="fas fa-download"></i> Download Transcript
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div style="text-align: center; margin-bottom: 40px;">
        <h3 style="color: var(--light); margin-bottom: 15px; font-size: 1.8rem;" class="nerist-glow">NERIST One</h3>
        <p style="color: var(--gray); font-size: 1.1rem;">Smart Campus Operating System ⚛︎</p>
        <p style="color: var(--gray); font-size: 1rem; margin-top: 8px;">Made by <strong
            style="color: var(--primary);">Project Saffron ॐ
          </strong></p>
      </div>

      <div class="footer-social">
        <a href="https://www.youtube.com/@nerist_official" target="_blank" class="social-icon yt">
          <i class="fab fa-youtube"></i>
        </a>
        <a href="https://www.instagram.com/nerist_nirjuli/?hl=en" target="_blank" class="social-icon insta">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="https://www.facebook.com/neristofficial/" target="_blank" class="social-icon fb">
          <i class="fab fa-facebook"></i>
        </a>
        <a href="https://www.linkedin.com/school/north-eastern-regional-institute-of-science-and-technology-nerist-/posts/?feedView=all"
          target="_blank" class="social-icon linkedin">
          <i class="fab fa-linkedin"></i>
        </a>
        <a href="https://x.com/neristofficial?lang=en" target="_blank" class="social-icon x">
          <i class="fab fa-twitter"></i>
        </a>
      </div>

      <div class="footer-links">
        <a href="#" onclick="showPage('home')">Home</a>
        <a href="#" onclick="showPage('attendance')">Attendance</a>
        <a href="#" onclick="showPage('mess')">Mess</a>
        <a href="#" onclick="showPage('navigation')">Navigation</a>
        <a href="#" onclick="showPage('career')">Career</a>
        <a href="#" onclick="showPage('safety')">Safety</a>
        <a href="#" onclick="contactSupport()">Contact Support</a>
        <a href="#" onclick="showPrivacyPolicy()">Privacy Policy</a>
      </div>

      <p style="margin-top: 40px; color: var(--gray); font-size: 1rem;">
        © 2026 NERIST One • Smart Campus Operating System ⚛︎ • Project Saffron ॐ
      </p>
      <p style="color: var(--gray); font-size: 0.9rem; margin-top: 15px;">
        <i class="fas fa-code"></i> Built with passion for NERIST innovation
      </p>
    </div>
  </footer>

 <!-- Include the backend system -->
  <script src="nerist_backend.js"></script>

  <script>
    // ===== GLOBAL VARIABLES =====
    let currentPage = 'home';
    let currentUser = null;
    let currentUserRole = 'guest';
    let attendanceData = [];
    let locations = [];
    let mealRating = null;
    let careerOpportunities = [];
    let messMenu = {};
    let isDinnerActive = false; // Dinner starts as inactive

    // ===== SOUND VARIABLES =====
    let emergencySound = null;
    let isSoundEnabled = true;
    let soundVolume = 0.7;
    let isSoundPlaying = false;
    let soundTimeout = null;

    // ===== WEATHER VARIABLES =====
    let weatherData = null;
    let lastWeatherUpdate = null;
    let weatherCacheKey = 'neristWeatherCache';
    let weatherRefreshInterval = 300000; // 5 minutes
    const NERIST_COORDS = { lat: 27.1297346, lng: 93.7429324 }; // NERIST coordinates

    // ===== MAP VARIABLES =====
    let neristMap = null;
    let campusMarkers = [];
    let userLocationMarker = null;
    let isMapOverlayVisible = true;

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', function () {
      // Initially hide all content except login page
      document.body.classList.remove('logged-in');

      initializeData();
      setupEventListeners();
      updateWeather();
      setInterval(updateWeather, weatherRefreshInterval);
      setInterval(simulateRealTimeUpdates, 30000);

      // GSAP Animations
      gsap.registerPlugin(ScrollTrigger);
      animateOnLoad();

      // Create login particles
      createLoginParticles();

      // Create floating elements
      createFloatingElements();

      // Check for saved user
      const savedUser = localStorage.getItem('neristUser');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        currentUserRole = currentUser.role;
        updateUserDisplay();
        updateRoleBasedUI();
        document.body.classList.add('logged-in');
        hideLoginPage();
        setupNavMenu();
      } else {
        // Show login page immediately
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('loginPage').classList.remove('hidden');
        document.body.classList.remove('logged-in');
      }
    });

    function createLoginParticles() {
      const particlesContainer = document.getElementById('loginParticles');
      for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'login-particle';
        particle.style.width = Math.random() * 10 + 2 + 'px';
        particle.style.height = particle.style.width;
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = Math.random() * 20 + 10 + 's';
        particle.style.opacity = Math.random() * 0.5 + 0.1;
        particlesContainer.appendChild(particle);
      }
    }

    function createFloatingElements() {
      const container = document.getElementById('floatingElements');
      for (let i = 0; i < 15; i++) {
        const element = document.createElement('div');
        element.className = 'floating-element';
        const size = Math.random() * 100 + 20;
        element.style.width = size + 'px';
        element.style.height = size + 'px';
        element.style.left = Math.random() * 100 + '%';
        element.style.top = Math.random() * 100 + '%';
        element.style.animationDuration = Math.random() * 30 + 20 + 's';
        element.style.animationDelay = Math.random() * 10 + 's';
        element.style.opacity = Math.random() * 0.1 + 0.05;

        // Random gradient color
        const hue = Math.random() * 360;
        element.style.background = `linear-gradient(135deg, hsl(${hue}, 100%, 65%), transparent)`;

        container.appendChild(element);
      }
    }

    function showLoginPage() {
      // Remove logged-in class to hide main content
      document.body.classList.remove('logged-in');

      // Reset the login page to visible state
      const loginPage = document.getElementById('loginPage');
      loginPage.style.display = 'flex';
      loginPage.classList.remove('hidden');
      loginPage.style.opacity = '1'; // Explicitly set opacity to 1

      // Reset form fields
      document.getElementById('loginUserId').value = '';
      document.getElementById('loginUserPassword').value = '';
      document.getElementById('loginUserType').value = 'student';

      // Animate the login page
      gsap.from(loginPage, {
        opacity: 0,
        y: 20,
        duration: 0.6,
        ease: 'power2.out'
      });

      // Also hide the navbar
      const navbar = document.getElementById('navbar');
      if (navbar) {
        navbar.style.display = 'none';
      }

      // Hide any open modals
      document.querySelectorAll('.modal.active').forEach(modal => {
        modal.classList.remove('active');
      });

      // Close mobile menu if open
      document.querySelector('.nav-menu').classList.remove('active');
    }

    function hideLoginPage() {
      const loginPage = document.getElementById('loginPage');

      gsap.to(loginPage, {
        opacity: 0,
        y: -20,
        duration: 0.6,
        ease: 'power2.in',
        onComplete: () => {
          loginPage.classList.add('hidden');
          // Show all content
          document.body.classList.add('logged-in');
          // Show navbar and content
          document.getElementById('navbar').style.display = 'flex';
          setupNavMenu();
        }
      });
    }

    function initializeData() {
      // Initialize attendance data
      attendanceData = [
        { date: '2026-05-15', subject: 'Data Structures', status: 'present', time: '09:05' },
        { date: '2026-05-15', subject: 'Algorithms Lab', status: 'present', time: '11:10' },
        { date: '2026-05-14', subject: 'Computer Networks', status: 'late', time: '14:15' },
        { date: '2026-05-13', subject: 'Mathematics', status: 'absent', time: '10:00' },
        { date: '2026-05-12', subject: 'Data Structures', status: 'present', time: '09:02' }
      ];

      // Initialize weather with cached data if available
      const cachedWeather = getCachedWeather();
      if (cachedWeather && isCacheValid(cachedWeather)) {
        weatherData = cachedWeather;
        updateWeatherUI(weatherData);
      } else {
        // Generate initial mock weather
        weatherData = generateMockWeather();
        updateWeatherUI(weatherData);
      }

      // Initialize locations
      // Change from Sikkim coordinates [27.1297346,93.7429324] to NERIST (Nirjuli) coordinates
      locations = [
        { name: 'Computer Science Department', desc: 'CSE Building, 2nd Floor | 0.4 km away', type: 'academic', coords: [27.1050, 93.7270] }, // NERIST coordinates
        { name: 'Central Library', desc: 'Main Building, Ground Floor | 0.7 km away', type: 'facility', coords: [27.1042, 93.7281] },
        { name: 'Administration Office', desc: 'Admin Block, 1st Floor | 0.5 km away', type: 'administrative', coords: [27.1056, 93.7268] },
        { name: 'Cafeteria', desc: 'Near Hostel Block | 0.3 km away', type: 'food', coords: [27.1039, 93.7262] },
        { name: 'Sports Complex', desc: 'East Campus | 1.2 km away', type: 'sports', coords: [27.1068, 93.7290] },
        { name: 'Medical Center', desc: 'Near Admin Block | 0.6 km away', type: 'medical', coords: [27.1041, 93.7279] },
        { name: 'Auditorium', desc: 'Central Campus | 0.8 km away', type: 'event', coords: [27.1053, 93.7284] },
        { name: 'Hostel Block A', desc: 'North Campus | 0.9 km away', type: 'hostel', coords: [27.1061, 93.7265] }
      ];


      // Initialize career opportunities
      careerOpportunities = [
        {
          id: 'google-internship',
          title: 'Google Summer Internship 2026',
          type: 'internship',
          details: 'Software engineering internship for 3rd/4th year CS students. Projects in ML, cloud computing, or Android development. Stipend: ₹90,000/month.',
          deadline: '2026-06-15',
          match: 98,
          eligibility: 'CGPA > 8.0, 3rd/4th year CS/IT students'
        },
        {
          id: 'nerist-scholarship',
          title: 'NERIST Merit Scholarship',
          type: 'scholarship',
          details: 'Full tuition waiver for students with CGPA above 8.5. Additional monthly stipend of ₹5,000 for deserving candidates.',
          deadline: '2026-05-30',
          match: 92,
          eligibility: 'CGPA > 8.5, all branches'
        }
      ];

      // Initialize mess menu with dinner inactive
      messMenu = {
        '2026-05-15': {
          breakfast: {
            items: ['Poha', 'Bread & Butter', 'Boiled Eggs', 'Tea/Coffee'],
            predictedDemand: 85,
            booked: true,
            active: true
          },
          lunch: {
            items: ['Rice', 'Roti', 'Dal Fry', 'Paneer Butter Masala', 'Mix Veg', 'Salad'],
            predictedDemand: 92,
            booked: true,
            active: true
          },
          dinner: {
            items: ['Jeera Rice', 'Roti', 'Chole Masala', 'Aloo Gobhi', 'Raita'],
            predictedDemand: 78,
            booked: false,
            active: false  // Dinner is inactive by default
          }
        }
      };
    }

    function setupEventListeners() {
      // Navbar scroll effect
      window.addEventListener('scroll', function () {
        const navbar = document.getElementById('navbar');
        if (navbar && window.scrollY > 50) {
          navbar.classList.add('scrolled');
        } else if (navbar) {
          navbar.classList.remove('scrolled');
        }
      });
      // Avatar color selection
      document.addEventListener('click', function (e) {
        if (e.target.classList.contains('avatar-color-btn')) {
          document.querySelectorAll('.avatar-color-btn').forEach(btn => {
            btn.classList.remove('active');
          });
          e.target.classList.add('active');
        }
      });

      // Click outside modal to close
      document.addEventListener('click', function (e) {
        // Check if click is on modal backdrop (not modal content)
        if (e.target.classList.contains('modal')) {
          const modalId = e.target.id;
          if (modalId && modalId !== 'userModal') {
            // For other modals, close when clicking outside
            closeModal(modalId);
          } else if (modalId === 'userModal') {
            // For user modal, also close when clicking outside
            closeModal('userModal');
          }
        }
      });

      // Theme toggle
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
        document.querySelector('.theme-toggle i').className = 'fas fa-sun';
      }

      // Predicted demand slider
      const demandSlider = document.getElementById('predictedDemand');
      if (demandSlider) {
        demandSlider.addEventListener('input', function () {
          document.getElementById('demandValue').textContent = this.value + '%';
        });
      }  // Sound controls
      const enableSoundCheckbox = document.getElementById('enableSound');
      const volumeSlider = document.getElementById('soundVolume');

      if (enableSoundCheckbox) {
        enableSoundCheckbox.addEventListener('change', function () {
          isSoundEnabled = this.checked;
          localStorage.setItem('sosSoundEnabled', isSoundEnabled);
          updateSoundStatus();

          if (!isSoundEnabled && isSoundPlaying) {
            stopEmergencySound();
          }
        });
      }

      if (volumeSlider) {
        volumeSlider.addEventListener('input', function () {
          soundVolume = this.value / 100;
          document.getElementById('volumeValue').textContent = this.value + '%';
          localStorage.setItem('sosSoundVolume', soundVolume);

          // Update sound volume if playing
          if (emergencySound) {
            emergencySound.volume = soundVolume;
          }
        });
      }

      // Load saved sound settings
      const savedSoundEnabled = localStorage.getItem('sosSoundEnabled');
      if (savedSoundEnabled !== null) {
        isSoundEnabled = savedSoundEnabled === 'true';
        if (enableSoundCheckbox) enableSoundCheckbox.checked = isSoundEnabled;
      }

      const savedVolume = localStorage.getItem('sosSoundVolume');
      if (savedVolume !== null) {
        soundVolume = parseFloat(savedVolume);
        if (volumeSlider) {
          volumeSlider.value = soundVolume * 100;
          document.getElementById('volumeValue').textContent = Math.round(soundVolume * 100) + '%';
        }
      }
      // Star rating system
      const starInputs = document.querySelectorAll('.star-rating input');
      starInputs.forEach(input => {
        input.addEventListener('change', function () {
          const rating = this.value;
          rateMeal(rating);
        });
      });

      // Handle window resize
      window.addEventListener('resize', debounce(function () {
        updateResponsiveElements();
      }, 250));
    }

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function updateResponsiveElements() {
      // Update any responsive elements if needed
      const isMobile = window.innerWidth <= 768;
      const floatingElements = document.querySelectorAll('.floating-element');

      floatingElements.forEach(el => {
        el.style.display = isMobile ? 'none' : 'block';
      });
    }

    function animateOnLoad() {
      // Animate floating elements
      gsap.utils.toArray('.floating-element').forEach((el, i) => {
        gsap.to(el, {
          duration: gsap.utils.random(20, 40),
          x: gsap.utils.random(-100, 100),
          y: gsap.utils.random(-100, 100),
          rotation: gsap.utils.random(-180, 180),
          ease: 'none',
          repeat: -1,
          yoyo: true
        });
      });

      // Animate cards on scroll
      gsap.utils.toArray('.card').forEach(card => {
        ScrollTrigger.create({
          trigger: card,
          start: 'top 80%',
          onEnter: () => {
            gsap.fromTo(card,
              { y: 50, opacity: 0 },
              { y: 0, opacity: 1, duration: 0.8, ease: 'power3.out' }
            );
          }
        });
      });

      // Animate section titles
      gsap.utils.toArray('.section-title').forEach(title => {
        ScrollTrigger.create({
          trigger: title,
          start: 'top 85%',
          onEnter: () => {
            gsap.fromTo(title,
              { y: 30, opacity: 0 },
              { y: 0, opacity: 1, duration: 0.6, ease: 'power3.out' }
            );
          }
        });
      });
    }

    // ===== NAVIGATION =====
    function setupNavMenu() {
      const navMenu = document.getElementById('navMenu');
      const menuItems = {
        student: [
          { id: 'home', name: 'Home', icon: 'fa-home' },
          { id: 'attendance', name: 'Attendance', icon: 'fa-calendar-check' },
          { id: 'results', name: 'Results', icon: 'fa-chart-line' }, // NEW
          { id: 'mess', name: 'Mess', icon: 'fa-utensils' },
          { id: 'navigation', name: 'Navigation', icon: 'fa-map-marked-alt' },
          { id: 'career', name: 'Career', icon: 'fa-briefcase' },
          { id: 'safety', name: 'Safety', icon: 'fa-shield-alt' }
        ],
        admin: [
          { id: 'home', name: 'Home', icon: 'fa-home' },
          { id: 'attendance', name: 'Attendance', icon: 'fa-calendar-check' },
          { id: 'mess', name: 'Mess', icon: 'fa-utensils' },
          { id: 'navigation', name: 'Navigation', icon: 'fa-map-marked-alt' },
          { id: 'career', name: 'Career', icon: 'fa-briefcase' },
          { id: 'safety', name: 'Safety', icon: 'fa-shield-alt' }
        ],
        mess: [
          { id: 'home', name: 'Home', icon: 'fa-home' },
          { id: 'mess', name: 'Mess', icon: 'fa-utensils' },
          { id: 'navigation', name: 'Navigation', icon: 'fa-map-marked-alt' },
          { id: 'safety', name: 'Safety', icon: 'fa-shield-alt' }
        ],
        guest: [
          { id: 'home', name: 'Home', icon: 'fa-home' },
          { id: 'attendance', name: 'Attendance', icon: 'fa-calendar-check' },
          { id: 'mess', name: 'Mess', icon: 'fa-utensils' },
          { id: 'navigation', name: 'Navigation', icon: 'fa-map-marked-alt' },
          { id: 'career', name: 'Career', icon: 'fa-briefcase' },
          { id: 'safety', name: 'Safety', icon: 'fa-shield-alt' }
        ]
      };

      const items = menuItems[currentUserRole] || menuItems.guest;
      navMenu.innerHTML = '';

      items.forEach(item => {
        const li = document.createElement('li');
        if (item.id === currentPage) li.classList.add('active');
        li.innerHTML = `<i class="fas ${item.icon}"></i> ${item.name}`;
        li.onclick = () => showPage(item.id);
        navMenu.appendChild(li);
      });
    }

    function showPage(pageId) {
      // If trying to view results as non-student, redirect to home
      if (pageId === 'results' && currentUserRole !== 'student') {
        showPage('home');
        showNotification('Results section is only available for students', 'warning');
        return;
      }

      // Update navigation
      document.querySelectorAll('#navMenu li').forEach(item => item.classList.remove('active'));
      document.querySelectorAll('#navMenu li').forEach(item => {
        if (item.textContent.includes(getPageName(pageId))) {
          item.classList.add('active');
        }
      });

      // Animate page transition
      const currentSection = document.getElementById(currentPage);
      if (currentSection) {
        gsap.to(currentSection, {
          opacity: 0,
          y: -30,
          duration: 0.3,
          ease: 'power2.inOut',
          onComplete: () => {
            currentSection.classList.remove('active');
            currentSection.style.display = 'none';

            const newSection = document.getElementById(pageId);
            newSection.classList.add('active');
            newSection.style.display = 'block';

            gsap.fromTo(newSection,
              { opacity: 0, y: 30 },
              { opacity: 1, y: 0, duration: 0.5, ease: 'power3.out' }
            );

            window.scrollTo({ top: 0, behavior: 'smooth' });
            document.querySelector('.nav-menu').classList.remove('active');

            currentPage = pageId;
            initializePage(pageId);
          }
        });
      } else {
        // For first page load
        const newSection = document.getElementById(pageId);
        newSection.classList.add('active');
        newSection.style.display = 'block';
        currentPage = pageId;
        initializePage(pageId);
      }
    }

    function getPageName(pageId) {
      const pageNames = {
        'home': 'Home',
        'attendance': 'Attendance',
        'safety': 'Safety',
        'mess': 'Mess',
        'navigation': 'Navigation',
        'career': 'Career'
      };
      return pageNames[pageId] || pageId;
    }

    function initializePage(pageId) {
      switch (pageId) {
        case 'attendance':
          initializeAttendance();
          break;
        case 'navigation':
          populateLocationList();
          break;
        case 'mess':
          initializeMess();
          break;
        case 'career':
          initializeCareer();
          break;
        case 'results':
          if (currentUserRole === 'student') {
            initializeResults();
          } else {
            showPage('home');
          }
          break;
      }
    }

    // ===== THEME MANAGEMENT =====
    function toggleTheme() {
      const body = document.body;
      const themeToggle = document.querySelector('.theme-toggle i');

      gsap.to(themeToggle, {
        rotation: 360,
        duration: 0.5,
        ease: 'back.out'
      });

      setTimeout(() => {
        if (body.classList.contains('light-theme')) {
          body.classList.remove('light-theme');
          themeToggle.className = 'fas fa-moon';
          localStorage.setItem('theme', 'dark');
          showNotification('Switched to dark theme', 'success');
        } else {
          body.classList.add('light-theme');
          themeToggle.className = 'fas fa-sun';
          localStorage.setItem('theme', 'light');
          showNotification('Switched to light theme', 'success');
        }
      }, 250);
    }

    // ===== USER MANAGEMENT =====
    function performLoginFromPage() {
      const userType = document.getElementById('loginUserType').value;
      const loginId = document.getElementById('loginUserId').value;
      const password = document.getElementById('loginUserPassword').value;

      if (!loginId || !password) {
        showNotification('Please enter ID and password', 'warning');
        return;
      }

      // Mock login
      const users = {
        'student': {
          name: 'Ankit Sharma',
          id: 'NER20231045',
          dept: 'Computer Science & Engineering',
          initials: 'AS',
          email: 'ankit.sharma@nerist.ac.in',
          phone: '+91 9876543210',
          year: '3rd Year',
          avatarColor: 'primary',
          emailPreferences: {
            attendance: true,
            mess: true,
            career: true,
            alerts: false
          },
          notificationSettings: {
            pushEnabled: true,
            types: {
              attendance: true,
              mess: true,
              career: true,
              safety: true,
              campusAlerts: true,
              events: false
            },
            frequency: 'immediate',
            quietHours: {
              start: '22:00',
              end: '06:00'
            },
            soundEnabled: true,
            vibrationEnabled: true
          }
        },
        'admin': {
          name: 'Admin User',
          id: 'ADM2023001',
          dept: 'Administration',
          initials: 'AU',
          email: 'admin@nerist.ac.in',
          phone: '+91 9876543201',
          year: 'Faculty',
          avatarColor: 'secondary',
          emailPreferences: {
            attendance: true,
            mess: true,
            career: true,
            alerts: true
          },
          notificationSettings: {
            pushEnabled: true,
            types: {
              attendance: true,
              mess: true,
              career: true,
              safety: true,
              campusAlerts: true,
              events: true
            },
            frequency: 'immediate',
            quietHours: {
              start: '20:00',
              end: '08:00'
            },
            soundEnabled: true,
            vibrationEnabled: true
          }
        },
        'mess': {
          name: 'Mess Secretary',
          id: 'MESS2023001',
          dept: 'Hostel Administration',
          initials: 'MS',
          email: 'mess.secretary@nerist.ac.in',
          phone: '+91 9876543202',
          year: 'Staff',
          avatarColor: 'nerist-green',
          emailPreferences: {
            attendance: false,
            mess: true,
            career: false,
            alerts: true
          },
          notificationSettings: {
            pushEnabled: true,
            types: {
              attendance: false,
              mess: true,
              career: false,
              safety: true,
              campusAlerts: true,
              events: true
            },
            frequency: 'immediate',
            quietHours: {
              start: '21:00',
              end: '07:00'
            },
            soundEnabled: true,
            vibrationEnabled: true
          }
        }
      };

      currentUser = users[userType] || users.student;
      currentUser.role = userType;

      // Save to localStorage
      localStorage.setItem('neristUser', JSON.stringify(currentUser));

      // Update UI
      currentUserRole = userType;
      updateUserDisplay();
      updateRoleBasedUI();
      document.body.classList.add('logged-in');
      hideLoginPage();
      showNotification(`Welcome, ${currentUser.name}!`, 'success');
    }

    // Quick demo login for preview
    function quickDemoLogin() {
      // Set demo credentials
      document.getElementById('loginUserId').value = 'NER20231045';
      document.getElementById('loginUserPassword').value = 'demo123';
      document.getElementById('loginUserType').value = 'student';

      // Show loading animation
      const loginBtn = document.querySelector('.login-button span');
      const originalText = loginBtn.textContent;
      loginBtn.textContent = 'Logging in...';

      // Simulate login process
      setTimeout(() => {
        // Perform actual login
        performLoginFromPage();

        // Reset button text (in case login fails)
        setTimeout(() => {
          loginBtn.textContent = originalText;
        }, 1000);
      }, 800);
    }

    // Add input focus effects
    document.addEventListener('DOMContentLoaded', function () {
      // Add focus effects to inputs
      const inputs = document.querySelectorAll('.login-input, .login-select');

      inputs.forEach(input => {
        input.addEventListener('focus', function () {
          this.parentElement.classList.add('focused');
        });

        input.addEventListener('blur', function () {
          if (!this.value) {
            this.parentElement.classList.remove('focused');
          }
        });
      });
    });

    function updateUserDisplay() {
      if (currentUser) {
        document.getElementById('userInitials').textContent = currentUser.initials;
        document.getElementById('profileInitials').textContent = currentUser.initials;
        document.getElementById('profileName').textContent = currentUser.name;
        document.getElementById('profileId').textContent = `${currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1)} ID: ${currentUser.id}`;
        document.getElementById('profileDept').textContent = `${currentUser.dept} • ${currentUser.year || 'N/A'}`;
        document.getElementById('profileRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);

        // Update avatar color
        updateAvatarColor();
      }
    }

    function updateRoleBasedUI() {
      const addAttendanceBtn = document.getElementById('addAttendanceBtn');
      const messManageBtn = document.getElementById('messManageBtn');
      const careerManageBtn = document.getElementById('careerManageBtn');
      const viewApplicationsBtn = document.getElementById('viewApplicationsBtn');
      const applyOpportunityBtn = document.getElementById('applyOpportunityBtn');
      const feedbackCard = document.getElementById('feedbackCard');
      // Update career section based on role
      if (currentUserRole === 'admin') {
        // Show admin applications card, hide student card
        const adminCard = document.getElementById('adminApplicationsCard');
        const studentCard = document.getElementById('studentApplicationCard');

        if (adminCard && studentCard) {
          adminCard.style.display = 'block';
          studentCard.style.display = 'none';
        }
      } else {
        // Show student applications card, hide admin card
        const adminCard = document.getElementById('adminApplicationsCard');
        const studentCard = document.getElementById('studentApplicationCard');

        if (adminCard && studentCard) {
          adminCard.style.display = 'none';
          studentCard.style.display = 'block';
        }
      }
      // Reset all
      if (addAttendanceBtn) addAttendanceBtn.style.display = 'none';
      if (messManageBtn) messManageBtn.style.display = 'none';
      if (careerManageBtn) careerManageBtn.style.display = 'none';
      if (viewApplicationsBtn) viewApplicationsBtn.style.display = 'block';
      if (applyOpportunityBtn) applyOpportunityBtn.style.display = 'none';
      if (feedbackCard) feedbackCard.style.display = 'block';

      // Inside updateRoleBasedUI() function, add:
      // const resultsSection = document.getElementById('results');

      // Hide results section for non-students
      // if (currentUserRole !== 'student' && resultsSection) {
      // resultsSection.style.display = 'none';
      // } else if (currentUserRole === 'student' && resultsSection) {
      //resultsSection.style.display = 'block';
      //}

      // Show based on role
      if (currentUserRole === 'admin') {
        if (addAttendanceBtn) addAttendanceBtn.style.display = 'block';
        if (careerManageBtn) careerManageBtn.style.display = 'block';
      }

      if (currentUserRole === 'mess') {
        if (messManageBtn) messManageBtn.style.display = 'block';
        if (feedbackCard) feedbackCard.style.display = 'none';
      }

      if (currentUserRole === 'admin') {
        if (viewApplicationsBtn) viewApplicationsBtn.style.display = 'none';
      }

      if (currentUserRole === 'student') {
        if (applyOpportunityBtn) applyOpportunityBtn.style.display = 'block';
      }
    }

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        // Clear all active modals first
        closeAllModals();

        // Clear user data
        currentUser = null;
        currentUserRole = 'guest';
        localStorage.removeItem('neristUser');

        // Small delay to ensure modals are closed
        setTimeout(() => {
          // Update UI immediately
          updateUserDisplay();
          updateRoleBasedUI();
          setupNavMenu();

          // Hide all content and show login page
          document.body.classList.remove('logged-in');

          // Show login page
          showLoginPage();

          // Show confirmation
          showNotification('Logged out successfully', 'info');
        }, 300);
      }
    }

    // ===== SCHEDULE SYSTEM =====
    function toggleScheduleView() {
      const scheduleItems = document.getElementById('scheduleItems');
      const viewBtn = document.getElementById('viewScheduleBtn');
      const hiddenItems = scheduleItems.querySelectorAll('.schedule-item[style*="display: none"]');

      if (scheduleItems.classList.contains('expanded')) {
        // Collapse
        gsap.to(scheduleItems, {
          maxHeight: 200,
          duration: 0.6,
          ease: 'power2.inOut'
        });

        hiddenItems.forEach(item => {
          gsap.to(item, {
            opacity: 0,
            height: 0,
            padding: 0,
            margin: 0,
            duration: 0.3,
            onComplete: () => item.style.display = 'none'
          });
        });

        viewBtn.innerHTML = 'View All <i class="fas fa-chevron-down"></i>';
        viewBtn.classList.remove('expanded');
      } else {
        // Expand
        gsap.to(scheduleItems, {
          maxHeight: 500,
          duration: 0.6,
          ease: 'power2.out'
        });

        hiddenItems.forEach((item, index) => {
          item.style.display = 'block';
          gsap.fromTo(item,
            { opacity: 0, height: 0, padding: 0, margin: 0 },
            {
              opacity: 1,
              height: 'auto',
              padding: '12px 0',
              margin: 0,
              duration: 0.4,
              delay: index * 0.1,
              ease: 'power2.out'
            }
          );
        });

        viewBtn.innerHTML = 'Show Less <i class="fas fa-chevron-up"></i>';
        viewBtn.classList.add('expanded');
      }

      scheduleItems.classList.toggle('expanded');
    }

    // ===== ATTENDANCE SYSTEM =====
    function initializeAttendance() {
      populateAttendanceTable();
      updateAttendanceStats();
      initializeAttendanceChart();
    }

    function populateAttendanceTable() {
      const tbody = document.querySelector('#attendanceTable tbody');
      tbody.innerHTML = '';

      attendanceData.forEach((record, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
  <td>${formatDate(record.date)}</td>
  <td>${record.studentId || 'N/A'}</td>
  <td>${record.subject}</td>
  <td><span class="status-badge status-${record.status}">${record.status.charAt(0).toUpperCase() + record.status.slice(1)}</span></td>
  <td>${record.time}</td>
  <td>
    ${currentUserRole === 'student' ? `<button class="btn btn-outline" style="padding: 6px 12px; font-size: 0.85rem;" onclick="openReportAttendanceModal(${index})">
  <i class="fas fa-flag"></i> Report
</button>
    ` : `
      <div style="display: flex; gap: 6px; flex-wrap: nowrap; align-items: center;">
        <button class="btn btn-outline" style="padding: 6px 12px; font-size: 0.85rem; min-width: 60px; display: flex; align-items: center; justify-content: center;" onclick="editAttendance(${index})" title="Edit Attendance">
          <i class="fas fa-edit"></i>
        </button>
        <button class="btn btn-outline" style="padding: 6px 12px; font-size: 0.85rem; min-width: 60px; display: flex; align-items: center; justify-content: center;" onclick="deleteAttendance(${index})" title="Delete Attendance">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    `}
  </td>
`;
        tbody.appendChild(row);
      });
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric'
      });
    }

    function updateAttendanceStats() {
      const totalClasses = attendanceData.length;
      const presentClasses = attendanceData.filter(r => r.status === 'present').length;
      const lateClasses = attendanceData.filter(r => r.status === 'late').length;
      const absentClasses = attendanceData.filter(r => r.status === 'absent').length;

      document.getElementById('overallAttendance').textContent =
        Math.round((presentClasses / totalClasses) * 100) + '%';
      document.getElementById('classesAttended').textContent = presentClasses;
      document.getElementById('lateArrivals').textContent = lateClasses;
      document.getElementById('absences').textContent = absentClasses;
    }

    function initializeAttendanceChart() {
      const ctx = document.getElementById('attendanceChart').getContext('2d');

      if (window.attendanceChartInstance) {
        window.attendanceChartInstance.destroy();
      }

      window.attendanceChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Current'],
          datasets: [{
            label: 'Attendance %',
            data: [82, 85, 88, 87, 90],
            borderColor: getComputedStyle(document.documentElement).getPropertyValue('--secondary'),
            backgroundColor: 'rgba(34, 211, 238, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--primary'),
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--light')
              }
            }
          },
          scales: {
            x: {
              grid: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--card-border')
              },
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--gray')
              }
            },
            y: {
              min: 70,
              max: 100,
              grid: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--card-border')
              },
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--gray'),
                callback: function (value) {
                  return value + '%';
                }
              }
            }
          }
        }
      });
    }

    function openAddAttendanceModal() {
      if (currentUserRole !== 'admin') {
        showNotification('Only admin can mark attendance', 'warning');
        return;
      }
      document.getElementById('addAttendanceModal').classList.add('active');
    }

    // ===== UPDATED ATTENDANCE FUNCTIONS =====

    function deleteAttendance(index) {
      if (confirm('Are you sure you want to delete this attendance record?')) {
        attendanceData.splice(index, 1);
        populateAttendanceTable();
        updateAttendanceStats();
        showNotification('Attendance record deleted', 'success');
      }
    }

    function updateYearOptions() {
      const degree = document.getElementById('attendanceDegree').value;
      const yearSelect = document.getElementById('attendanceYear');
      const semesterSelect = document.getElementById('attendanceSemester');

      yearSelect.innerHTML = '<option value="">Select Year</option>';
      semesterSelect.innerHTML = '<option value="">Select Semester</option>';

      if (!degree) return;

      const yearOptions = {
        'btech': ['1st Year', '2nd Year', '3rd Year', '4th Year'],
        'msc': ['1st Year', '2nd Year'],
        'mba': ['1st Year', '2nd Year'],
        'phd': ['1st Year', '2nd Year', '3rd Year', '4th Year', '5th Year'],
        'bsc': ['1st Year', '2nd Year', '3rd Year', '4th Year']
      };

      yearOptions[degree].forEach(year => {
        const option = document.createElement('option');
        option.value = year.toLowerCase().replace(' ', '-');
        option.textContent = year;
        yearSelect.appendChild(option);
      });
    }

    function updateSemesterOptions() {
      const degree = document.getElementById('attendanceDegree').value;
      const year = document.getElementById('attendanceYear').value;
      const semesterSelect = document.getElementById('attendanceSemester');

      semesterSelect.innerHTML = '<option value="">Select Semester</option>';

      if (!degree || !year) return;

      // Determine max semesters based on degree and year
      let maxSemesters = 8; // Default for B.Tech
      if (degree === 'msc' || degree === 'mba') maxSemesters = 4;
      if (degree === 'phd') maxSemesters = 10;
      if (degree === 'bsc') maxSemesters = 8;

      // Calculate starting semester based on year
      const yearMap = {
        '1st-year': 1,
        '2nd-year': 3,
        '3rd-year': 5,
        '4th-year': 7,
        '5th-year': 9
      };

      const startSemester = yearMap[year] || 1;
      const endSemester = Math.min(startSemester + 1, maxSemesters);

      for (let i = startSemester; i <= endSemester; i++) {
        const option = document.createElement('option');
        option.value = `sem-${i}`;
        option.textContent = `Semester ${i}`;
        semesterSelect.appendChild(option);
      }
    }

    function loadStudentList() {
      const degree = document.getElementById('attendanceDegree').value;
      const year = document.getElementById('attendanceYear').value;
      const semester = document.getElementById('attendanceSemester').value;
      const branch = document.getElementById('attendanceBranch').value;

      const container = document.getElementById('studentListContainer');

      if (!degree || !year || !semester || !branch) {
        container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 30px;">Please select all filters to load student list</p>';
        return;
      }

      // Generate student roll numbers based on pattern
      const studentRolls = [];

      // Roll numbers 001-040 for first group
      for (let i = 1; i <= 40; i++) {
        const roll = i.toString().padStart(3, '0');
        studentRolls.push(roll);
      }

      // Roll numbers 101-160 for second group
      for (let i = 101; i <= 160; i++) {
        studentRolls.push(i.toString());
      }

      // Create student list with checkboxes
      let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px;">';

      studentRolls.forEach(roll => {
        const fullRoll = generateFullRollNumber(degree, branch, roll);
        html += `
      <label style="display: flex; align-items: center; gap: 8px; padding: 10px; background: rgba(255, 255, 255, 0.03); border-radius: 8px; cursor: pointer; border: 1px solid var(--card-border);">
        <input type="checkbox" class="student-checkbox" value="${fullRoll}" style="cursor: pointer;">
        <span style="color: var(--light); font-size: 0.9rem;">${fullRoll}</span>
      </label>
    `;
      });

      html += '</div>';
      container.innerHTML = html;
    }

    function generateFullRollNumber(degree, branch, roll) {
      const degreePrefix = {
        'btech': 'BT',
        'msc': 'MS',
        'mba': 'MBA',
        'phd': 'PHD',
        'bsc': 'BSF'
      };

      const branchPrefix = {
        'agricultural': 'AG',
        'civil': 'CE',
        'cse': 'CS',
        'electrical': 'EE',
        'ece': 'EC',
        'mechanical': 'ME',
        'forestry': 'FR'
      };

      const year = document.getElementById('attendanceYear').value;
      const yearNum = year.includes('1st') ? '26' :
        year.includes('2nd') ? '25' :
          year.includes('3rd') ? '24' :
            year.includes('4th') ? '23' : '22';

      return `${degreePrefix[degree] || 'BT'}${yearNum}${branchPrefix[branch] || 'CS'}${roll}`;
    }

    function selectAllStudents() {
      const checkboxes = document.querySelectorAll('.student-checkbox');
      checkboxes.forEach(checkbox => {
        checkbox.checked = true;
      });
      showNotification('All students selected', 'info');
    }

    function deselectAllStudents() {
      const checkboxes = document.querySelectorAll('.student-checkbox');
      checkboxes.forEach(checkbox => {
        checkbox.checked = false;
      });
      showNotification('All students deselected', 'info');
    }

    function addGroupAttendance() {
      const degree = document.getElementById('attendanceDegree').value;
      const year = document.getElementById('attendanceYear').value;
      const semester = document.getElementById('attendanceSemester').value;
      const branch = document.getElementById('attendanceBranch').value;
      const subject = document.getElementById('attendanceSubject').value;
      const status = document.querySelector('input[name="status"]:checked').value;

      // Validate inputs
      if (!degree || !year || !semester || !branch || !subject) {
        showNotification('Please fill all filter fields', 'warning');
        return;
      }

      const selectedStudents = Array.from(document.querySelectorAll('.student-checkbox:checked'));

      if (selectedStudents.length === 0) {
        showNotification('Please select at least one student', 'warning');
        return;
      }

      const subjectNames = {
        'cs301': 'Data Structures (CS-301)',
        'cs302': 'Algorithms Lab (CS-302)',
        'cs303': 'Computer Networks (CS-303)',
        'math': 'Mathematics',
        'physics': 'Physics',
        'english': 'English Communication',
        'chemistry': 'Chemistry',
        'workshop': 'Workshop Practice'
      };

      const today = new Date().toISOString().split('T')[0];
      const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      // Add attendance for each selected student
      selectedStudents.forEach(studentCheckbox => {
        const studentRoll = studentCheckbox.value;

        attendanceData.unshift({
          date: today,
          studentId: studentRoll,
          subject: subjectNames[subject] || subject,
          status: status,
          time: time,
          degree: degree,
          year: year,
          semester: semester,
          branch: branch
        });
      });

      populateAttendanceTable();
      updateAttendanceStats();
      closeModal('addAttendanceModal');

      showNotification(`Attendance marked for ${selectedStudents.length} student(s)`, 'success');

      // Reset form for next use
      setTimeout(() => {
        document.getElementById('attendanceDegree').value = '';
        document.getElementById('attendanceYear').innerHTML = '<option value="">Select Year</option>';
        document.getElementById('attendanceSemester').innerHTML = '<option value="">Select Semester</option>';
        document.getElementById('attendanceBranch').value = '';
        document.getElementById('attendanceSubject').value = '';
        document.querySelector('input[name="status"][value="present"]').checked = true;
        document.getElementById('studentListContainer').innerHTML = '<p style="color: var(--gray); text-align: center; padding: 30px;">Please select Degree, Year, Semester, and Branch to load student list</p>';
      }, 500);
    }

    // ===== MESS SYSTEM =====
    function initializeMess() {
      updateMealRatingDisplay();
      updateDinnerStatus();

      // Animate meal cards
      gsap.utils.toArray('.meal-card').forEach((card, index) => {
        gsap.from(card, {
          opacity: 0,
          y: 30,
          duration: 0.6,
          delay: index * 0.1,
          ease: 'power2.out'
        });
      });
    }

    function updateDinnerStatus() {
      const dinnerCard = document.getElementById('dinnerCard');
      const bookDinnerBtn = document.getElementById('bookDinnerBtn');
      const inactiveBadge = document.getElementById('inactiveBadge');

      if (isDinnerActive) {
        // Activate dinner
        dinnerCard.classList.remove('inactive');
        bookDinnerBtn.disabled = false;
        inactiveBadge.innerHTML = '<i class="fas fa-check-circle"></i> Active';
        inactiveBadge.style.background = 'rgba(16, 185, 129, 0.2)';
        inactiveBadge.style.color = 'var(--success)';
      } else {
        // Deactivate dinner
        dinnerCard.classList.add('inactive');
        bookDinnerBtn.disabled = true;
        inactiveBadge.innerHTML = '<i class="fas fa-times-circle"></i> Inactive';
        inactiveBadge.style.background = 'rgba(239, 68, 68, 0.2)';
        inactiveBadge.style.color = 'var(--danger)';
      }
    }

    function openMessManageModal() {
      if (currentUserRole !== 'mess') {
        showNotification('Only Mess Secretary can manage mess menu', 'warning');
        return;
      }

      // Set current dinner status in modal
      const activeRadio = document.querySelector('input[name="mealActive"][value="active"]');
      const inactiveRadio = document.querySelector('input[name="mealActive"][value="inactive"]');

      if (isDinnerActive) {
        activeRadio.checked = true;
      } else {
        inactiveRadio.checked = true;
      }

      document.getElementById('messManageModal').classList.add('active');
    }

    function addFoodItem() {
      const mealType = document.getElementById('mealType').value;
      const mealDate = document.getElementById('mealDate').value;
      const menuItems = document.getElementById('menuItems').value.split(',').map(item => item.trim());
      const predictedDemand = document.getElementById('predictedDemand').value;
      const mealActive = document.querySelector('input[name="mealActive"]:checked').value === 'active';

      if (!menuItems.length || !menuItems[0]) {
        showNotification('Please enter menu items', 'warning');
        return;
      }

      // Update mess menu
      if (!messMenu[mealDate]) messMenu[mealDate] = {};
      messMenu[mealDate][mealType] = {
        items: menuItems,
        predictedDemand: parseInt(predictedDemand),
        booked: false,
        active: mealActive
      };

      // If updating dinner, update its status
      if (mealType === 'dinner') {
        isDinnerActive = mealActive;
        updateDinnerStatus();
      }

      showNotification(`${mealType} menu ${mealActive ? 'activated' : 'deactivated'} for ${mealDate}`, 'success');
      closeModal('messManageModal');

      // Update display if viewing that date
      const currentDate = document.querySelector('#mess .btn-outline + span').textContent.trim();
      if (currentDate === formatDate(mealDate)) {
        showNotification('Refresh the page to see updated menu', 'info');
      }
    }

    function updateFoodItem() {
      // Get the meal active status
      const mealActive = document.querySelector('input[name="mealActive"]:checked').value === 'active';
      const mealType = document.getElementById('mealType').value;

      if (mealType === 'dinner') {
        isDinnerActive = mealActive;
        updateDinnerStatus();
      }

      showNotification('Food item updated successfully', 'success');
      closeModal('messManageModal');
    }

    function deleteFoodItem() {
      if (confirm('Are you sure you want to delete this food item?')) {
        showNotification('Food item deleted successfully', 'success');
        closeModal('messManageModal');
      }
    }

    function addMessNotice() {
      const notice = prompt('Enter mess notice:');
      if (notice) {
        showNotification('Mess notice added successfully', 'success');
      }
    }

    function rateMeal(rating) {
      // Animate stars
      const stars = document.querySelectorAll('.star-rating label');
      stars.forEach((star, index) => {
        if (index < rating) {
          gsap.to(star, {
            scale: 1.2,
            color: getComputedStyle(document.documentElement).getPropertyValue('--warning'),
            duration: 0.3,
            yoyo: true,
            repeat: 1
          });
        }
      });

      // Update rating display with animation
      const ratingDisplay = document.getElementById('currentRating');
      mealRating = rating;

      gsap.to(ratingDisplay, {
        scale: 1.3,
        color: getComputedStyle(document.documentElement).getPropertyValue('--warning'),
        duration: 0.3,
        onComplete: () => {
          ratingDisplay.textContent = `${rating}/5`;
          gsap.to(ratingDisplay, {
            scale: 1,
            color: getComputedStyle(document.documentElement).getPropertyValue('--light'),
            duration: 0.3
          });
        }
      });

      showNotification(`Rated ${rating} stars! Thank you for your feedback.`, 'success');
    }

    function updateMealRatingDisplay() {
      const ratingDisplay = document.getElementById('currentRating');
      if (mealRating) {
        ratingDisplay.textContent = `${mealRating}/5`;
      } else {
        ratingDisplay.textContent = 'Not Rated';
      }
    }

    function submitFeedback() {
      const feedback = document.getElementById('feedbackText').value;
      if (feedback.trim()) {
        showNotification('Feedback submitted successfully!', 'success');
        document.getElementById('feedbackText').value = '';
      } else {
        showNotification('Please enter your feedback', 'warning');
      }
    }

    function bookMeal(mealType) {
      if (mealType === 'dinner' && !isDinnerActive) {
        showNotification('Dinner is currently inactive. Only mess secretary can activate it.', 'warning');
        return;
      }

      const mealNames = {
        'breakfast': 'Breakfast',
        'lunch': 'Lunch',
        'dinner': 'Dinner'
      };
      showNotification(`${mealNames[mealType]} booked successfully!`, 'success');
    }

    function bookAllMeals() {
      if (!isDinnerActive) {
        showNotification('Cannot book all meals because dinner is inactive.', 'warning');
        return;
      }
      showNotification('All meals booked for today!', 'success');
    }

    // ===== NAVIGATION SYSTEM =====
    function populateLocationList() {
      const locationList = document.getElementById('locationList');
      locationList.innerHTML = '';

      // Group locations by type for better organization
      const groupedLocations = {
        'academic': [],
        'facility': [],
        'administrative': [],
        'food': [],
        'sports': [],
        'medical': [],
        'event': [],
        'hostel': []
      };

      // Sort locations into groups
      locations.forEach(location => {
        if (groupedLocations[location.type]) {
          groupedLocations[location.type].push(location);
        }
      });

      // Create category headers
      const categoryNames = {
        'academic': '🏛️ Academic Buildings',
        'facility': '🏢 Facilities',
        'administrative': '📋 Administration',
        'food': '🍽️ Food & Dining',
        'sports': '⚽ Sports',
        'medical': '🏥 Medical',
        'event': '🎭 Events',
        'hostel': '🏠 Hostels'
      };

      let animationDelay = 0;

      // Display each category
      Object.keys(groupedLocations).forEach(category => {
        const categoryLocations = groupedLocations[category];

        if (categoryLocations.length > 0) {
          // Add category header
          const header = document.createElement('div');
          header.className = 'location-category-header';
          header.style.cssText = `
        margin: 25px 0 15px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--card-border);
        color: var(--light);
        font-size: 1.2rem;
        font-weight: 600;
      `;
          header.textContent = categoryNames[category] || category;
          locationList.appendChild(header);

          // Add locations in this category
          categoryLocations.forEach(location => {
            const item = document.createElement('div');
            item.className = 'location-item';
            item.onclick = () => getDirections(location.name);
            item.innerHTML = `
          <div class="location-name">${location.name}</div>
          <div class="location-desc">
            <i class="fas fa-${getLocationIcon(location.type)}"></i>
            ${location.desc}
          </div>
          <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
            <span style="background: rgba(99, 102, 241, 0.1); color: var(--primary); padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
              ${location.type}
            </span>
            <span style="background: rgba(34, 211, 238, 0.1); color: var(--secondary); padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
              <i class="fas fa-map-marker-alt"></i> ${location.desc.split('|')[1]?.trim() || '0.5 km away'}
            </span>
          </div>
        `;

            gsap.from(item, {
              opacity: 0,
              x: -20,
              duration: 0.4,
              delay: animationDelay,
              ease: 'power2.out'
            });

            animationDelay += 0.05;
            locationList.appendChild(item);
          });
        }
      });

      // If no locations found (shouldn't happen), show message
      if (locationList.children.length === 0) {
        const noResults = document.createElement('div');
        noResults.className = 'location-item';
        noResults.style.cssText = `
      text-align: center;
      padding: 40px 20px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--card-border);
      border-radius: 15px;
      margin-bottom: 12px;
      opacity: 1;
    `;
        noResults.innerHTML = `
      <div style="font-size: 2rem; color: var(--gray); margin-bottom: 15px;">
        <i class="fas fa-map-marked-alt"></i>
      </div>
      <div class="location-name" style="font-weight: 600; margin-bottom: 10px; font-size: 1.2rem; color: var(--light);">
        No locations available
      </div>
      <div class="location-desc" style="color: var(--gray); font-size: 1rem;">
        Please try again later or contact campus administration
      </div>
    `;
        locationList.appendChild(noResults);
      }
    }

    function getLocationIcon(type) {
      const icons = {
        'academic': 'graduation-cap',
        'facility': 'building',
        'administrative': 'landmark',
        'food': 'utensils',
        'sports': 'running',
        'medical': 'heartbeat',
        'event': 'calendar-alt',
        'hostel': 'home'
      };
      return icons[type] || 'map-marker-alt';
    }

    function searchLocations() {
      const searchTerm = document.getElementById('locationSearch').value.toLowerCase().trim();
      const locationList = document.getElementById('locationList');

      // If search term is empty, show all locations with categories
      if (!searchTerm) {
        populateLocationList();
        return;
      }

      // Filter locations based on search term
      const filteredLocations = locations.filter(location => {
        const name = location.name.toLowerCase();
        const desc = location.desc.toLowerCase();
        const type = location.type.toLowerCase();

        return name.includes(searchTerm) ||
          desc.includes(searchTerm) ||
          type.includes(searchTerm);
      });

      // Clear current list
      locationList.innerHTML = '';

      if (filteredLocations.length === 0) {
        // Show no results
        const noResults = document.createElement('div');
        noResults.className = 'location-item';
        noResults.style.cssText = `
      padding: 40px 20px !important;
      text-align: center !important;
      background: rgba(255, 255, 255, 0.03) !important;
      border: 1px solid var(--card-border) !important;
      border-radius: 15px !important;
      margin-bottom: 12px !important;
      opacity: 1 !important;
    `;

        noResults.innerHTML = `
      <div style="font-size: 2rem; color: var(--gray); margin-bottom: 20px;">
        <i class="fas fa-search"></i>
      </div>
      <div style="font-size: 1.2rem; font-weight: 600; color: var(--light); margin-bottom: 10px;">
        No results found for "${searchTerm}"
      </div>
      <div style="color: var(--gray); font-size: 1rem; margin-bottom: 20px;">
        Try searching for: <strong>classroom, office, library, cafeteria</strong>
      </div>
    `;

        locationList.appendChild(noResults);
      } else {
        // Show filtered results without categories
        const header = document.createElement('div');
        header.style.cssText = `
      margin: 0 0 25px 0;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--card-border);
      color: var(--light);
      font-size: 1.4rem;
      font-weight: 600;
    `;
        header.textContent = `Search Results (${filteredLocations.length})`;
        locationList.appendChild(header);

        filteredLocations.forEach((location, index) => {
          const item = document.createElement('div');
          item.className = 'location-item';
          item.onclick = () => getDirections(location.name);

          item.innerHTML = `
        <div class="location-name">${location.name}</div>
        <div class="location-desc">
          <i class="fas fa-${getLocationIcon(location.type)}"></i>
          ${location.desc}
        </div>
        <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
          <span style="background: rgba(99, 102, 241, 0.1); color: var(--primary); padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
            ${location.type}
          </span>
          <span style="background: rgba(34, 211, 238, 0.1); color: var(--secondary); padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
            <i class="fas fa-map-marker-alt"></i> ${location.desc.split('|')[1]?.trim() || '0.5 km away'}
          </span>
        </div>
      `;

          gsap.from(item, {
            opacity: 0,
            y: 20,
            duration: 0.4,
            delay: index * 0.05,
            ease: 'power2.out'
          });

          locationList.appendChild(item);
        });
      }
    }

    function performSearch() {
      const searchTerm = document.getElementById('locationSearch').value.trim();

      if (!searchTerm) {
        showNotification('Please enter a search term', 'warning');
        searchLocations(); // Show all locations
        return;
      }

      // Search in map markers
      let foundInMap = false;
      campusMarkers.forEach(marker => {
        const title = marker.options.title || '';
        if (title.toLowerCase().includes(searchTerm.toLowerCase())) {
          // Found in map - center and highlight
          neristMap.setView(marker.getLatLng(), 18);
          marker.openPopup();
          foundInMap = true;

          // Animate marker
          const icon = marker.getElement();
          if (icon) {
            gsap.to(icon, {
              scale: 1.5,
              duration: 0.3,
              yoyo: true,
              repeat: 2
            });
          }
        }
      });

      if (foundInMap) {
        showNotification(`Found "${searchTerm}" on map!`, 'success');
        hideMapOverlay(); // Hide overlay to show map
      }

      // Also search in location list
      searchLocations();
    }

    function highlightSearchTerm(term) {
      const locationItems = document.querySelectorAll('.location-item');
      const regex = new RegExp(`(${term})`, 'gi');

      locationItems.forEach(item => {
        const locationName = item.querySelector('.location-name');
        const locationDesc = item.querySelector('.location-desc');

        if (locationName) {
          locationName.innerHTML = locationName.textContent.replace(regex, '<mark style="background: rgba(34, 211, 238, 0.3); color: var(--light); padding: 2px 4px; border-radius: 4px;">$1</mark>');
        }

        if (locationDesc) {
          locationDesc.innerHTML = locationDesc.textContent.replace(regex, '<mark style="background: rgba(34, 211, 238, 0.3); color: var(--light); padding: 2px 4px; border-radius: 4px;">$1</mark>');
        }
      });
    }

    function getDirections(destination) {
      showNotification(`Getting directions to ${destination}...`, 'info');
    }

    // ===== SAFETY SYSTEM =====
    function activateSOS() {
      const sosBtn = document.getElementById('sosBtn');

      // Animate SOS button
      gsap.to(sosBtn, {
        scale: 0.9,
        duration: 0.1,
        yoyo: true,
        repeat: 5,
        onComplete: () => {
          sosBtn.style.animation = 'none';
          sosBtn.style.boxShadow = '0 0 50px rgba(239, 68, 68, 0.8)';

          // Play emergency sound
          playEmergencySound();

          showNotification('SOS Alert Sent! Help is on the way.', 'danger');
          sendEmergencyNotification('EMERGENCY SOS ACTIVATED', 'Your SOS alert has been sent to campus security and emergency contacts.');

          setTimeout(() => {
            document.getElementById('sosModal').classList.add('active');
            sosBtn.style.animation = 'pulse 0.5s infinite';
          }, 1000);
        }
      });
    }

    function callEmergency(type) {
      const numbers = {
        'campus-security': '+91 98765 43210',
        'medical-center': '+91 98765 43211',
        'womens-warden': '+91 98765 43212',
        'mens-warden': '+91 98765 43213'
      };

      const number = numbers[type];
      if (confirm(`Call ${number}?`)) {
        showNotification(`Calling ${type.replace('-', ' ')}...`, 'info');
      }
    }

    function requestSafeWalk() {
      const duration = document.getElementById('safeWalkDuration').value;
      showNotification(`Safe walk request sent for ${duration} minutes. Security will contact you shortly.`, 'success');
    }

    // ===== CAREER SYSTEM =====
    function initializeCareer() {
      // Animate opportunity cards
      gsap.utils.toArray('.opportunity-card').forEach((card, index) => {
        gsap.from(card, {
          opacity: 0,
          y: 30,
          duration: 0.6,
          delay: index * 0.1,
          ease: 'power2.out'
        });
      });

      // Initialize admin applications if admin
      if (currentUserRole === 'admin') {
        initializeAdminApplications();
      }
    }

    function openCareerManageModal() {
      if (currentUserRole !== 'admin') {
        showNotification('Only admin can manage career opportunities', 'warning');
        return;
      }
      document.getElementById('careerManageModal').classList.add('active');
    }

    function addCareerOpportunity() {
      const title = document.getElementById('opportunityTitle').value;
      const type = document.getElementById('opportunityType').value;
      const details = document.getElementById('opportunityDetails').value;
      const deadline = document.getElementById('opportunityDeadline').value;
      const eligibility = document.getElementById('eligibilityCriteria').value;

      if (!title || !details || !deadline || !eligibility) {
        showNotification('Please fill all fields', 'warning');
        return;
      }

      const newOpportunity = {
        id: title.toLowerCase().replace(/\s+/g, '-'),
        title: title,
        type: type,
        details: details,
        deadline: deadline,
        match: Math.floor(Math.random() * 20) + 80, // Random match 80-100%
        eligibility: eligibility
      };

      careerOpportunities.push(newOpportunity);
      showNotification(`Career opportunity "${title}" added successfully`, 'success');
      closeModal('careerManageModal');
    }

    function updateCareerOpportunity() {
      showNotification('Career opportunity updated successfully', 'success');
      closeModal('careerManageModal');
    }

    function deleteCareerOpportunity() {
      if (confirm('Are you sure you want to delete this career opportunity?')) {
        showNotification('Career opportunity deleted successfully', 'success');
        closeModal('careerManageModal');
      }
    }

    function viewOpportunity(opportunityId) {
      const opportunity = careerOpportunities.find(opp => opp.id === opportunityId);
      if (opportunity) {
        if (currentUserRole === 'student') {
          document.getElementById('applyOpportunityBtn').style.display = 'block';
          document.getElementById('viewApplicationsBtn').style.display = 'none';
        }
        showNotification(`Opening ${opportunity.title} details...`, 'info');
      }
    }

    function applyForOpportunity() {
      if (currentUserRole !== 'student') {
        showNotification('Only students can apply for opportunities', 'warning');
        return;
      }
      showNotification('Application submitted successfully!', 'success');
      document.getElementById('applyOpportunityBtn').style.display = 'none';
      document.getElementById('viewApplicationsBtn').style.display = 'block';
    }

    // ===== ADMIN APPLICATIONS MANAGEMENT =====
    let studentApplications = [];
    let selectedApplications = [];

    function initializeAdminApplications() {
      if (currentUserRole !== 'admin') return;

      // Load sample applications data
      loadStudentApplications();
      renderApplicationsTable();
      updateApplicationStats();

      // Show admin applications card
      document.getElementById('adminApplicationsCard').style.display = 'block';
      document.getElementById('studentApplicationCard').style.display = 'none';
    }

    function loadStudentApplications() {
      // Mock data for student applications
      studentApplications = [
        {
          id: 1,
          studentId: 'NER20231001',
          studentName: 'Amit Sharma',
          opportunity: 'Google Summer Internship 2026',
          appliedDate: '2026-05-10',
          status: 'pending',
          email: 'amit.sharma@nerist.ac.in',
          department: 'Computer Science',
          year: '3rd Year',
          cgpa: 8.7,
          resume: 'amit_sharma_resume.pdf',
          notes: 'Excellent programming skills'
        },
        {
          id: 2,
          studentId: 'NER20231002',
          studentName: 'Priya Singh',
          opportunity: 'NERIST Merit Scholarship',
          appliedDate: '2026-05-12',
          status: 'pending',
          email: 'priya.singh@nerist.ac.in',
          department: 'Electronics',
          year: '2nd Year',
          cgpa: 9.2,
          resume: 'priya_singh_resume.pdf',
          notes: 'Top of her class'
        },
        {
          id: 3,
          studentId: 'NER20231003',
          studentName: 'Rahul Verma',
          opportunity: 'Microsoft Research Fellowship',
          appliedDate: '2026-05-08',
          status: 'accepted',
          email: 'rahul.verma@nerist.ac.in',
          department: 'Computer Science',
          year: '4th Year',
          cgpa: 8.9,
          resume: 'rahul_verma_resume.pdf',
          notes: 'Strong research background'
        },
        {
          id: 4,
          studentId: 'NER20231004',
          studentName: 'Sneha Patel',
          opportunity: 'TCS Campus Hiring',
          appliedDate: '2026-05-15',
          status: 'rejected',
          email: 'sneha.patel@nerist.ac.in',
          department: 'Mechanical',
          year: 'Final Year',
          cgpa: 7.8,
          resume: 'sneha_patel_resume.pdf',
          notes: 'Missing required courses'
        },
        {
          id: 5,
          studentId: 'NER20231005',
          studentName: 'Karan Mehta',
          opportunity: 'Google Summer Internship 2026',
          appliedDate: '2026-05-14',
          status: 'pending',
          email: 'karan.mehta@nerist.ac.in',
          department: 'Computer Science',
          year: '3rd Year',
          cgpa: 8.5,
          resume: 'karan_mehta_resume.pdf',
          notes: 'Good project experience'
        },
        {
          id: 6,
          studentId: 'NER20231006',
          studentName: 'Anjali Desai',
          opportunity: 'Infosys Internship',
          appliedDate: '2026-05-11',
          status: 'under-review',
          email: 'anjali.desai@nerist.ac.in',
          department: 'Civil',
          year: '2nd Year',
          cgpa: 8.9,
          resume: 'anjali_desai_resume.pdf',
          notes: 'Leadership experience'
        },
        {
          id: 7,
          studentId: 'NER20231007',
          studentName: 'Vikram Singh',
          opportunity: 'MHRD Scholarship',
          appliedDate: '2026-05-09',
          status: 'accepted',
          email: 'vikram.singh@nerist.ac.in',
          department: 'Agriculture',
          year: '1st Year',
          cgpa: 9.1,
          resume: 'vikram_singh_resume.pdf',
          notes: 'Merit based'
        },
        {
          id: 8,
          studentId: 'NER20231008',
          studentName: 'Meera Iyer',
          opportunity: 'IEEE Conference Grant',
          appliedDate: '2026-05-13',
          status: 'pending',
          email: 'meera.iyer@nerist.ac.in',
          department: 'Electrical',
          year: '4th Year',
          cgpa: 8.6,
          resume: 'meera_iyer_resume.pdf',
          notes: 'Conference paper submitted'
        }
      ];
    }

    function renderApplicationsTable() {
      const tbody = document.getElementById('applicationsTableBody');
      const filterStatus = document.getElementById('applicationStatusFilter').value;
      const searchTerm = document.getElementById('searchApplications')?.value.toLowerCase() || '';

      // Filter applications
      let filteredApplications = studentApplications.filter(app => {
        const matchesStatus = filterStatus === 'all' || app.status === filterStatus;
        const matchesSearch = searchTerm === '' ||
          app.studentId.toLowerCase().includes(searchTerm) ||
          app.studentName.toLowerCase().includes(searchTerm) ||
          app.opportunity.toLowerCase().includes(searchTerm);

        return matchesStatus && matchesSearch;
      });

      // Clear table
      tbody.innerHTML = '';

      // Populate table
      filteredApplications.forEach((application, index) => {
        const row = document.createElement('tr');

        // Format date
        const formattedDate = new Date(application.appliedDate).toLocaleDateString('en-US', {
          month: 'short',
          day: 'numeric',
          year: 'numeric'
        });

        // Status badge
        let statusBadge = '';
        let statusText = '';
        switch (application.status) {
          case 'pending':
            statusBadge = 'status-pending';
            statusText = 'Pending';
            break;
          case 'accepted':
            statusBadge = 'status-accepted';
            statusText = 'Accepted';
            break;
          case 'rejected':
            statusBadge = 'status-rejected';
            statusText = 'Rejected';
            break;
          case 'under-review':
            statusBadge = 'status-under-review';
            statusText = 'Under Review';
            break;
        }

        row.innerHTML = `
  <td><strong>${application.studentId}</strong></td>
  <td>
    <div style="font-weight: 600;">${application.studentName}</div>
    <div style="color: var(--gray); font-size: 0.85rem;">${application.department} • ${application.year}</div>
  </td>
  <td>${application.opportunity}</td>
  <td>${formattedDate}</td>
  <td><span class="application-status-badge ${statusBadge}">${statusText}</span></td>
  <td>
    <div class="action-buttons">
      ${application.status === 'pending' ? `
        <button class="action-btn accept" onclick="updateApplicationStatus(${application.id}, 'accepted')" title="Accept Application">
          <i class="fas fa-check"></i> Accept
        </button>
        <button class="action-btn reject" onclick="updateApplicationStatus(${application.id}, 'rejected')" title="Reject Application">
          <i class="fas fa-times"></i> Reject
        </button>
      ` : ''}
      <button class="action-btn view" onclick="viewApplicationDetails(${application.id})" title="View Details">
        <i class="fas fa-eye"></i> View
      </button>
    </div>
  </td>
`;

        tbody.appendChild(row);
      });
    }

    function updateApplicationStatus(applicationId, newStatus) {
      // Find the application
      const applicationIndex = studentApplications.findIndex(app => app.id === applicationId);

      if (applicationIndex === -1) {
        showNotification('Application not found', 'warning');
        return;
      }

      // Get student name for notification
      const studentName = studentApplications[applicationIndex].studentName;
      const opportunity = studentApplications[applicationIndex].opportunity;

      // Update status
      studentApplications[applicationIndex].status = newStatus;

      // Add status change date
      studentApplications[applicationIndex].statusChanged = new Date().toISOString().split('T')[0];
      studentApplications[applicationIndex].reviewedBy = currentUser?.name || 'Admin';

      // Update UI
      renderApplicationsTable();
      updateApplicationStats();

      // Show notification
      const statusText = newStatus === 'accepted' ? 'accepted' : 'rejected';
      showNotification(`Application ${statusText} for ${studentName}`, 'success');

      // In a real system, you would send an email notification here
      if (newStatus === 'accepted') {
        sendApplicationNotification(studentApplications[applicationIndex].email, 'accepted', opportunity);
      } else if (newStatus === 'rejected') {
        sendApplicationNotification(studentApplications[applicationIndex].email, 'rejected', opportunity);
      }
    }

    function updateApplicationStats() {
      const total = studentApplications.length;
      const pending = studentApplications.filter(app => app.status === 'pending').length;
      const accepted = studentApplications.filter(app => app.status === 'accepted').length;
      const rejected = studentApplications.filter(app => app.status === 'rejected').length;

      document.getElementById('totalApplications').textContent = total;
      document.getElementById('pendingApplications').textContent = pending;
      document.getElementById('acceptedApplications').textContent = accepted;
      document.getElementById('rejectedApplications').textContent = rejected;
    }

    function searchStudentApplications() {
      renderApplicationsTable();
    }

    function filterApplications() {
      renderApplicationsTable();
    }

    function refreshApplications() {
      // Simulate refreshing data
      showNotification('Refreshing applications...', 'info');

      setTimeout(() => {
        // In real app, this would fetch from server
        loadStudentApplications();
        renderApplicationsTable();
        updateApplicationStats();
        showNotification('Applications refreshed successfully', 'success');
      }, 800);
    }

    function viewApplicationDetails(applicationId) {
      const application = studentApplications.find(app => app.id === applicationId);

      if (!application) {
        showNotification('Application not found', 'warning');
        return;
      }

      // Create or update modal for application details
      let detailModal = document.getElementById('applicationDetailModal');

      if (!detailModal) {
        detailModal = document.createElement('div');
        detailModal.className = 'modal';
        detailModal.id = 'applicationDetailModal';
        detailModal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 2000; align-items: center; justify-content: center; padding: 20px;';

        detailModal.innerHTML = `
      <div class="modal-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
        <div class="modal-close" onclick="closeModal('applicationDetailModal')">
          <i class="fas fa-times"></i>
        </div>
        <h2 class="modal-title">Application Details</h2>
        <div class="modal-body" id="applicationDetailContent">
          <!-- Content will be inserted here -->
        </div>
        <div style="display: flex; gap: 15px; margin-top: 25px;">
          <button class="btn btn-secondary" onclick="closeModal('applicationDetailModal')" style="flex: 1;">Close</button>
          <button class="btn btn-primary" onclick="downloadApplicationDetails()" style="flex: 1;">
            <i class="fas fa-download"></i> Download PDF
          </button>
        </div>
      </div>
    `;

        document.body.appendChild(detailModal);
      }

      // Format dates
      const appliedDate = new Date(application.appliedDate).toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      const statusChangedDate = application.statusChanged ?
        new Date(application.statusChanged).toLocaleDateString('en-US', {
          month: 'short',
          day: 'numeric',
          year: 'numeric'
        }) : 'Not yet reviewed';

      // Status color
      let statusColor = '';
      switch (application.status) {
        case 'pending': statusColor = 'var(--warning)'; break;
        case 'accepted': statusColor = 'var(--success)'; break;
        case 'rejected': statusColor = 'var(--danger)'; break;
        case 'under-review': statusColor = 'var(--secondary)'; break;
      }

      // Populate modal content
      document.getElementById('applicationDetailContent').innerHTML = `
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 30px;">
      <div>
        <h4 style="color: var(--light); margin-bottom: 15px;">Student Information</h4>
        <div style="background: var(--card-bg); padding: 20px; border-radius: 12px;">
          <p><strong>Student ID:</strong> ${application.studentId}</p>
          <p><strong>Name:</strong> ${application.studentName}</p>
          <p><strong>Email:</strong> ${application.email}</p>
          <p><strong>Department:</strong> ${application.department}</p>
          <p><strong>Year:</strong> ${application.year}</p>
          <p><strong>CGPA:</strong> ${application.cgpa}</p>
        </div>
      </div>
      
      <div>
        <h4 style="color: var(--light); margin-bottom: 15px;">Application Details</h4>
        <div style="background: var(--card-bg); padding: 20px; border-radius: 12px;">
          <p><strong>Opportunity:</strong> ${application.opportunity}</p>
          <p><strong>Applied On:</strong> ${appliedDate}</p>
          <p><strong>Status:</strong> <span style="color: ${statusColor}; font-weight: 600;">${application.status.charAt(0).toUpperCase() + application.status.slice(1)}</span></p>
          <p><strong>Last Reviewed:</strong> ${statusChangedDate}</p>
          <p><strong>Reviewed By:</strong> ${application.reviewedBy || 'Not yet reviewed'}</p>
          <p><strong>Resume:</strong> ${application.resume}</p>
        </div>
      </div>
    </div>
    
    <div style="margin-top: 25px;">
      <h4 style="color: var(--light); margin-bottom: 15px;">Notes & Review</h4>
      <textarea id="applicationNotes" class="form-control" rows="4" placeholder="Add review notes...">${application.notes || ''}</textarea>
      <button class="btn btn-outline" onclick="saveApplicationNotes(${application.id})" style="margin-top: 15px; width: 100%;">
        <i class="fas fa-save"></i> Save Notes
      </button>
    </div>
    
${application.status === 'pending' ? `
<div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--card-border);">
  <h4 style="color: var(--light); margin-bottom: 15px;">Quick Actions</h4>
  <div style="display: flex; gap: 12px;">
    <button class="btn btn-success" onclick="updateApplicationStatus(${application.id}, 'accepted'); closeModal('applicationDetailModal');" style="padding: 10px 20px; font-size: 0.85rem;">
      <i class="fas fa-check"></i> Accept
    </button>
    <button class="btn btn-danger" onclick="updateApplicationStatus(${application.id}, 'rejected'); closeModal('applicationDetailModal');" style="padding: 10px 20px; font-size: 0.85rem;">
      <i class="fas fa-times"></i> Reject
    </button>
    <button class="btn btn-outline" onclick="closeModal('applicationDetailModal')" style="padding: 10px 20px; font-size: 0.85rem;">
      <i class="fas fa-times"></i> Cancel
    </button>
  </div>
</div>
` : ''}
  `;

      // Open modal
      openModal('applicationDetailModal');
    }

    function saveApplicationNotes(applicationId) {
      const notes = document.getElementById('applicationNotes').value;
      const applicationIndex = studentApplications.findIndex(app => app.id === applicationId);

      if (applicationIndex !== -1) {
        studentApplications[applicationIndex].notes = notes;
        showNotification('Notes saved successfully', 'success');
      }
    }

    function downloadApplicationsReport() {
      showNotification('Generating applications report...', 'info');

      // Simulate report generation
      setTimeout(() => {
        // Create CSV content
        let csvContent = "Student ID,Student Name,Opportunity,Applied Date,Status,Department,Year,CGPA\n";

        studentApplications.forEach(app => {
          csvContent += `${app.studentId},${app.studentName},${app.opportunity},${app.appliedDate},${app.status},${app.department},${app.year},${app.cgpa}\n`;
        });

        // Create download link
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `student_applications_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);

        showNotification('Report downloaded successfully', 'success');
      }, 1000);
    }

    function bulkUpdateApplications() {
      // Create bulk update modal
      let bulkModal = document.getElementById('bulkUpdateModal');

      if (!bulkModal) {
        bulkModal = document.createElement('div');
        bulkModal.className = 'modal';
        bulkModal.id = 'bulkUpdateModal';
        bulkModal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 2000; align-items: center; justify-content: center; padding: 20px;';

        bulkModal.innerHTML = `
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-close" onclick="closeModal('bulkUpdateModal')">
          <i class="fas fa-times"></i>
        </div>
        <h2 class="modal-title">Bulk Update Applications</h2>
        <div class="modal-body">
          <div class="bulk-select">
            <input type="checkbox" id="selectAllApplications" onchange="toggleAllApplications()">
            <label for="selectAllApplications" style="color: var(--light); font-weight: 600;">Select all pending applications</label>
          </div>
          
          <div style="max-height: 300px; overflow-y: auto; margin-top: 15px;">
            <table style="width: 100%;">
              <thead>
                <tr>
                  <th style="padding: 10px; text-align: left;">Select</th>
                  <th style="padding: 10px; text-align: left;">Student</th>
                  <th style="padding: 10px; text-align: left;">Opportunity</th>
                </tr>
              </thead>
              <tbody id="bulkSelectList">
                <!-- Applications list will be populated here -->
              </tbody>
            </table>
          </div>
          
          <div style="display: flex; gap: 10px; margin-top: 25px;">
  <button class="btn btn-success" onclick="bulkAcceptApplications()" style="padding: 10px 20px; font-size: 0.9rem; min-width: 140px;">
    <i class="fas fa-check-circle"></i> Accept Selected
  </button>
  <button class="btn btn-danger" onclick="bulkRejectApplications()" style="padding: 10px 20px; font-size: 0.9rem; min-width: 140px;">
    <i class="fas fa-times-circle"></i> Reject Selected
  </button>
</div>
          </div>
          
          <div style="margin-top: 25px;">
            <h4 style="color: var(--light); margin-bottom: 15px;">Add Note to All Selected</h4>
            <textarea id="bulkNote" class="form-control" rows="3" placeholder="Add note for all selected applications..."></textarea>
            <button class="btn btn-outline" onclick="addBulkNote()" style="width: 100%; margin-top: 10px;">
              <i class="fas fa-comment"></i> Add Note
            </button>
          </div>
        </div>
      </div>
    `;

        document.body.appendChild(bulkModal);
      }

      // Populate bulk selection list
      const pendingApplications = studentApplications.filter(app => app.status === 'pending');
      const bulkList = document.getElementById('bulkSelectList');
      bulkList.innerHTML = '';

      pendingApplications.forEach(app => {
        const row = document.createElement('tr');
        row.innerHTML = `
      <td style="padding: 10px;">
        <input type="checkbox" class="bulk-app-checkbox" value="${app.id}">
      </td>
      <td style="padding: 10px;">${app.studentName} (${app.studentId})</td>
      <td style="padding: 10px;">${app.opportunity}</td>
    `;
        bulkList.appendChild(row);
      });

      // Open modal
      openModal('bulkUpdateModal');
    }

    function toggleAllApplications() {
      const selectAll = document.getElementById('selectAllApplications');
      const checkboxes = document.querySelectorAll('.bulk-app-checkbox');

      checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
      });
    }

    function bulkAcceptApplications() {
      const checkboxes = document.querySelectorAll('.bulk-app-checkbox:checked');

      if (checkboxes.length === 0) {
        showNotification('Please select applications to accept', 'warning');
        return;
      }

      checkboxes.forEach(checkbox => {
        const appId = parseInt(checkbox.value);
        updateApplicationStatus(appId, 'accepted');
      });

      closeModal('bulkUpdateModal');
      showNotification(`${checkboxes.length} applications accepted`, 'success');
    }

    function bulkRejectApplications() {
      const checkboxes = document.querySelectorAll('.bulk-app-checkbox:checked');

      if (checkboxes.length === 0) {
        showNotification('Please select applications to reject', 'warning');
        return;
      }

      checkboxes.forEach(checkbox => {
        const appId = parseInt(checkbox.value);
        updateApplicationStatus(appId, 'rejected');
      });

      closeModal('bulkUpdateModal');
      showNotification(`${checkboxes.length} applications rejected`, 'success');
    }

    function addBulkNote() {
      const note = document.getElementById('bulkNote').value;
      const checkboxes = document.querySelectorAll('.bulk-app-checkbox:checked');

      if (checkboxes.length === 0) {
        showNotification('Please select applications first', 'warning');
        return;
      }

      if (!note.trim()) {
        showNotification('Please enter a note', 'warning');
        return;
      }

      checkboxes.forEach(checkbox => {
        const appId = parseInt(checkbox.value);
        const appIndex = studentApplications.findIndex(app => app.id === appId);

        if (appIndex !== -1) {
          studentApplications[appIndex].notes = studentApplications[appIndex].notes
            ? `${studentApplications[appIndex].notes}\n${note}`
            : note;
        }
      });

      showNotification(`Note added to ${checkboxes.length} applications`, 'success');
      document.getElementById('bulkNote').value = '';
    }

    function sendApplicationNotification(email, status, opportunity) {
      // In a real application, this would send an email
      console.log(`Email sent to ${email}: Your application for "${opportunity}" has been ${status}`);

      // Show notification to admin
      showNotification(`Notification email sent to student`, 'info');
    }

    function downloadApplicationDetails() {
      // This would download the application details as PDF
      showNotification('Downloading application details...', 'info');

      setTimeout(() => {
        showNotification('PDF downloaded successfully', 'success');
      }, 800);
    }

    // ===== WEATHER SYSTEM =====
    async function updateWeather() {
      const weatherIcon = document.getElementById('weatherIcon');
      const weatherTemp = document.getElementById('weatherTemp');
      const weatherWind = document.getElementById('weatherWind');
      const weatherHumidity = document.getElementById('weatherHumidity');
      const weatherLocation = document.getElementById('weatherLocation');

      // Try to get cached weather data first
      const cachedWeather = getCachedWeather();

      // Show loading state
      weatherIcon.className = 'fas fa-sync-alt fa-spin';
      weatherTemp.textContent = '--°C';
      weatherWind.textContent = '-- km/h';
      weatherHumidity.textContent = '--%';
      weatherLocation.textContent = 'NERIST Campus';

      try {
        // Try to fetch live weather data
        const response = await fetch(
          `https://api.open-meteo.com/v1/forecast?latitude=${NERIST_COORDS.lat}&longitude=${NERIST_COORDS.lng}&current_weather=true&hourly=temperature_2m,relativehumidity_2m,windspeed_10m&timezone=auto`
        );

        if (!response.ok) {
          throw new Error(`API Error: ${response.status}`);
        }

        const data = await response.json();

        // Extract current weather data
        const current = data.current_weather;
        const hourly = data.hourly;

        // Find current hour's data
        const now = new Date();
        const currentHour = now.getHours();
        const hourIndex = hourly.time.findIndex(time =>
          new Date(time).getHours() === currentHour
        );

        weatherData = {
          temperature: current.temperature,
          windSpeed: current.windspeed,
          weatherCode: current.weathercode,
          humidity: hourIndex !== -1 ? Math.round(hourly.relativehumidity_2m[hourIndex]) : 65,
          lastUpdated: new Date().toISOString()
        };

        // Cache the weather data
        cacheWeatherData(weatherData);

        // Update UI with live data
        updateWeatherUI(weatherData);
        showNotification('Weather updated live!', 'success');

      } catch (error) {
        console.log('Weather API error:', error);

        // Try to use cached data
        if (cachedWeather && isCacheValid(cachedWeather)) {
          updateWeatherUI(cachedWeather);
          showNotification('Using cached weather data', 'info');
        } else {
          // Fallback to mock data
          const mockWeather = generateMockWeather();
          updateWeatherUI(mockWeather);
          showNotification('Offline mode: Using mock weather data', 'warning');
        }
      }
    }

    // Helper function to get cached weather
    function getCachedWeather() {
      try {
        const cached = localStorage.getItem(weatherCacheKey);
        return cached ? JSON.parse(cached) : null;
      } catch (e) {
        console.log('Error reading weather cache:', e);
        return null;
      }
    }

    // Helper function to cache weather data
    function cacheWeatherData(data) {
      try {
        localStorage.setItem(weatherCacheKey, JSON.stringify(data));
      } catch (e) {
        console.log('Error caching weather:', e);
      }
    }

    // Check if cache is still valid (less than 1 hour old)
    function isCacheValid(cachedData) {
      if (!cachedData || !cachedData.lastUpdated) return false;

      const cacheTime = new Date(cachedData.lastUpdated).getTime();
      const currentTime = new Date().getTime();
      const oneHour = 60 * 60 * 1000;

      return (currentTime - cacheTime) < oneHour;
    }

    // Generate realistic mock weather data for offline use
    function generateMockWeather() {
      const now = new Date();
      const hour = now.getHours();

      // Simulate day/night temperature variations
      let baseTemp = 26; // Base temperature

      if (hour >= 22 || hour <= 5) {
        baseTemp -= 6; // Night is cooler
      } else if (hour >= 12 && hour <= 16) {
        baseTemp += 4; // Afternoon is warmer
      }

      // Add some randomness
      const temp = baseTemp + Math.floor(Math.random() * 4) - 2;
      const wind = 8 + Math.floor(Math.random() * 8);
      const humidity = 60 + Math.floor(Math.random() * 20);

      // Determine weather based on season/time
      let weatherCode = 0; // Clear sky by default

      // April-June: Rainy season in Arunachal
      const month = now.getMonth();
      if (month >= 3 && month <= 5) {
        // 30% chance of rain during rainy season
        weatherCode = Math.random() > 0.7 ? (Math.random() > 0.5 ? 61 : 63) : 0;
      }

      // Oct-Feb: Winter months
      if (month >= 9 || month <= 1) {
        // Could be cloudy or foggy
        weatherCode = Math.random() > 0.6 ? 45 : 0;
      }

      return {
        temperature: temp,
        windSpeed: wind,
        weatherCode: weatherCode,
        humidity: humidity,
        lastUpdated: now.toISOString()
      };
    }

    // Update weather UI with data
    function updateWeatherUI(weather) {
      const weatherIcon = document.getElementById('weatherIcon');
      const weatherTemp = document.getElementById('weatherTemp');
      const weatherWind = document.getElementById('weatherWind');
      const weatherHumidity = document.getElementById('weatherHumidity');
      const weatherLocation = document.getElementById('weatherLocation');

      // Map weather code to icon
      const iconMap = {
        0: 'fa-sun', // Clear sky
        1: 'fa-sun', // Mainly clear
        2: 'fa-cloud-sun', // Partly cloudy
        3: 'fa-cloud', // Overcast
        45: 'fa-smog', // Fog
        48: 'fa-smog', // Depositing rime fog
        51: 'fa-cloud-rain', // Light drizzle
        53: 'fa-cloud-rain', // Moderate drizzle
        55: 'fa-cloud-rain', // Dense drizzle
        61: 'fa-cloud-rain', // Slight rain
        63: 'fa-cloud-showers-heavy', // Moderate rain
        65: 'fa-cloud-showers-heavy', // Heavy rain
        71: 'fa-snowflake', // Slight snow
        73: 'fa-snowflake', // Moderate snow
        75: 'fa-snowflake', // Heavy snow
        80: 'fa-cloud-rain', // Slight rain showers
        81: 'fa-cloud-showers-heavy', // Moderate rain showers
        82: 'fa-cloud-showers-heavy', // Violent rain showers
        95: 'fa-bolt', // Thunderstorm
        96: 'fa-bolt', // Thunderstorm with hail
        99: 'fa-bolt' // Heavy thunderstorm with hail
      };

      // Determine weather condition text
      let conditionText = 'Clear sky';
      if (weather.weatherCode >= 1 && weather.weatherCode <= 3) conditionText = 'Partly Cloudy';
      else if (weather.weatherCode >= 45 && weather.weatherCode <= 48) conditionText = 'Foggy';
      else if (weather.weatherCode >= 51 && weather.weatherCode <= 55) conditionText = 'Drizzle';
      else if (weather.weatherCode >= 61 && weather.weatherCode <= 65) conditionText = 'Rainy';
      else if (weather.weatherCode >= 71 && weather.weatherCode <= 75) conditionText = 'Snowy';
      else if (weather.weatherCode >= 80 && weather.weatherCode <= 82) conditionText = 'Rain Showers';
      else if (weather.weatherCode >= 95 && weather.weatherCode <= 99) conditionText = 'Thunderstorm';

      // Update UI with animation
      gsap.to(weatherIcon, {
        rotation: 360,
        duration: 1,
        ease: 'power2.out'
      });

      gsap.to([weatherTemp, weatherWind, weatherHumidity, weatherLocation], {
        opacity: 0,
        y: -10,
        duration: 0.3,
        onComplete: () => {
          weatherIcon.className = `fas ${iconMap[weather.weatherCode] || 'fa-sun'}`;
          weatherTemp.textContent = `${Math.round(weather.temperature)}°C`;
          weatherWind.textContent = `${Math.round(weather.windSpeed)} km/h`;
          weatherHumidity.textContent = `${weather.humidity}%`;
          weatherLocation.textContent = `NERIST Campus • ${conditionText}`;

          gsap.to([weatherTemp, weatherWind, weatherHumidity, weatherLocation], {
            opacity: 1,
            y: 0,
            duration: 0.5,
            ease: 'power2.out'
          });
        }
      });
    }

    // ===== UTILITY FUNCTIONS =====
    function toggleMobileMenu() {
      const navMenu = document.querySelector('.nav-menu');
      navMenu.classList.toggle('active');

      if (navMenu.classList.contains('active')) {
        gsap.from(navMenu, {
          x: 300,
          opacity: 0,
          duration: 0.4,
          ease: 'power3.out'
        });
      }
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);

      if (!modal) {
        console.error(`Modal with id ${modalId} not found`);
        return;
      }

      // Kill any running animations
      gsap.killTweensOf(modal);
      if (modal.querySelector('.modal-content')) {
        gsap.killTweensOf(modal.querySelector('.modal-content'));
      }

      // Animate out
      gsap.to(modal, {
        opacity: 0,
        duration: 0.3,
        ease: 'power2.in',
        onComplete: () => {
          modal.classList.remove('active');
          modal.style.display = 'none';

          // Stop emergency sound when closing SOS modal
          if (modalId === 'sosModal') {
            stopEmergencySound();
          }

          // Reset any form fields in the modal
          const inputs = modal.querySelectorAll('input, textarea, select');
          inputs.forEach(input => {
            if (input.type !== 'checkbox' && input.type !== 'radio') {
              input.value = '';
            }
          });

          // For radio/checkboxes
          modal.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
            input.checked = false;
          });

          // Reset radio buttons in attendance modal to default
          if (modalId === 'addAttendanceModal') {
            const defaultRadio = modal.querySelector('input[value="present"]');
            if (defaultRadio) defaultRadio.checked = true;
          }
        }
      });
    }

    // ADD THE closeAllModals() FUNCTION RIGHT HERE
    function closeAllModals() {
      document.querySelectorAll('.modal.active').forEach(modal => {
        const modalId = modal.id;
        if (modalId) {
          // Don't close user modal with ESC if it's the only one open
          // This allows user to close it properly with the close button or clicking outside
          if (modalId === 'userModal') {
            // Only close user modal if there are other modals open
            const otherModals = document.querySelectorAll('.modal.active:not(#userModal)');
            if (otherModals.length === 0) {
              return; // Don't close user modal with ESC
            }
          }
          closeModal(modalId);
        } else {
          // For modals without ID
          modal.classList.remove('active');
          modal.style.display = 'none';
          gsap.set(modal, { opacity: 0 });
        }
      });
    }

    function toggleUserMenu(event) {
      if (event) {
        event.stopPropagation(); // Prevent event bubbling
      }

      if (!currentUser) {
        showLoginPage();
        return;
      }

      const userModal = document.getElementById('userModal');

      // Check if modal is currently active
      if (userModal.classList.contains('active')) {
        // Close the modal
        closeModal('userModal');
      } else {
        // Open the modal
        openModal('userModal');
      }
    }

    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      if (!modal) return;

      // Kill any existing animations
      gsap.killTweensOf(modal);
      if (modal.querySelector('.modal-content')) {
        gsap.killTweensOf(modal.querySelector('.modal-content'));
      }

      // Set display to flex and then animate in
      modal.style.display = 'flex';

      // Force reflow to ensure display: flex is applied before animation
      modal.offsetHeight;

      // Animate in
      gsap.fromTo(modal,
        { opacity: 0 },
        { opacity: 1, duration: 0.3, ease: 'power2.out' }
      );

      gsap.fromTo(modal.querySelector('.modal-content'),
        { scale: 0.9, y: 30, opacity: 0 },
        { scale: 1, y: 0, opacity: 1, duration: 0.4, ease: 'power2.out' }
      );

      modal.classList.add('active');
    }

    function showNotification(message, type = 'info') {
      // Remove existing notification
      const existingNotification = document.querySelector('.custom-notification');
      if (existingNotification) existingNotification.remove();

      // Create notification
      const notification = document.createElement('div');
      notification.className = 'custom-notification';
      notification.style.cssText = `
        position: fixed;
        top: 120px;
        right: 25px;
        padding: 18px 30px;
        background: ${type === 'success' ? 'var(--success)' :
          type === 'warning' ? 'var(--warning)' :
            type === 'danger' ? 'var(--danger)' : 'var(--primary)'};
        color: white;
        border-radius: 12px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        z-index: 3000;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        font-weight: 500;
        max-width: min(350px, 90vw);
        font-size: 1rem;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);

      // Animate in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 10);

      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    function sendNotification(title, body) {
      if (!('Notification' in window)) return;

      if (Notification.permission === 'granted') {
        new Notification(title, { body: body });
      } else if (Notification.permission !== 'denied') {
        Notification.requestPermission();
      }
    }

    function sendEmergencyNotification(title, body) {
      if (!('Notification' in window)) return;

      if (Notification.permission === 'granted') {
        new Notification(title, {
          body: body,
          requireInteraction: true
        });
      }
    }

    function forceSync() {
      const syncStatus = document.getElementById('syncStatus');
      syncStatus.innerHTML = '<span style="color: var(--warning); font-weight: 600;"><i class="fas fa-sync-alt fa-spin"></i> Syncing...</span>';

      setTimeout(() => {
        syncStatus.innerHTML = '<span style="color: var(--success); font-weight: 600;"><i class="fas fa-check-circle"></i> Sync completed!</span>';
        showNotification('Data synchronized successfully', 'success');
      }, 1500);
    }

    // ===== SIMULATION FUNCTIONS =====
    function simulateRealTimeUpdates() {
      // Update active students
      const studentsEl = document.getElementById('activeStudents');
      const currentStudents = parseInt(studentsEl.textContent.replace(',', ''));
      const newStudents = currentStudents + Math.floor(Math.random() * 5) - 2;
      studentsEl.textContent = Math.max(2700, Math.min(2900, newStudents)).toLocaleString();

      // Update live alerts
      const alertsEl = document.getElementById('liveAlerts');
      const currentAlerts = parseInt(alertsEl.textContent);
      const newAlerts = Math.max(8, Math.min(20, currentAlerts + Math.floor(Math.random() * 3) - 1));
      alertsEl.textContent = newAlerts;
    }

    // ===== MOCK FUNCTIONS =====
    function editProfile() {
      if (!currentUser) {
        showNotification('Please login to edit profile', 'warning');
        return;
      }

      // Populate form with current user data
      document.getElementById('editName').value = currentUser.name || '';
      document.getElementById('editEmail').value = currentUser.email || '';
      document.getElementById('editPhone').value = currentUser.phone || '';
      document.getElementById('editDept').value = currentUser.dept || 'Computer Science & Engineering';
      document.getElementById('editYear').value = currentUser.year || '3rd Year';

      // Set avatar color
      const avatarColor = currentUser.avatarColor || 'primary';
      document.querySelectorAll('.avatar-color-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.color === avatarColor) {
          btn.classList.add('active');
        }
      });

      // Set email preferences
      document.getElementById('emailAttendance').checked = currentUser.emailPreferences?.attendance ?? true;
      document.getElementById('emailMess').checked = currentUser.emailPreferences?.mess ?? true;
      document.getElementById('emailCareer').checked = currentUser.emailPreferences?.career ?? true;
      document.getElementById('emailAlerts').checked = currentUser.emailPreferences?.alerts ?? false;

      // Close user modal and open edit modal
      closeModal('userModal');
      setTimeout(() => {
        document.getElementById('editProfileModal').classList.add('active');
      }, 300);
    }

    function saveProfile() {
      const name = document.getElementById('editName').value.trim();
      const email = document.getElementById('editEmail').value.trim();
      const phone = document.getElementById('editPhone').value.trim();
      const dept = document.getElementById('editDept').value;
      const year = document.getElementById('editYear').value;
      const avatarColor = document.querySelector('.avatar-color-btn.active')?.dataset.color || 'primary';

      if (!name) {
        showNotification('Name is required', 'warning');
        return;
      }

      if (email && !validateEmail(email)) {
        showNotification('Please enter a valid email address', 'warning');
        return;
      }

      // Update current user
      currentUser.name = name;
      currentUser.email = email;
      currentUser.phone = phone;
      currentUser.dept = dept;
      currentUser.year = year;
      currentUser.avatarColor = avatarColor;

      // Save email preferences
      currentUser.emailPreferences = {
        attendance: document.getElementById('emailAttendance').checked,
        mess: document.getElementById('emailMess').checked,
        career: document.getElementById('emailCareer').checked,
        alerts: document.getElementById('emailAlerts').checked
      };

      // Update initials based on name
      const names = name.split(' ');
      currentUser.initials = names[0][0] + (names[1] ? names[1][0] : names[0][1] || 'U').toUpperCase();

      // Save to localStorage
      localStorage.setItem('neristUser', JSON.stringify(currentUser));

      // Update UI
      updateUserDisplay();
      updateAvatarColor();

      // Show success
      showNotification('Profile updated successfully!', 'success');
      closeModal('editProfileModal');
    }

    function updateAvatarColor() {
      const avatar = document.querySelector('.user-avatar');
      if (avatar && currentUser?.avatarColor) {
        const colorVar = `--${currentUser.avatarColor}`;
        const color = getComputedStyle(document.documentElement).getPropertyValue(colorVar);
        avatar.style.background = color;
      }
    }

    function notificationSettings() {
      if (!currentUser) {
        showNotification('Please login to change notification settings', 'warning');
        return;
      }

      // Load saved notification settings or use defaults
      const settings = currentUser.notificationSettings || getDefaultNotificationSettings();

      // Populate form
      document.getElementById('pushNotifications').checked = settings.pushEnabled;
      document.getElementById('notifyAttendance').checked = settings.types.attendance;
      document.getElementById('notifyMess').checked = settings.types.mess;
      document.getElementById('notifyCareer').checked = settings.types.career;
      document.getElementById('notifySafety').checked = settings.types.safety;
      document.getElementById('notifyCampusAlerts').checked = settings.types.campusAlerts;
      document.getElementById('notifyEvents').checked = settings.types.events;
      document.getElementById('notificationFrequency').value = settings.frequency;
      document.getElementById('quietStart').value = settings.quietHours.start;
      document.getElementById('quietEnd').value = settings.quietHours.end;
      document.getElementById('soundEnabled').checked = settings.soundEnabled;
      document.getElementById('vibrationEnabled').checked = settings.vibrationEnabled;

      closeModal('userModal');
      setTimeout(() => {
        document.getElementById('notificationSettingsModal').classList.add('active');
      }, 300);
    }

    function saveNotificationSettings() {
      // Get all settings
      const settings = {
        pushEnabled: document.getElementById('pushNotifications').checked,
        types: {
          attendance: document.getElementById('notifyAttendance').checked,
          mess: document.getElementById('notifyMess').checked,
          career: document.getElementById('notifyCareer').checked,
          safety: document.getElementById('notifySafety').checked,
          campusAlerts: document.getElementById('notifyCampusAlerts').checked,
          events: document.getElementById('notifyEvents').checked
        },
        frequency: document.getElementById('notificationFrequency').value,
        quietHours: {
          start: document.getElementById('quietStart').value,
          end: document.getElementById('quietEnd').value
        },
        soundEnabled: document.getElementById('soundEnabled').checked,
        vibrationEnabled: document.getElementById('vibrationEnabled').checked,
        lastUpdated: new Date().toISOString()
      };

      // Save to current user
      currentUser.notificationSettings = settings;
      localStorage.setItem('neristUser', JSON.stringify(currentUser));

      // Request notification permission if enabled
      if (settings.pushEnabled) {
        requestNotificationPermission();
      }

      showNotification('Notification settings saved!', 'success');
      closeModal('notificationSettingsModal');
    }

    function resetNotificationSettings() {
      if (confirm('Reset all notification settings to default?')) {
        const defaultSettings = getDefaultNotificationSettings();

        document.getElementById('pushNotifications').checked = defaultSettings.pushEnabled;
        document.getElementById('notifyAttendance').checked = defaultSettings.types.attendance;
        document.getElementById('notifyMess').checked = defaultSettings.types.mess;
        document.getElementById('notifyCareer').checked = defaultSettings.types.career;
        document.getElementById('notifySafety').checked = defaultSettings.types.safety;
        document.getElementById('notifyCampusAlerts').checked = defaultSettings.types.campusAlerts;
        document.getElementById('notifyEvents').checked = defaultSettings.types.events;
        document.getElementById('notificationFrequency').value = defaultSettings.frequency;
        document.getElementById('quietStart').value = defaultSettings.quietHours.start;
        document.getElementById('quietEnd').value = defaultSettings.quietHours.end;
        document.getElementById('soundEnabled').checked = defaultSettings.soundEnabled;
        document.getElementById('vibrationEnabled').checked = defaultSettings.vibrationEnabled;

        showNotification('Settings reset to default', 'info');
      }
    }

    function testNotification() {
      if (!('Notification' in window)) {
        showNotification('Browser does not support notifications', 'warning');
        return;
      }

      const settings = currentUser?.notificationSettings || getDefaultNotificationSettings();

      if (!settings.pushEnabled) {
        showNotification('Enable push notifications first', 'warning');
        return;
      }

      // Create a test notification
      if (Notification.permission === 'granted') {
        new Notification('NERIST One - Test Notification', {
          body: 'This is a test notification to confirm your settings are working correctly!',
          icon: 'https://nerist.ac.in/images/nerist_logo.png',
          tag: 'test-notification'
        });
        showNotification('Test notification sent!', 'success');
      } else {
        requestNotificationPermission();
      }
    }

    function getDefaultNotificationSettings() {
      return {
        pushEnabled: true,
        types: {
          attendance: true,
          mess: true,
          career: true,
          safety: true,
          campusAlerts: true,
          events: false
        },
        frequency: 'immediate',
        quietHours: {
          start: '22:00',
          end: '06:00'
        },
        soundEnabled: true,
        vibrationEnabled: true,
        lastUpdated: new Date().toISOString()
      };
    }

    function requestNotificationPermission() {
      if (!('Notification' in window)) return;

      if (Notification.permission === 'default') {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            showNotification('Push notifications enabled!', 'success');
          }
        });
      } else if (Notification.permission === 'denied') {
        showNotification('Notifications are blocked. Please enable them in browser settings.', 'warning');
      }
    }

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function downloadOfflineMap() {
      showNotification('Downloading offline maps...', 'info');
    }

    function findMoreOpportunities() {
      showNotification('Searching for more opportunities...', 'info');
    }

    function viewAllApplications() {
      showNotification('Opening all applications...', 'info');
    }

    function showPreviousDay() {
      showNotification('Loading previous day menu...', 'info');
    }

    function showNextDay() {
      showNotification('Loading next day menu...', 'info');
    }

    function reportAttendanceIssue(index) {
      showNotification('Opening attendance issue report form...', 'info');
    }

    // ===== ATTENDANCE REPORT SYSTEM =====
    let currentAttendanceIndex = null;

    function openReportAttendanceModal(index) {
      if (currentUserRole !== 'student') {
        showNotification('Only students can report attendance issues', 'warning');
        return;
      }

      currentAttendanceIndex = index;
      const attendanceRecord = attendanceData[index];

      // Pre-fill form with attendance data
      document.getElementById('reportAttendanceDate').value = attendanceRecord.date;

      // Set subject based on attendance record
      const subjectSelect = document.getElementById('reportSubject');
      const subjectCode = attendanceRecord.subject.toLowerCase();
      if (subjectCode.includes('data structures') || subjectCode.includes('cs-301')) {
        subjectSelect.value = 'cs301';
      } else if (subjectCode.includes('algorithms') || subjectCode.includes('cs-302')) {
        subjectSelect.value = 'cs302';
      } else if (subjectCode.includes('networks') || subjectCode.includes('cs-303')) {
        subjectSelect.value = 'cs303';
      } else {
        subjectSelect.value = '';
      }

      // Clear other fields
      document.getElementById('reportIssueType').value = '';
      document.getElementById('reportDetails').value = '';
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
      document.querySelector('input[name="resolution"][value="update"]').checked = true;

      // Open modal
      openModal('reportAttendanceModal');
    }

    function submitAttendanceReport() {
      const date = document.getElementById('reportAttendanceDate').value;
      const subject = document.getElementById('reportSubject').value;
      const issueType = document.getElementById('reportIssueType').value;
      const details = document.getElementById('reportDetails').value.trim();
      const resolution = document.querySelector('input[name="resolution"]:checked').value;

      // Validation
      if (!date || !subject || !issueType || !details) {
        showNotification('Please fill all required fields', 'warning');
        return;
      }

      if (details.length < 20) {
        showNotification('Please provide detailed explanation (at least 20 characters)', 'warning');
        return;
      }

      // Get evidence
      const evidence = [];
      if (document.getElementById('evidence-classwork').checked) evidence.push('Classwork');
      if (document.getElementById('evidence-peers').checked) evidence.push('Peer Verification');
      if (document.getElementById('evidence-other').checked) evidence.push('Other');

      // Create report object
      const report = {
        id: 'REP-' + Date.now(),
        date: date,
        subject: document.getElementById('reportSubject').options[document.getElementById('reportSubject').selectedIndex].text,
        issueType: issueType,
        details: details,
        evidence: evidence,
        resolution: resolution,
        status: 'pending',
        submittedBy: currentUser?.name || 'Student',
        submittedOn: new Date().toISOString().split('T')[0],
        attendanceIndex: currentAttendanceIndex
      };

      // Save to localStorage (simulating database)
      let reports = JSON.parse(localStorage.getItem('attendanceReports') || '[]');
      reports.push(report);
      localStorage.setItem('attendanceReports', JSON.stringify(reports));

      // Show confirmation
      showNotification('Attendance report submitted successfully!', 'success');

      // Close modal
      closeModal('reportAttendanceModal');

      // Log to console (for debugging)
      console.log('Attendance Report Submitted:', report);

      // Send email notification (simulated)
      sendReportNotification(report);
    }

    function sendReportNotification(report) {
      // In a real application, this would send an email to faculty/admin
      console.log('Report notification sent for:', report.id);

      // Show success message
      setTimeout(() => {
        showNotification('Report has been sent to the faculty for review', 'info');
      }, 500);
    }

    function viewSubmittedReports() {
      const reports = JSON.parse(localStorage.getItem('attendanceReports') || '[]');

      if (reports.length === 0) {
        showNotification('No reports submitted yet', 'info');
        return;
      }

      // Create modal to show reports
      let reportsModal = document.getElementById('viewReportsModal');

      if (!reportsModal) {
        reportsModal = document.createElement('div');
        reportsModal.className = 'modal';
        reportsModal.id = 'viewReportsModal';
        reportsModal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 2000; align-items: center; justify-content: center; padding: 20px;';

        reportsModal.innerHTML = `
      <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
        <div class="modal-close" onclick="closeModal('viewReportsModal')">
          <i class="fas fa-times"></i>
        </div>
        <h2 class="modal-title">Submitted Reports</h2>
        <div class="modal-body" id="reportsList">
          <!-- Reports will be populated here -->
        </div>
      </div>
    `;

        document.body.appendChild(reportsModal);
      }

      // Populate reports
      const reportsList = document.getElementById('reportsList');
      let html = '';

      if (reports.length === 0) {
        html = '<p style="text-align: center; color: var(--gray); padding: 40px;">No reports submitted yet.</p>';
      } else {
        html = '<div style="display: grid; gap: 20px;">';

        reports.forEach((report, index) => {
          const statusColor = report.status === 'pending' ? 'var(--warning)' :
            report.status === 'resolved' ? 'var(--success)' : 'var(--danger)';

          html += `
        <div class="card" style="margin-bottom: 0;">
          <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3 class="card-title">${report.subject}</h3>
            <span style="background: ${statusColor + '20'}; color: ${statusColor}; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
              ${report.status.charAt(0).toUpperCase() + report.status.slice(1)}
            </span>
          </div>
          <div class="card-body">
            <p><strong>Date:</strong> ${report.date}</p>
            <p><strong>Issue:</strong> ${report.issueType}</p>
            <p><strong>Details:</strong> ${report.details}</p>
            <p><strong>Evidence:</strong> ${report.evidence.join(', ') || 'None'}</p>
            <p><strong>Submitted:</strong> ${report.submittedOn} by ${report.submittedBy}</p>
          </div>
        </div>
      `;
        });

        html += '</div>';
      }

      reportsList.innerHTML = html;
      openModal('viewReportsModal');
    }

    // Add "View Reports" button to attendance section
    function addViewReportsButton() {
      if (currentUserRole !== 'student') return;

      const attendanceContainer = document.querySelector('#attendance .attendance-container');
      const existingButton = document.querySelector('#viewReportsBtn');

      if (!existingButton && attendanceContainer) {
        const viewReportsBtn = document.createElement('button');
        viewReportsBtn.className = 'btn btn-outline';
        viewReportsBtn.id = 'viewReportsBtn';
        viewReportsBtn.innerHTML = '<i class="fas fa-list-check"></i> View Submitted Reports';
        viewReportsBtn.onclick = viewSubmittedReports;
        viewReportsBtn.style.marginTop = '20px';

        attendanceContainer.appendChild(viewReportsBtn);
      }
    }

    function editAttendance(index) {
      showNotification('Editing attendance record...', 'info');
    }

    function viewProtocol(type) {
      const protocolType = {
        'medical': 'Medical Emergency',
        'fire': 'Fire Emergency',
        'earthquake': 'Earthquake Emergency',
        'flood': 'Flood Emergency'
      };

      const protocolTitle = protocolType[type] || 'Emergency Procedures';
      const protocolDetails = {
        'medical': `
      <h3 style="color: var(--light); margin-bottom: 15px;">${protocolTitle} Procedures</h3>
      <ul style="color: var(--gray); padding-left: 20px; margin-bottom: 20px; line-height: 1.8;">
        <li>Immediately call campus security: <strong>+91 98765 43210</strong></li>
        <li>If injured, remain still and wait for medical personnel</li>
        <li>Apply first aid if trained to do so</li>
        <li>Clear the area for emergency vehicle access</li>
        <li>Designated medical zones: Main Medical Center (0.6km), Admin Block First Aid Station (0.3km)</li>
      </ul>
      <p style="color: var(--gray); margin-bottom: 15px;">
        <strong>Immediate Actions:</strong> Stay calm, assess the situation, call for help, provide basic first aid if safe to do so.
      </p>
    `,
        'fire': `
      <h3 style="color: var(--light); margin-bottom: 15px;">${protocolTitle} Procedures</h3>
      <ul style="color: var(--gray); padding-left: 20px; margin-bottom: 20px; line-height: 1.8;">
        <li>Activate nearest fire alarm</li>
        <li>Evacuate immediately using nearest exit</li>
        <li>Do NOT use elevators</li>
        <li>Close doors behind you to contain fire</li>
        <li>Assemble at designated assembly points: Main Playground (Zone A), Auditorium Parking (Zone B)</li>
        <li>Call fire department: <strong>101</strong></li>
      </ul>
      <p style="color: var(--gray); margin-bottom: 15px;">
        <strong>Remember:</strong> RACE - Rescue, Alarm, Contain, Evacuate
      </p>
    `,
        'earthquake': `
      <h3 style="color: var(--light); margin-bottom: 15px;">${protocolTitle} Procedures</h3>
      <ul style="color: var(--gray); padding-left: 20px; margin-bottom: 20px; line-height: 1.8;">
        <li>DROP to the ground</li>
        <li>COVER under sturdy furniture</li>
        <li>HOLD ON until shaking stops</li>
        <li>Stay away from windows, bookcases, or tall furniture</li>
        <li>If outdoors, move to open area away from buildings and power lines</li>
        <li>After shaking stops, evacuate to designated safe zones</li>
      </ul>
      <p style="color: var(--gray); margin-bottom: 15px;">
        <strong>Designated Safe Zones:</strong> Main Playground, Sports Complex Field, Open spaces away from buildings
      </p>
    `,
        'flood': `
      <h3 style="color: var(--light); margin-bottom: 15px;">${protocolTitle} Procedures</h3>
      <ul style="color: var(--gray); padding-left: 20px; margin-bottom: 20px; line-height: 1.8;">
        <li>Move to higher ground immediately</li>
        <li>Do NOT walk through flowing water (6 inches can knock you down)</li>
        <li>Do NOT drive through flooded areas</li>
        <li>Stay away from power lines and electrical wires</li>
        <li>Listen to emergency alerts for evacuation orders</li>
        <li>Designated high ground: Admin Block (2nd floor), Library (1st floor elevated)</li>
      </ul>
      <p style="color: var(--gray); margin-bottom: 15px;">
        <strong>Warning:</strong> Flash floods can occur suddenly. Monitor weather alerts and evacuate early if advised.
      </p>
    `
      };

      // Create or update emergency protocol modal
      let protocolModal = document.getElementById('emergencyProtocolModal');

      if (!protocolModal) {
        // Create the modal if it doesn't exist
        protocolModal = document.createElement('div');
        protocolModal.className = 'modal';
        protocolModal.id = 'emergencyProtocolModal';
        protocolModal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 2000; align-items: center; justify-content: center; padding: 20px;';

        protocolModal.innerHTML = `
      <div class="modal-content" style="position: relative; z-index: 2001;">
        <div class="modal-close" onclick="closeModal('emergencyProtocolModal')" style="position: absolute; top: 20px; right: 20px; font-size: 1.8rem; cursor: pointer; color: var(--gray); transition: all 0.3s ease; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1001; background: var(--card-bg);">
          <i class="fas fa-times"></i>
        </div>
        <h2 class="modal-title" id="protocolModalTitle" style="font-size: clamp(1.5rem, 4vw, 2.2rem); margin-bottom: 25px; color: var(--light);">Emergency Procedures</h2>
        <div class="modal-body" id="protocolModalBody" style="color: var(--gray); margin-bottom: 40px; line-height: 1.8; font-size: clamp(1rem, 2vw, 1.1rem);">
          <!-- Content will be inserted here -->
        </div>
        <button class="btn btn-primary" onclick="closeModal('emergencyProtocolModal')" style="width: 100%; padding: 15px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; border-radius: 50px; font-weight: 600; cursor: pointer; font-size: 1rem;">
          Close Procedures
        </button>
      </div>
    `;
        document.body.appendChild(protocolModal);
      }

      // Update modal content
      document.getElementById('protocolModalTitle').textContent = `${protocolTitle} Procedures`;
      document.getElementById('protocolModalBody').innerHTML = `
    <p style="color: var(--gray); margin-bottom: 20px; font-size: 1.1rem;">
      <strong>Access emergency procedures for medical issues, natural disasters, fire, and other critical situations.</strong>
    </p>
    ${protocolDetails[type] || '<p>Emergency procedures information not available for this type.</p>'}
    
    <div style="background: rgba(34, 211, 238, 0.1); padding: 20px; border-radius: 12px; margin-top: 25px;">
      <p style="color: var(--light); margin-bottom: 10px;">
        <strong><i class="fas fa-phone-alt"></i> Emergency Contacts:</strong>
      </p>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 10px;">
        <div>
          <p style="color: var(--gray); margin-bottom: 5px;">Campus Security</p>
          <p style="color: var(--light); font-weight: 600;">+91 98765 43210</p>
        </div>
        <div>
          <p style="color: var(--gray); margin-bottom: 5px;">Medical Center</p>
          <p style="color: var(--light); font-weight: 600;">+91 98765 43211</p>
        </div>
      </div>
    </div>
  `;

      // Show the modal
      protocolModal.classList.add('active');
      protocolModal.style.display = 'flex';
      protocolModal.style.opacity = '1';

      // Ensure modal content is visible
      const modalContent = protocolModal.querySelector('.modal-content');
      modalContent.style.display = 'block';
      modalContent.style.opacity = '1';

      // Kill any existing animations on this modal
      gsap.killTweensOf(protocolModal);
      gsap.killTweensOf(modalContent);

      // Animate modal in
      gsap.fromTo(protocolModal,
        { opacity: 0 },
        { opacity: 1, duration: 0.3, ease: 'power2.out' }
      );

      gsap.fromTo(modalContent,
        { scale: 0.9, y: 30, opacity: 0 },
        { scale: 1, y: 0, opacity: 1, duration: 0.4, ease: 'power2.out' }
      );

      // Add click outside to close
      protocolModal.addEventListener('click', function (e) {
        if (e.target === protocolModal) {
          closeModal('emergencyProtocolModal');
        }
      });

      // Add keyboard escape handler
      const handleEscape = (e) => {
        if (e.key === 'Escape') {
          closeModal('emergencyProtocolModal');
          document.removeEventListener('keydown', handleEscape);
        }
      };

      document.addEventListener('keydown', handleEscape);

      // Clean up event listener when modal closes
      protocolModal.dataset.escapeHandler = 'true';

      return false; // Prevent any default behavior
    }

    function showRoute(type) {
      showNotification(`Showing ${type} evacuation route...`, 'info');
    }

    function contactSupport() {
      // Create or update contact support modal
      let contactModal = document.getElementById('contactSupportModal');

      if (!contactModal) {
        // Create the modal if it doesn't exist
        contactModal = document.createElement('div');
        contactModal.className = 'modal';
        contactModal.id = 'contactSupportModal';
        contactModal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 2000; align-items: center; justify-content: center; padding: 20px;';

        contactModal.innerHTML = `
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-close" onclick="closeModal('contactSupportModal')">
          <i class="fas fa-times"></i>
        </div>
        <h2 class="modal-title">Contact Support</h2>
        <div class="modal-body">
          <div style="text-align: center; margin-bottom: 30px;">
            <div style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;">
              <i class="fas fa-headset"></i>
            </div>
            <h3 style="color: var(--light); margin-bottom: 15px;">NERIST One Support</h3>
            <p style="color: var(--gray); margin-bottom: 25px;">Get help with the NERIST One platform</p>
          </div>
          
          <div style="background: var(--card-bg); padding: 25px; border-radius: 15px; margin-bottom: 25px;">
            <h4 style="color: var(--light); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-code"></i> Development & Technical Support
            </h4>
            
            <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
              <div>
                <div style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">Developer</div>
                <div style="color: var(--light); font-size: 1.1rem; margin-bottom: 5px;">
                  <i class="fas fa-user-circle"></i> Tanmoy Banik
                </div>
              </div>
              
              <div>
                <div style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">Contact Number</div>
                <div style="color: var(--light); font-size: 1.1rem;">
                  <i class="fas fa-phone"></i> 
                  <a href="tel:+919800177503" style="color: var(--secondary); text-decoration: none; margin-left: 10px;">
                    +91 9800177503
                  </a>
                </div>
                <div style="color: var(--gray); font-size: 0.9rem; margin-top: 8px;">
                  Available: Mon-Fri, 9 AM - 6 PM
                </div>
              </div>
              
              <div>
                <div style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">Project</div>
                <div style="color: var(--light);">
                  <i class="fas fa-rocket"></i> NERIST One - Smart Campus OS
                </div>

              </div>
            </div>
          </div>
          
          <div style="background: rgba(34, 211, 238, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
            <h4 style="color: var(--light); margin-bottom: 15px; font-size: 1.1rem;">
              <i class="fas fa-info-circle"></i> Additional Support Channels
            </h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
              <div>
                <div style="color: var(--gray); margin-bottom: 5px;">Institute Email</div>
                <div style="color: var(--light);">registrar@nerist.ac.in</div>
              </div>
              <div>
                <div style="color: var(--gray); margin-bottom: 5px;">Phone</div>
                <div style="color: var(--light);">+91 360 2257401-408</div>
              </div>
            </div>
          </div>
          
          <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--card-border);">
            <p style="color: var(--gray); font-size: 0.9rem; text-align: center;">
              <i class="fas fa-clock"></i> Response Time: Within 24 hours on weekdays
            </p>
          </div>
        </div>
        <div style="display: flex; gap: 15px;">
          <button class="btn btn-secondary" onclick="closeModal('contactSupportModal')" style="flex: 1;">
            Close
          </button>
          <button class="btn btn-primary" onclick="window.open('tel:+919800177503')" style="flex: 1;">
            <i class="fas fa-phone"></i> Call Now
          </button>
        </div>
      </div>
    `;

        document.body.appendChild(contactModal);
      }

      // Open the modal
      openModal('contactSupportModal');
    }

    function showPrivacyPolicy() {
      const modal = document.getElementById('privacyModal');

      // Reset any existing animations
      gsap.killTweensOf(modal);
      gsap.killTweensOf(modal.querySelector('.modal-content'));

      // Ensure modal is visible
      modal.style.display = 'flex';

      // Animate in
      gsap.fromTo(modal,
        { opacity: 0 },
        { opacity: 1, duration: 0.3, ease: 'power2.out' }
      );

      gsap.fromTo(modal.querySelector('.modal-content'),
        { scale: 0.9, y: 30, opacity: 0 },
        { scale: 1, y: 0, opacity: 1, duration: 0.4, ease: 'power2.out' }
      );

      modal.classList.add('active');
    }

    // Add global escape key handler to close all modals
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        closeAllModals();
      }
    });

    // ===== EMERGENCY SOUND FUNCTIONS =====
    function playEmergencySound() {
      if (!isSoundEnabled) {
        console.log('Sound is disabled');
        return;
      }

      try {
        emergencySound = document.getElementById('emergencySound');

        if (!emergencySound) {
          console.error('Emergency sound element not found');
          showNotification('Sound file not found. Please ensure emergency_alarm.mp3 is in the same folder.', 'warning');
          return;
        }

        // Set volume
        emergencySound.volume = soundVolume;

        // Reset and play
        emergencySound.currentTime = 0;
        emergencySound.loop = true; // Loop the sound continuously

        const playPromise = emergencySound.play();

        if (playPromise !== undefined) {
          playPromise.then(() => {
            isSoundPlaying = true;
            updateSoundStatus();
            console.log('Emergency sound started playing');

            // Set timeout to auto-stop after 30 seconds (for safety)
            soundTimeout = setTimeout(() => {
              if (isSoundPlaying) {
                console.log('Auto-stopping emergency sound after 30 seconds');
                stopEmergencySound();
                showNotification('Emergency sound stopped automatically after 30 seconds', 'info');
              }
            }, 30000);
          }).catch(error => {
            console.error('Error playing emergency sound:', error);
            showNotification('Could not play emergency sound. Please check sound file.', 'warning');
            isSoundPlaying = false;
            updateSoundStatus();
          });
        }
      } catch (error) {
        console.error('Error in playEmergencySound:', error);
        isSoundPlaying = false;
        updateSoundStatus();
      }
    }

    function stopEmergencySound() {
      try {
        if (emergencySound) {
          emergencySound.pause();
          emergencySound.currentTime = 0;
        }

        isSoundPlaying = false;
        updateSoundStatus();

        // Clear the auto-stop timeout
        if (soundTimeout) {
          clearTimeout(soundTimeout);
          soundTimeout = null;
        }

        console.log('Emergency sound stopped');
      } catch (error) {
        console.error('Error stopping emergency sound:', error);
      }
    }

    function updateSoundStatus() {
      const soundStatus = document.getElementById('soundStatus');
      if (!soundStatus) return;

      if (!isSoundEnabled) {
        soundStatus.innerHTML = '<i class="fas fa-volume-mute"></i> Sound Disabled';
        soundStatus.className = 'sound-indicator';
        return;
      }

      if (isSoundPlaying) {
        soundStatus.innerHTML = '<i class="fas fa-volume-up" style="color: var(--danger); animation: pulse 1s infinite;"></i> Emergency Sound Active';
        soundStatus.className = 'sound-indicator active';
      } else {
        soundStatus.innerHTML = '<i class="fas fa-volume-up"></i> Sound Ready';
        soundStatus.className = 'sound-indicator';
      }
    }

    function testEmergencySound() {
      if (!isSoundEnabled) {
        showNotification('Enable sound first to test', 'warning');
        return;
      }

      try {
        const testSound = document.getElementById('emergencySound');
        if (!testSound) {
          showNotification('Sound file not found', 'warning');
          return;
        }

        // Save current state
        const wasPlaying = isSoundPlaying;

        // Temporarily play sound
        testSound.volume = soundVolume;
        testSound.currentTime = 0;
        testSound.loop = false;

        const playPromise = testSound.play();

        if (playPromise !== undefined) {
          playPromise.then(() => {
            showNotification('Playing test sound...', 'info');

            // Stop after 2 seconds
            setTimeout(() => {
              testSound.pause();
              testSound.currentTime = 0;

              // Restore original state if it was playing
              if (wasPlaying) {
                playEmergencySound();
              }
            }, 2000);
          }).catch(error => {
            console.error('Error playing test sound:', error);
            showNotification('Could not play test sound', 'warning');
          });
        }
      } catch (error) {
        console.error('Error in testEmergencySound:', error);
        showNotification('Error testing sound', 'warning');
      }
    }

    // Add pulse animation if not already defined
    if (!document.querySelector('style[data-pulse-animation]')) {
      const style = document.createElement('style');
      style.setAttribute('data-pulse-animation', 'true');
      style.textContent = `
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
  `;
      document.head.appendChild(style);
    }
    // Add input animations for login page
    document.addEventListener('DOMContentLoaded', function () {
      // Add delay animations to input groups
      const inputGroups = document.querySelectorAll('.input-group');
      inputGroups.forEach((group, index) => {
        group.style.setProperty('--delay', `${0.4 + (index * 0.1)}s`);
      });

      // Add input focus effects
      const inputs = document.querySelectorAll('.login-input, .login-select');

      inputs.forEach(input => {
        // Animate label on focus
        input.addEventListener('focus', function () {
          const label = this.parentElement.querySelector('label');
          if (label) {
            label.style.color = 'var(--primary)';
          }
        });

        input.addEventListener('blur', function () {
          if (!this.value) {
            const label = this.parentElement.querySelector('label');
            if (label) {
              label.style.color = '#8e8e8e';
            }
          }
        });
      });

      // Add subtle background animation
      const loginBg = document.querySelector('.login-background');
      if (loginBg) {
        gsap.to(loginBg, {
          backgroundPosition: '100% 100%',
          duration: 20,
          ease: 'none',
          repeat: -1,
          yoyo: true
        });
      }
    });

    // ===== MEAL PLAN SYSTEM =====
    let currentMealDateIndex = 0; // 0 = today, 1 = tomorrow, -1 = yesterday, etc.
    let currentDisplayDate = new Date('2026-05-15'); // Starting date
    let weeklyMealPlan = {};

    function initializeWeeklyMealPlan() {
      // Create 7-day meal plan (Sunday to Saturday)
      const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

      // Sample meal plans for each day
      weeklyMealPlan = {
        'Sunday': {
          breakfast: {
            items: ['Poha', 'Bread & Butter', 'Boiled Eggs', 'Tea/Coffee'],
            predictedDemand: 85,
            active: true
          },
          lunch: {
            items: ['Rice', 'Roti', 'Dal Fry', 'Paneer Butter Masala', 'Mix Veg', 'Salad'],
            predictedDemand: 92,
            active: true
          },
          dinner: {
            items: ['Jeera Rice', 'Roti', 'Chole Masala', 'Aloo Gobhi', 'Raita'],
            predictedDemand: 78,
            active: false
          }
        },
        'Monday': {
          breakfast: {
            items: ['Idli', 'Sambar', 'Coconut Chutney', 'Tea/Coffee'],
            predictedDemand: 82,
            active: true
          },
          lunch: {
            items: ['Rice', 'Roti', 'Rajma', 'Aloo Matar', 'Cucumber Raita', 'Salad'],
            predictedDemand: 88,
            active: true
          },
          dinner: {
            items: ['Fried Rice', 'Manchurian', 'Spring Roll', 'Soup'],
            predictedDemand: 75,
            active: true
          }
        },
        'Tuesday': {
          breakfast: {
            items: ['Paratha', 'Curd', 'Pickle', 'Tea/Coffee'],
            predictedDemand: 79,
            active: true
          },
          lunch: {
            items: ['Biryani', 'Raita', 'Salad', 'Boondi'],
            predictedDemand: 95,
            active: true
          },
          dinner: {
            items: ['Rice', 'Roti', 'Kadhi Pakora', 'Bhindi Masala', 'Salad'],
            predictedDemand: 72,
            active: true
          }
        },
        'Wednesday': {
          breakfast: {
            items: ['Sandwich', 'Cornflakes', 'Milk', 'Fruits'],
            predictedDemand: 76,
            active: true
          },
          lunch: {
            items: ['Rice', 'Roti', 'Chana Masala', 'Baingan Bharta', 'Salad'],
            predictedDemand: 87,
            active: true
          },
          dinner: {
            items: ['Noodles', 'Manchow Soup', 'Chilli Potato'],
            predictedDemand: 81,
            active: true
          }
        },
        'Thursday': {
          breakfast: {
            items: ['Uttapam', 'Sambar', 'Chutney', 'Tea/Coffee'],
            predictedDemand: 84,
            active: true
          },
          lunch: {
            items: ['Rice', 'Roti', 'Dal Makhani', 'Shahi Paneer', 'Salad'],
            predictedDemand: 90,
            active: true
          },
          dinner: {
            items: ['Rice', 'Roti', 'Fish Curry', 'Aloo Fry', 'Salad'],
            predictedDemand: 68,
            active: false
          }
        },
        'Friday': {
          breakfast: {
            items: ['Chole Bhature', 'Pickle', 'Tea/Coffee'],
            predictedDemand: 91,
            active: true
          },
          lunch: {
            items: ['Rice', 'Roti', 'Mutton Curry', 'Dal Fry', 'Salad'],
            predictedDemand: 94,
            active: true
          },
          dinner: {
            items: ['Pizza', 'Pasta', 'Garlic Bread', 'Soup'],
            predictedDemand: 89,
            active: true
          }
        },
        'Saturday': {
          breakfast: {
            items: ['Dosa', 'Sambar', 'Chutney', 'Tea/Coffee'],
            predictedDemand: 88,
            active: true
          },
          lunch: {
            items: ['Thali (Rice, Roti, 3 Sabzi, Dal, Salad, Sweet)'],
            predictedDemand: 96,
            active: true
          },
          dinner: {
            items: ['Rice', 'Roti', 'Egg Curry', 'Mix Veg', 'Salad'],
            predictedDemand: 74,
            active: true
          }
        }
      };

      // Initialize current date to May 15, 2026 (which was a Friday)
      currentDisplayDate = new Date('2026-05-15');
      updateMealDisplay();
    }

    function getDayName(date) {
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      return days[date.getDay()];
    }

    function formatMealDate(date) {
      const options = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }

    function updateMealDisplay() {
      const dayName = getDayName(currentDisplayDate);
      const formattedDate = formatMealDate(currentDisplayDate);

      // Update the date display
      const dateDisplay = document.querySelector('#mess .btn-outline + span');
      if (dateDisplay) {
        dateDisplay.textContent = formattedDate;
      }

      // Get today's meal plan
      const todayMeals = weeklyMealPlan[dayName];

      if (!todayMeals) {
        console.error('No meal plan found for', dayName);
        return;
      }

      // Update breakfast
      updateMealCard('breakfast', todayMeals.breakfast);

      // Update lunch
      updateMealCard('lunch', todayMeals.lunch);

      // Update dinner
      updateMealCard('dinner', todayMeals.dinner);

      // Update dinner status
      isDinnerActive = todayMeals.dinner.active;
      updateDinnerStatus();

      // Update prediction meter
      updatePredictionMeter(todayMeals);
    }

    function updateMealCard(mealType, mealData) {
      const mealCard = document.querySelector(`#mess .meal-card:nth-child(${getMealCardIndex(mealType)})`);
      if (!mealCard) return;

      // Update meal items
      const mealItemsContainer = mealCard.querySelector('.meal-items');
      if (mealItemsContainer) {
        mealItemsContainer.innerHTML = '';
        mealData.items.forEach(item => {
          const span = document.createElement('span');
          span.className = 'meal-item';
          span.textContent = item;
          mealItemsContainer.appendChild(span);
        });
      }

      // Update predicted demand
      const demandElement = mealCard.querySelector('.meal-stats strong');
      if (demandElement) {
        demandElement.textContent = `${mealData.predictedDemand}%`;
      }

      // Update booking status
      const bookingCheckbox = mealCard.querySelector('input[type="checkbox"]');
      if (bookingCheckbox) {
        bookingCheckbox.checked = false; // Reset booking for new day
      }

      // Update active status
      if (!mealData.active && mealType === 'dinner') {
        mealCard.classList.add('inactive');
      } else {
        mealCard.classList.remove('inactive');
      }
    }

    function getMealCardIndex(mealType) {
      switch (mealType) {
        case 'breakfast': return 1;
        case 'lunch': return 2;
        case 'dinner': return 3;
        default: return 1;
      }
    }

    function updatePredictionMeter(mealData) {
      const totalDemand = mealData.breakfast.predictedDemand +
        mealData.lunch.predictedDemand +
        (mealData.dinner.active ? mealData.dinner.predictedDemand : 0);
      const avgDemand = Math.round(totalDemand / (mealData.dinner.active ? 3 : 2));

      const predictionFill = document.querySelector('.prediction-fill');
      if (predictionFill) {
        predictionFill.style.width = `${avgDemand}%`;

        // Update the prediction text
        const predictionText = document.querySelector('#mess .prediction-meter + div span');
        if (predictionText) {
          predictionText.textContent = `${avgDemand}%`;
        }
      }
    }

    function showPreviousDay() {
      // Subtract one day
      currentDisplayDate.setDate(currentDisplayDate.getDate() - 1);
      currentMealDateIndex--;

      // Animate the transition
      animateMealTransition('left');

      // Update display after animation
      setTimeout(() => {
        updateMealDisplay();
        showNotification(`Showing meals for ${formatMealDate(currentDisplayDate)}`, 'info');
      }, 300);
    }

    function showNextDay() {
      // Add one day
      currentDisplayDate.setDate(currentDisplayDate.getDate() + 1);
      currentMealDateIndex++;

      // Animate the transition
      animateMealTransition('right');

      // Update display after animation
      setTimeout(() => {
        updateMealDisplay();
        showNotification(`Showing meals for ${formatMealDate(currentDisplayDate)}`, 'info');
      }, 300);
    }

    function animateMealTransition(direction) {
      const mealCards = document.querySelectorAll('#mess .meal-card');

      // Slide out animation
      gsap.to(mealCards, {
        x: direction === 'right' ? -100 : 100,
        opacity: 0,
        duration: 0.3,
        ease: 'power2.in',
        stagger: 0.05
      });

      // Reset position
      setTimeout(() => {
        gsap.set(mealCards, {
          x: direction === 'right' ? 100 : -100,
          opacity: 0
        });

        // Slide in animation
        gsap.to(mealCards, {
          x: 0,
          opacity: 1,
          duration: 0.3,
          ease: 'power2.out',
          stagger: 0.05
        });
      }, 300);
    }

    function jumpToToday() {
      const today = new Date('2026-05-15'); // Simulated "today"
      currentDisplayDate = new Date(today);
      currentMealDateIndex = 0;

      // Animate transition
      gsap.to('#mess .meal-card', {
        scale: 0.9,
        opacity: 0,
        duration: 0.3,
        onComplete: () => {
          updateMealDisplay();
          gsap.to('#mess .meal-card', {
            scale: 1,
            opacity: 1,
            duration: 0.3,
            stagger: 0.1
          });
        }
      });

      showNotification('Jumped to today\'s meals', 'success');
    }

    // ===== ENHANCED BOOKING SYSTEM =====
    let mealBookings = {};

    function bookMeal(mealType) {
      const dateKey = currentDisplayDate.toISOString().split('T')[0];
      const dayName = getDayName(currentDisplayDate);
      const todayMeals = weeklyMealPlan[dayName];

      if (!todayMeals[mealType]) {
        showNotification(`No ${mealType} menu available for this day`, 'warning');
        return;
      }

      if (!todayMeals[mealType].active && mealType === 'dinner') {
        showNotification('Dinner is currently inactive. Only mess secretary can activate it.', 'warning');
        return;
      }

      // Initialize bookings for this date if not exists
      if (!mealBookings[dateKey]) {
        mealBookings[dateKey] = {};
      }

      // Toggle booking
      mealBookings[dateKey][mealType] = !mealBookings[dateKey][mealType];

      // Update UI
      const mealCard = document.querySelector(`#mess .meal-card:nth-child(${getMealCardIndex(mealType)})`);
      const checkbox = mealCard.querySelector('input[type="checkbox"]');
      const statusSpan = mealCard.querySelector('.meal-stats span');

      if (checkbox) {
        checkbox.checked = mealBookings[dateKey][mealType];
      }

      if (statusSpan) {
        if (mealBookings[dateKey][mealType]) {
          statusSpan.innerHTML = '<i class="fas fa-check-circle"></i> Booked';
          statusSpan.style.color = 'var(--success)';
          showNotification(`${mealType.charAt(0).toUpperCase() + mealType.slice(1)} booked successfully!`, 'success');
        } else {
          statusSpan.innerHTML = '<i class="fas fa-times-circle"></i> Not Booked';
          statusSpan.style.color = 'var(--danger)';
          showNotification(`${mealType.charAt(0).toUpperCase() + mealType.slice(1)} booking cancelled`, 'info');
        }
      }
    }

    function bookAllMeals() {
      const dayName = getDayName(currentDisplayDate);
      const todayMeals = weeklyMealPlan[dayName];

      // Check if dinner is active
      if (!todayMeals.dinner.active) {
        showNotification('Cannot book all meals because dinner is inactive.', 'warning');
        return;
      }

      // Book all meals
      ['breakfast', 'lunch', 'dinner'].forEach(mealType => {
        if (todayMeals[mealType].active) {
          bookMeal(mealType);
        }
      });

      showNotification('All meals booked for this day!', 'success');
    }

    // ===== UPDATED MESS MANAGEMENT =====
    function updateMessManagementModal() {
      const dayName = getDayName(currentDisplayDate);
      const todayMeals = weeklyMealPlan[dayName];
      const mealType = document.getElementById('mealType').value;

      // Populate modal with current meal data
      if (todayMeals && todayMeals[mealType]) {
        document.getElementById('menuItems').value = todayMeals[mealType].items.join(', ');
        document.getElementById('predictedDemand').value = todayMeals[mealType].predictedDemand;
        document.getElementById('demandValue').textContent = todayMeals[mealType].predictedDemand + '%';

        // Set active status
        const activeRadio = document.querySelector(`input[name="mealActive"][value="${todayMeals[mealType].active ? 'active' : 'inactive'}"]`);
        if (activeRadio) {
          activeRadio.checked = true;
        }
      }
    }

    // ===== INITIALIZE ON PAGE LOAD =====
    function initializeMessPage() {
      initializeWeeklyMealPlan();
      updateMealDisplay();

      // Add today button to the UI
      addTodayButton();

      // Update mess management modal to use current day
      const mealTypeSelect = document.getElementById('mealType');
      if (mealTypeSelect) {
        mealTypeSelect.addEventListener('change', updateMessManagementModal);
      }
    }

    function addTodayButton() {
      const buttonContainer = document.querySelector('#mess .hero-buttons');
      if (!buttonContainer) return;

      const todayBtn = document.createElement('button');
      todayBtn.className = 'btn btn-nerist';
      todayBtn.innerHTML = '<i class="fas fa-calendar-day"></i> Today';
      todayBtn.onclick = jumpToToday;

      // Insert after the date display
      const dateContainer = document.querySelector('#mess .btn-outline + span').parentNode;
      dateContainer.parentNode.insertBefore(todayBtn, dateContainer.nextSibling);
    }

    // ===== UPDATE EXISTING FUNCTIONS =====

    // Replace the existing showPreviousDay function
    // Remove old showPreviousDay and showNextDay functions

    // Update the mess initialization
    function initializeMess() {
      initializeMessPage();
      updateMealRatingDisplay();

      // Animate meal cards
      gsap.utils.toArray('.meal-card').forEach((card, index) => {
        gsap.from(card, {
          opacity: 0,
          y: 30,
          duration: 0.6,
          delay: index * 0.1,
          ease: 'power2.out'
        });
      });
    }

    // Update the updateFoodItem function to save to weekly plan
    function updateFoodItem() {
      const mealType = document.getElementById('mealType').value;
      const menuItems = document.getElementById('menuItems').value.split(',').map(item => item.trim());
      const predictedDemand = parseInt(document.getElementById('predictedDemand').value);
      const mealActive = document.querySelector('input[name="mealActive"]:checked').value === 'active';

      const dayName = getDayName(currentDisplayDate);

      // Update weekly meal plan
      if (weeklyMealPlan[dayName]) {
        weeklyMealPlan[dayName][mealType] = {
          items: menuItems,
          predictedDemand: predictedDemand,
          active: mealActive
        };
      }

      // If updating dinner, update its status
      if (mealType === 'dinner') {
        isDinnerActive = mealActive;
        updateDinnerStatus();
      }

      // Update display
      updateMealDisplay();

      showNotification(`${mealType} menu updated successfully`, 'success');
      closeModal('messManageModal');
    }

    // Update the addFoodItem function
    function addFoodItem() {
      const mealType = document.getElementById('mealType').value;
      const menuItems = document.getElementById('menuItems').value.split(',').map(item => item.trim());
      const predictedDemand = parseInt(document.getElementById('predictedDemand').value);
      const mealActive = document.querySelector('input[name="mealActive"]:checked').value === 'active';

      if (!menuItems.length || !menuItems[0]) {
        showNotification('Please enter menu items', 'warning');
        return;
      }

      const dayName = getDayName(currentDisplayDate);

      // Add to weekly meal plan
      if (!weeklyMealPlan[dayName]) {
        weeklyMealPlan[dayName] = {};
      }

      weeklyMealPlan[dayName][mealType] = {
        items: menuItems,
        predictedDemand: predictedDemand,
        active: mealActive
      };

      // If adding dinner, update its status
      if (mealType === 'dinner') {
        isDinnerActive = mealActive;
        updateDinnerStatus();
      }

      // Update display
      updateMealDisplay();

      showNotification(`${mealType} menu added for ${dayName}`, 'success');
      closeModal('messManageModal');
    }

    // Update the deleteFoodItem function
    function deleteFoodItem() {
      const mealType = document.getElementById('mealType').value;
      const dayName = getDayName(currentDisplayDate);

      if (confirm(`Are you sure you want to delete the ${mealType} menu for ${dayName}?`)) {
        if (weeklyMealPlan[dayName] && weeklyMealPlan[dayName][mealType]) {
          delete weeklyMealPlan[dayName][mealType];

          // Update display
          updateMealDisplay();

          showNotification(`${mealType} menu deleted for ${dayName}`, 'success');
        }
      }
      closeModal('messManageModal');
    }

    // Update openMessManageModal to populate with current day's data
    function openMessManageModal() {
      if (currentUserRole !== 'mess') {
        showNotification('Only Mess Secretary can manage mess menu', 'warning');
        return;
      }

      updateMessManagementModal();
      document.getElementById('messManageModal').classList.add('active');
    }

    // ===== ADD WEEK VIEW FUNCTIONALITY =====
    function showWeekView() {
      // Create week view modal
      let weekModal = document.getElementById('weekMealModal');

      if (!weekModal) {
        weekModal = document.createElement('div');
        weekModal.className = 'modal';
        weekModal.id = 'weekMealModal';
        weekModal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 2000; align-items: center; justify-content: center; padding: 20px;';

        weekModal.innerHTML = `
            <div class="modal-content" style="max-width: 900px; max-height: 80vh; overflow-y: auto;">
                <div class="modal-close" onclick="closeModal(\'weekMealModal\')">
                    <i class="fas fa-times"></i>
                </div>
                <h2 class="modal-title">Weekly Meal Plan</h2>
                <div class="modal-body" id="weekMealContent">
                    <!-- Week content will be inserted here -->
                </div>
            </div>
        `;
        document.body.appendChild(weekModal);
      }

      // Populate week view
      const weekContent = document.getElementById('weekMealContent');
      if (weekContent) {
        let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">';

        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

        days.forEach(day => {
          const meals = weeklyMealPlan[day];
          if (meals) {
            html += `
                    <div class="card" style="margin-bottom: 0;">
                        <div class="card-header">
                            <h3 class="card-title">${day}</h3>
                            <i class="fas fa-calendar-day card-icon"></i>
                        </div>
                        <div class="card-body">
                            <div style="margin-bottom: 20px;">
                                <strong>Breakfast:</strong>
                                <p style="color: var(--gray); margin-top: 5px;">${meals.breakfast.items.join(', ')}</p>
                                <small>Demand: ${meals.breakfast.predictedDemand}%</small>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <strong>Lunch:</strong>
                                <p style="color: var(--gray); margin-top: 5px;">${meals.lunch.items.join(', ')}</p>
                                <small>Demand: ${meals.lunch.predictedDemand}%</small>
                            </div>
                            <div>
                                <strong>Dinner:</strong>
                                <p style="color: var(--gray); margin-top: 5px;">${meals.dinner.items.join(', ')}</p>
                                <small>Demand: ${meals.dinner.predictedDemand}% | Status: ${meals.dinner.active ? 'Active' : 'Inactive'}</small>
                            </div>
                        </div>
                    </div>
                `;
          }
        });

        html += '</div>';
        weekContent.innerHTML = html;
      }

      openModal('weekMealModal');
    }

    // Add week view button to the UI
    function addWeekViewButton() {
      const buttonContainer = document.querySelector('#mess .hero-buttons');
      if (!buttonContainer) return;

      const weekBtn = document.createElement('button');
      weekBtn.className = 'btn btn-outline';
      weekBtn.innerHTML = '<i class="fas fa-calendar-week"></i> Week View';
      weekBtn.onclick = showWeekView;
      weekBtn.style.marginLeft = '10px';

      buttonContainer.appendChild(weekBtn);
    }

    // Call this in initializeMessPage
    function initializeMessPage() {
      initializeWeeklyMealPlan();
      updateMealDisplay();

      // Add today button
      addTodayButton();

      // Add week view button
      addWeekViewButton();

      // Update mess management modal
      const mealTypeSelect = document.getElementById('mealType');
      if (mealTypeSelect) {
        mealTypeSelect.addEventListener('change', updateMessManagementModal);
      }
    }

    // ===== RESULTS SYSTEM =====
    let currentSemester = 1;
    let resultsData = {};

    function initializeResults() {
      // Double-check user role
      if (currentUserRole !== 'student') {
        console.log('Access denied: Results section is for students only');
        return;
      }

      loadResultsData();
      populateResultsTable();
      updateGPAStats();
      initializeProgressChart();
      populateSemesterTimeline();
      calculatePerformanceSummary();

      console.log('Results section initialized for student');
    }

    function getPageName(pageId) {
      const pageNames = {
        'home': 'Home',
        'attendance': 'Attendance',
        'results': 'Results', // ADD THIS LINE
        'safety': 'Safety',
        'mess': 'Mess',
        'navigation': 'Navigation',
        'career': 'Career'
      };
      return pageNames[pageId] || pageId;
    }

    function loadResultsData() {
      // Mock results data for all semesters
      resultsData = {
        1: {
          sgpa: 8.2,
          subjects: [
            { code: 'MA101', name: 'Mathematics I', credits: 4, grade: 'A', points: 9 },
            { code: 'PH101', name: 'Physics', credits: 4, grade: 'B+', points: 8 },
            { code: 'CH101', name: 'Chemistry', credits: 3, grade: 'A-', points: 8.5 },
            { code: 'CS101', name: 'Programming Fundamentals', credits: 4, grade: 'A', points: 9 },
            { code: 'EC101', name: 'Basic Electronics', credits: 3, grade: 'B', points: 7 },
            { code: 'WS101', name: 'Workshop Practice', credits: 2, grade: 'A+', points: 10 }
          ]
        },
        2: {
          sgpa: 8.5,
          subjects: [
            { code: 'MA102', name: 'Mathematics II', credits: 4, grade: 'A-', points: 8.5 },
            { code: 'PH102', name: 'Modern Physics', credits: 4, grade: 'A', points: 9 },
            { code: 'CS102', name: 'Data Structures', credits: 4, grade: 'A', points: 9 },
            { code: 'EC102', name: 'Digital Electronics', credits: 3, grade: 'B+', points: 8 },
            { code: 'HS101', name: 'Communication Skills', credits: 2, grade: 'A+', points: 10 },
            { code: 'CS103', name: 'Discrete Mathematics', credits: 3, grade: 'A-', points: 8.5 }
          ]
        },
        3: {
          sgpa: 8.75,
          subjects: [
            { code: 'CS201', name: 'Algorithms', credits: 4, grade: 'A', points: 9 },
            { code: 'CS202', name: 'Computer Organization', credits: 4, grade: 'A-', points: 8.5 },
            { code: 'CS203', name: 'Database Systems', credits: 4, grade: 'A+', points: 10 },
            { code: 'CS204', name: 'Operating Systems', credits: 4, grade: 'A', points: 9 },
            { code: 'MA201', name: 'Probability & Statistics', credits: 3, grade: 'B+', points: 8 },
            { code: 'HS201', name: 'Professional Ethics', credits: 2, grade: 'A', points: 9 }
          ]
        },
        4: {
          sgpa: 8.6,
          subjects: [
            { code: 'CS301', name: 'Computer Networks', credits: 4, grade: 'A-', points: 8.5 },
            { code: 'CS302', name: 'Software Engineering', credits: 4, grade: 'A', points: 9 },
            { code: 'CS303', name: 'Theory of Computation', credits: 4, grade: 'B+', points: 8 },
            { code: 'CS304', name: 'Web Technologies', credits: 4, grade: 'A+', points: 10 },
            { code: 'EC301', name: 'Microprocessors', credits: 3, grade: 'A-', points: 8.5 },
            { code: 'OE301', name: 'Open Elective I', credits: 3, grade: 'A', points: 9 }
          ]
        },
        5: {
          sgpa: 8.9,
          subjects: [
            { code: 'CS401', name: 'Artificial Intelligence', credits: 4, grade: 'A+', points: 10 },
            { code: 'CS402', name: 'Machine Learning', credits: 4, grade: 'A', points: 9 },
            { code: 'CS403', name: 'Compiler Design', credits: 4, grade: 'A-', points: 8.5 },
            { code: 'CS404', name: 'Data Science', credits: 4, grade: 'A+', points: 10 },
            { code: 'OE401', name: 'Open Elective II', credits: 3, grade: 'A', points: 9 },
            { code: 'PR401', name: 'Mini Project', credits: 3, grade: 'A+', points: 10 }
          ]
        },
        6: {
          sgpa: 8.8,
          subjects: [
            { code: 'CS501', name: 'Deep Learning', credits: 4, grade: 'A', points: 9 },
            { code: 'CS502', name: 'Cloud Computing', credits: 4, grade: 'A-', points: 8.5 },
            { code: 'CS503', name: 'Cyber Security', credits: 4, grade: 'A', points: 9 },
            { code: 'CS504', name: 'Big Data Analytics', credits: 4, grade: 'A+', points: 10 },
            { code: 'OE501', name: 'Open Elective III', credits: 3, grade: 'B+', points: 8 },
            { code: 'PR501', name: 'Major Project Phase I', credits: 4, grade: 'A', points: 9 }
          ]
        }
      };

      // Calculate cumulative CGPA
      calculateCumulativeCGPA();
    }

    function calculateCumulativeCGPA() {
      let totalPoints = 0;
      let totalCredits = 0;

      Object.values(resultsData).forEach(semester => {
        const semesterCredits = semester.subjects.reduce((sum, subject) => sum + subject.credits, 0);
        const semesterPoints = semester.subjects.reduce((sum, subject) => sum + (subject.points * subject.credits), 0);

        totalPoints += semesterPoints;
        totalCredits += semesterCredits;
      });

      resultsData.cumulativeCGPA = totalCredits > 0 ? (totalPoints / totalCredits).toFixed(2) : 0;
      resultsData.totalCredits = totalCredits;
    }

    function selectSemester(semester) {
      // Update active button
      document.querySelectorAll('.semester-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      // Update current semester
      currentSemester = semester;

      // Animate transition
      const resultsTable = document.getElementById('resultsTable');
      gsap.to(resultsTable, {
        opacity: 0,
        y: -20,
        duration: 0.3,
        onComplete: () => {
          populateResultsTable();
          updateGPAStats();
          updateProgressChart();

          gsap.to(resultsTable, {
            opacity: 1,
            y: 0,
            duration: 0.3
          });
        }
      });
    }

    function populateResultsTable() {
      const tbody = document.querySelector('#resultsTable tbody');
      const semesterData = resultsData[currentSemester];

      if (!semesterData) return;

      tbody.innerHTML = '';

      semesterData.subjects.forEach((subject, index) => {
        const row = document.createElement('tr');

        // Determine grade class
        let gradeClass = 'grade-a';
        if (subject.grade.includes('B')) gradeClass = 'grade-b';
        else if (subject.grade.includes('C')) gradeClass = 'grade-c';
        else if (subject.grade.includes('D')) gradeClass = 'grade-d';
        else if (subject.grade.includes('F')) gradeClass = 'grade-f';

        // Determine status
        const status = subject.points >= 5 ? 'Pass' : 'Fail';
        const statusClass = subject.points >= 5 ? 'status-present' : 'status-absent';

        row.innerHTML = `
      <td><strong>${subject.code}</strong></td>
      <td>${subject.name}</td>
      <td>${subject.credits}</td>
      <td><span class="grade-badge ${gradeClass}">${subject.grade}</span></td>
      <td>${subject.points}</td>
      <td><span class="status-badge ${statusClass}">${status}</span></td>
    `;

        // Add animation delay
        row.style.animationDelay = `${index * 0.05}s`;

        tbody.appendChild(row);
      });
    }

    function updateGPAStats() {
      const semesterData = resultsData[currentSemester];

      if (!semesterData) return;

      // Update SGPA
      document.getElementById('currentSGPA').textContent = semesterData.sgpa;

      // Update CGPA
      document.getElementById('cumulativeCGPA').textContent = resultsData.cumulativeCGPA;

      // Update credits
      const totalCredits = semesterData.subjects.reduce((sum, subject) => sum + subject.credits, 0);
      document.getElementById('creditsEarned').textContent = resultsData.totalCredits || 128;

      // Update status
      updateStatusIndicators(semesterData.sgpa);
    }

    function updateStatusIndicators(sgpa) {
      const sgpaElement = document.querySelector('.gpa-card:nth-child(1) .gpa-status');
      const cgpaElement = document.querySelector('.gpa-card:nth-child(2) .gpa-status');

      // SGPA status
      if (sgpa >= 9.0) {
        sgpaElement.className = 'gpa-status status-excellent';
        sgpaElement.textContent = 'Excellent';
      } else if (sgpa >= 8.0) {
        sgpaElement.className = 'gpa-status status-good';
        sgpaElement.textContent = 'Very Good';
      } else if (sgpa >= 7.0) {
        sgpaElement.className = 'gpa-status status-average';
        sgpaElement.textContent = 'Good';
      } else {
        sgpaElement.className = 'gpa-status';
        sgpaElement.textContent = 'Needs Improvement';
      }

      // CGPA status
      const cgpa = parseFloat(resultsData.cumulativeCGPA);
      if (cgpa >= 8.5) {
        cgpaElement.className = 'gpa-status status-excellent';
        cgpaElement.textContent = 'Excellent Standing';
      } else if (cgpa >= 8.0) {
        cgpaElement.className = 'gpa-status status-good';
        cgpaElement.textContent = 'Good Standing';
      } else if (cgpa >= 7.0) {
        cgpaElement.className = 'gpa-status status-average';
        cgpaElement.textContent = 'Satisfactory';
      } else {
        cgpaElement.className = 'gpa-status';
        cgpaElement.textContent = 'Academic Warning';
      }
    }

    function initializeProgressChart() {
      const ctx = document.getElementById('progressChart').getContext('2d');

      if (window.progressChartInstance) {
        window.progressChartInstance.destroy();
      }

      const sgpaData = [];
      const semesters = [];

      for (let i = 1; i <= 6; i++) {
        if (resultsData[i]) {
          sgpaData.push(resultsData[i].sgpa);
          semesters.push(`Sem ${i}`);
        }
      }

      window.progressChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: semesters,
          datasets: [{
            label: 'SGPA Trend',
            data: sgpaData,
            borderColor: getComputedStyle(document.documentElement).getPropertyValue('--primary'),
            backgroundColor: 'rgba(99, 102, 241, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--secondary'),
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--light')
              }
            },
            tooltip: {
              backgroundColor: 'rgba(15, 23, 42, 0.9)',
              titleColor: getComputedStyle(document.documentElement).getPropertyValue('--light'),
              bodyColor: getComputedStyle(document.documentElement).getPropertyValue('--gray'),
              borderColor: getComputedStyle(document.documentElement).getPropertyValue('--primary'),
              borderWidth: 1
            }
          },
          scales: {
            x: {
              grid: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--card-border')
              },
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--gray')
              }
            },
            y: {
              min: 6,
              max: 10,
              grid: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--card-border')
              },
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--gray'),
                callback: function (value) {
                  return value.toFixed(1);
                }
              }
            }
          }
        }
      });
    }

    function updateProgressChart() {
      if (window.progressChartInstance) {
        window.progressChartInstance.update();
      }
    }

    function populateSemesterTimeline() {
      const timeline = document.getElementById('semesterTimeline');
      timeline.innerHTML = '';

      // Clear existing progress bar
      const existingFill = document.querySelector('.progress-fill');
      if (existingFill) existingFill.remove();

      // Create progress fill
      const progressFill = document.createElement('div');
      progressFill.className = 'progress-fill';
      timeline.appendChild(progressFill);

      // Calculate percentage completed (assuming 8 semesters total)
      const completedPercentage = (currentSemester / 8) * 100;
      progressFill.style.width = `${completedPercentage}%`;

      // Create timeline points
      for (let i = 1; i <= 8; i++) {
        const point = document.createElement('div');
        point.className = 'timeline-point';

        const circle = document.createElement('div');
        circle.className = 'point-circle';

        if (i <= currentSemester) {
          circle.classList.add('completed');
          circle.innerHTML = '<i class="fas fa-check"></i>';
        } else if (i === currentSemester + 1) {
          circle.classList.add('active');
          circle.textContent = i;
        } else {
          circle.textContent = i;
        }

        const label = document.createElement('div');
        label.className = 'point-label';
        label.textContent = `Sem ${i}`;

        const sgpa = document.createElement('div');
        sgpa.className = 'point-sgpa';

        if (resultsData[i]) {
          sgpa.textContent = resultsData[i].sgpa;
        } else {
          sgpa.textContent = '-';
        }

        point.appendChild(circle);
        point.appendChild(label);
        point.appendChild(sgpa);
        timeline.appendChild(point);
      }
    }

    function downloadTranscript() {
      showNotification('Preparing your transcript for download...', 'info');

      // Simulate download delay
      setTimeout(() => {
        showNotification('Transcript downloaded successfully!', 'success');

        // In a real implementation, this would trigger a file download
        // window.open('/api/transcript/download', '_blank');
      }, 1500);
    }

    function calculatePerformanceSummary() {
      let totalSubjects = 0;
      let gradeA = 0;
      let gradeB = 0;
      let gradeC = 0;

      Object.values(resultsData).forEach(semester => {
        if (semester.subjects) {
          totalSubjects += semester.subjects.length;

          semester.subjects.forEach(subject => {
            if (subject.grade.includes('A')) gradeA++;
            else if (subject.grade.includes('B')) gradeB++;
            else if (subject.grade.includes('C')) gradeC++;
          });
        }
      });

      // Update summary
      document.getElementById('totalSubjects').textContent = totalSubjects;
      document.getElementById('gradeA').textContent = gradeA;
      document.getElementById('gradeB').textContent = gradeB;
      document.getElementById('gradeC').textContent = gradeC;
    }

    // Initialize results when page loads
    document.addEventListener('DOMContentLoaded', function () {
      // Add this to initialize results when results page is active
      if (document.getElementById('results')) {
        initializeResults();
      }
    });

    // Add to the initializePage function
    function initializePage(pageId) {
      switch (pageId) {
        case 'attendance':
          initializeAttendance();
          break;
        case 'navigation':
          populateLocationList();
          initializeCampusMap(); // ADD THIS LINE
          break;
        case 'mess':
          initializeMess();
          break;
        case 'career':
          initializeCareer();
          break;
        case 'results':
          initializeResults();
          break;
      }
    }

    // ===== LEAFLET MAP FUNCTIONS =====

    function initializeCampusMap() {
      // If map is already initialized, just invalidate size
      if (neristMap) {
        neristMap.invalidateSize();
        return;
      }

      // Initialize map with NERIST coordinates
      neristMap = L.map('neristMap').setView([27.1297346, 93.7429324], 17); // NERIST coordinates

      // Add OpenStreetMap tile layer
      // Define base layers with proper configuration
      const openStreetMapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 19,
        minZoom: 14  // This is what limits OpenStreetMap zoom out
      });

      const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: '© Esri, Maxar, Earthstar Geographics',
        maxZoom: 19,
        minZoom: 14  // Add this line to limit satellite view zoom out
      });

      // Add default layer (OpenStreetMap)
      openStreetMapLayer.addTo(neristMap);

      // Add map controls with proper base layers configuration
      const baseLayers = {
        'OpenStreetMap': openStreetMapLayer,
        'Satellite': satelliteLayer
      };

      L.control.layers(baseLayers, null, {
        collapsed: true,
        position: 'topright'
      }).addTo(neristMap);

      // Add scale control
      L.control.scale({
        imperial: false,
        metric: true
      }).addTo(neristMap);

      // Add click handler for map
      neristMap.on('click', function (e) {
        showNotification(`Clicked at: ${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)}`, 'info');
      });

      // Fit bounds to show all markers
      if (campusMarkers.length > 0) {
        const group = new L.featureGroup(campusMarkers);
        neristMap.fitBounds(group.getBounds().pad(0.1));
      }

      console.log('NERIST Campus Map initialized');
    }

    function addCampusMarkers() {
      // Clear existing markers
      campusMarkers.forEach(marker => marker.remove());
      campusMarkers = [];

      // NERIST Campus Locations with corrected NERIST (Nirjuli) coordinates
      const campusLocations = [
        {
          name: 'NERIST Main Gate',
          description: 'Main entrance to NERIST campus',
          coords: [27.1038, 93.7269],
          type: 'entrance',
          icon: 'fas fa-gate',
          color: '#4f46e5'
        },
        {
          name: 'Administration Block',
          description: 'Main administrative building',
          coords: [27.1049, 93.7272],
          type: 'admin',
          icon: 'fas fa-landmark',
          color: '#10b981'
        },
        {
          name: 'Computer Science Department',
          description: 'Department of Computer Science & Engineering',
          coords: [27.1054, 93.7278],
          type: 'academic',
          icon: 'fas fa-laptop-code',
          color: '#6366f1'
        },
        {
          name: 'Central Library',
          description: 'NERIST Central Library',
          coords: [27.1042, 93.7285],
          type: 'library',
          icon: 'fas fa-book',
          color: '#8b5cf6'
        },
        {
          name: 'Hostel Block A',
          description: 'Boys Hostel Block A',
          coords: [27.1061, 93.7264],
          type: 'hostel',
          icon: 'fas fa-bed',
          color: '#f59e0b'
        },
        {
          name: 'Hostel Block B',
          description: 'Boys Hostel Block B',
          coords: [27.1065, 93.7269],
          type: 'hostel',
          icon: 'fas fa-bed',
          color: '#f59e0b'
        },
        {
          name: 'Girls Hostel',
          description: 'Girls Hostel Complex',
          coords: [27.1059, 93.7289],
          type: 'hostel',
          icon: 'fas fa-female',
          color: '#ec4899'
        },
        {
          name: 'Academic Block',
          description: 'Main Academic Building',
          coords: [27.1048, 93.7260],
          type: 'academic',
          icon: 'fas fa-school',
          color: '#06b6d4'
        },
        {
          name: 'Cafeteria',
          description: 'Main Campus Cafeteria',
          coords: [27.1039, 93.7261],
          type: 'food',
          icon: 'fas fa-utensils',
          color: '#ef4444'
        },
        {
          name: 'Sports Complex',
          description: 'NERIST Sports Complex',
          coords: [27.1070, 93.7288],
          type: 'sports',
          icon: 'fas fa-running',
          color: '#22d3ee'
        },
        {
          name: 'Medical Center',
          description: 'Campus Medical Center',
          coords: [27.1041, 93.7282],
          type: 'medical',
          icon: 'fas fa-heartbeat',
          color: '#ef4444'
        },
        {
          name: 'Auditorium',
          description: 'NERIST Auditorium',
          coords: [27.1052, 93.7271],
          type: 'auditorium',
          icon: 'fas fa-theater-masks',
          color: '#8b5cf6'
        }
      ];


      // Create custom icon
      const createCustomIcon = (color, iconClass) => {
        return L.divIcon({
          className: 'custom-marker',
          html: `<i class="${iconClass}" style="font-size: 18px;"></i>`,
          iconSize: [40, 40],
          iconAnchor: [20, 40],
          popupAnchor: [0, -40]
        });
      };

      // Add markers to map
      campusLocations.forEach((location, index) => {
        const marker = L.marker(location.coords, {
          icon: createCustomIcon(location.color, location.icon),
          title: location.name
        }).addTo(neristMap);

        // Add popup
        marker.bindPopup(`
      <div style="min-width: 200px;">
        <h3 style="margin: 0 0 8px 0; color: var(--primary);">${location.name}</h3>
        <p style="margin: 0 0 12px 0; color: var(--gray); font-size: 0.9rem;">${location.description}</p>
        <div style="display: flex; gap: 10px; margin-top: 10px;">
          <button onclick="getDirections('${location.name}')" 
            style="background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.85rem;">
            <i class="fas fa-directions"></i> Directions
          </button>
          <button onclick="showLocationDetails(${index})" 
            style="background: var(--card-bg); color: var(--light); border: 1px solid var(--card-border); padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.85rem;">
            <i class="fas fa-info-circle"></i> Details
          </button>
        </div>
      </div>
    `);

        // Add click event
        marker.on('click', function () {
          showNotification(`Selected: ${location.name}`, 'info');
          // Highlight in location list
          highlightLocationInList(location.name);
        });

        campusMarkers.push(marker);
      });

      // Add NERIST boundary polygon
      const neristBoundary = [
        [27.1248, 93.7129], // South-West
        [27.1282, 93.7129], // North-West
        [27.1282, 93.7163], // North-East
        [27.1248, 93.7163]  // South-East
      ];


      L.polygon(neristBoundary, {
        color: 'var(--primary)',
        fillColor: 'rgba(99, 102, 241, 0.1)',
        fillOpacity: 0.3,
        weight: 2,
        dashArray: '5, 5'
      }).addTo(neristMap).bindPopup('NERIST Campus Boundary');
    }

    function hideMapOverlay() {
      const overlay = document.getElementById('mapOverlay');
      if (overlay) {
        gsap.to(overlay, {
          opacity: 0,
          duration: 0.5,
          onComplete: () => {
            overlay.style.display = 'none';
            isMapOverlayVisible = false;

            // Refresh map size
            if (neristMap) {
              setTimeout(() => {
                neristMap.invalidateSize();
              }, 300);
            }
          }
        });
      }
    }

    function showMapOverlay() {
      const overlay = document.getElementById('mapOverlay');
      if (overlay) {
        overlay.style.display = 'flex';
        gsap.fromTo(overlay,
          { opacity: 0 },
          { opacity: 1, duration: 0.5 }
        );
        isMapOverlayVisible = true;
      }
    }

    function centerMapToUser() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const userLatLng = [position.coords.latitude, position.coords.longitude];

            // Remove previous user marker
            if (userLocationMarker) {
              userLocationMarker.remove();
            }

            // Add new user marker
            userLocationMarker = L.marker(userLatLng, {
              icon: L.divIcon({
                className: 'user-location-marker',
                html: '<i class="fas fa-user-circle" style="color: #22d3ee; font-size: 32px;"></i>',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
              }),
              title: 'Your Location'
            }).addTo(neristMap);

            userLocationMarker.bindPopup('<strong>Your Current Location</strong><br>Near NERIST Campus');

            // Center map on user
            neristMap.setView(userLatLng, 18);

            // Show notification
            showNotification('Centered map to your location', 'success');

            // Hide overlay if visible
            hideMapOverlay();
          },
          (error) => {
            console.error('Geolocation error:', error);
            showNotification('Could not get your location. Using NERIST coordinates.', 'warning');

            // Fallback to NERIST center
            neristMap.setView([27.1297346, 93.7429324], 17);
            hideMapOverlay();
          }
        );
      } else {
        showNotification('Geolocation not supported by your browser', 'warning');
        neristMap.setView([27.1297346, 93.7429324], 17);
        hideMapOverlay();
      }
    }

    function highlightLocationInList(locationName) {
      // Find and highlight location in the location list
      const locationItems = document.querySelectorAll('.location-item');
      locationItems.forEach(item => {
        const nameElement = item.querySelector('.location-name');
        if (nameElement && nameElement.textContent.includes(locationName)) {
          // Animate highlight
          gsap.to(item, {
            backgroundColor: 'rgba(99, 102, 241, 0.2)',
            borderColor: 'var(--primary)',
            duration: 0.3,
            yoyo: true,
            repeat: 1
          });

          // Scroll into view
          item.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      });
    }

    function showLocationDetails(index) {
      // This function can show detailed modal for location
      const locations = [
        {
          name: 'NERIST Main Gate',
          description: 'Main entrance to NERIST campus with 24/7 security',
          contact: 'Security: +91 98765 43210',
          hours: '24/7 Open',
          facilities: ['Security Check', 'Visitor Registration', 'Parking']
        },
        // Add more location details as needed
      ];

      if (locations[index]) {
        const loc = locations[index];
        showNotification(`Details: ${loc.name} - ${loc.description}`, 'info');
      }
    }

    // Update existing getDirections function
    function getDirections(destination) {
      if (neristMap && destination) {
        showNotification(`Getting directions to ${destination}...`, 'info');

        // Find the destination marker
        const destMarker = campusMarkers.find(marker =>
          marker.options.title === destination ||
          marker._popup && marker._popup._content.includes(destination)
        );

        if (destMarker) {
          // Center on destination
          neristMap.setView(destMarker.getLatLng(), 19);

          // Open popup
          destMarker.openPopup();

          // Animate marker
          const icon = destMarker.getElement();
          if (icon) {
            gsap.to(icon, {
              scale: 1.3,
              duration: 0.3,
              yoyo: true,
              repeat: 3
            });
          }
        }
      }
    }

    // Update window resize handler for map
    window.addEventListener('resize', debounce(function () {
      if (neristMap && !isMapOverlayVisible) {
        // Small delay to ensure container is resized
        setTimeout(() => {
          neristMap.invalidateSize();
        }, 100);
      }
    }, 250));

    // ===== AI SEARCH SYSTEM =====
    const GEMINI_API_KEY = 'AIzaSyCnacX01UbC2fQeuZjsX-QVsLoLPs0fdEY';
    let isSearching = false;

    function openAISearch() {
      openModal('aiSearchModal');
      // Focus on input when modal opens
      setTimeout(() => {
        document.getElementById('aiSearchInput').focus();
      }, 300);
    }

    async function performAISearch() {
      if (isSearching) return;

      const query = document.getElementById('aiSearchInput').value.trim();
      if (!query) {
        showNotification('Please enter a search query', 'warning');
        return;
      }

      const searchButton = document.getElementById('searchButton');
      const originalText = searchButton.innerHTML;
      searchButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';
      searchButton.disabled = true;
      isSearching = true;

      // Show loading state
      document.getElementById('searchResults').innerHTML = `
    <div class="search-loading">
      <div class="loading-spinner"></div>
      <p>AI is searching across campus...</p>
    </div>
  `;

      try {
        // First, analyze the query locally to find relevant page sections
        const localResults = await analyzeQueryLocally(query);

        // If local results found, show them
        if (localResults.length > 0) {
          displaySearchResults(localResults, query);
        } else {
          // If no local results, use Gemini API for intelligent response
          const geminiResponse = await queryGeminiAPI(query);
          displayGeminiResponse(geminiResponse, query);
        }
      } catch (error) {
        console.error('Search error:', error);
        document.getElementById('searchResults').innerHTML = `
      <div class="no-results">
        <i class="fas fa-exclamation-circle"></i>
        <p>Search failed. Please try again.</p>
        <p style="font-size: 12px; margin-top: 10px;">${error.message}</p>
      </div>
    `;
      } finally {
        searchButton.innerHTML = originalText;
        searchButton.disabled = false;
        isSearching = false;
      }
    }

    async function analyzeQueryLocally(query) {
      const queryLower = query.toLowerCase();
      const results = [];

      // Define searchable content across the site
      const searchableContent = [
        {
          id: 'attendance',
          title: 'Smart Attendance',
          description: 'Track attendance, view statistics, and manage attendance records',
          keywords: ['attendance', 'present', 'absent', 'late', 'class', 'lecture', 'student', 'teacher', 'mark', 'record'],
          page: 'attendance',
          icon: 'fas fa-calendar-check'
        },
        {
          id: 'mess',
          title: 'Hostel & Mess System',
          description: 'View meal menus, book meals, and provide feedback',
          keywords: ['mess', 'food', 'meal', 'breakfast', 'lunch', 'dinner', 'menu', 'hostel', 'dining', 'eat', 'cafeteria'],
          page: 'mess',
          icon: 'fas fa-utensils'
        },
        {
          id: 'navigation',
          title: 'Campus Navigation',
          description: 'Interactive map with directions to campus locations',
          keywords: ['map', 'location', 'where', 'direction', 'find', 'go to', 'navigate', 'campus', 'building', 'room', 'classroom', 'library', 'auditorium'],
          page: 'navigation',
          icon: 'fas fa-map-marked-alt'
        },
        {
          id: 'career',
          title: 'Scholarships & Internships',
          description: 'Career opportunities, internships, and scholarships',
          keywords: ['career', 'job', 'internship', 'scholarship', 'placement', 'opportunity', 'apply', 'application', 'resume', 'cv'],
          page: 'career',
          icon: 'fas fa-briefcase'
        },
        {
          id: 'safety',
          title: 'Campus Safety & SOS',
          description: 'Emergency contacts, SOS button, and safety protocols',
          keywords: ['safety', 'emergency', 'sos', 'help', 'security', 'danger', 'alert', 'medical', 'doctor', 'warden', 'police', 'fire'],
          page: 'safety',
          icon: 'fas fa-shield-alt'
        },
        {
          id: 'home',
          title: 'Dashboard',
          description: 'Main dashboard with schedule, weather, and campus alerts',
          keywords: ['home', 'dashboard', 'schedule', 'weather', 'today', 'classes', 'events', 'alerts', 'announcements'],
          page: 'home',
          icon: 'fas fa-home'
        },
        {
          id: 'results',
          title: 'Academic Results',
          description: 'View semester results, grades, and academic performance',
          keywords: ['results', 'grades', 'marks', 'gpa', 'cgpa', 'semester', 'exam', 'academic', 'performance', 'transcript'],
          page: 'results',
          icon: 'fas fa-chart-line'
        }
      ];

      // Also search in specific locations from navigation
      const locations = [
        { name: 'Library', keywords: ['library', 'books', 'study', 'reading'], page: 'navigation' },
        { name: 'Cafeteria', keywords: ['cafeteria', 'food court', 'eating area', 'restaurant'], page: 'navigation' },
        { name: 'Sports Complex', keywords: ['sports', 'gym', 'playground', 'basketball', 'cricket'], page: 'navigation' },
        { name: 'Medical Center', keywords: ['medical', 'hospital', 'doctor', 'clinic', 'health'], page: 'navigation' },
        { name: 'Auditorium', keywords: ['auditorium', 'hall', 'event', 'function', 'conference'], page: 'navigation' },
        { name: 'Hostel', keywords: ['hostel', 'room', 'dormitory', 'accommodation', 'stay'], page: 'navigation' },
        { name: 'Admin Office', keywords: ['admin', 'office', 'administration', 'principal', 'registrar'], page: 'navigation' }
      ];

      // Check main sections
      for (const section of searchableContent) {
        if (section.keywords.some(keyword => queryLower.includes(keyword))) {
          results.push({
            type: 'section',
            title: section.title,
            description: section.description,
            icon: section.icon,
            page: section.page,
            relevance: calculateRelevance(queryLower, section.keywords)
          });
        }
      }

      // Check specific locations
      for (const location of locations) {
        if (location.keywords.some(keyword => queryLower.includes(keyword))) {
          results.push({
            type: 'location',
            title: location.name,
            description: `Find ${location.name.toLowerCase()} on campus map`,
            icon: 'fas fa-map-marker-alt',
            page: location.page,
            relevance: calculateRelevance(queryLower, location.keywords)
          });
        }
      }

      // Sort by relevance
      return results.sort((a, b) => b.relevance - a.relevance);
    }

    function calculateRelevance(query, keywords) {
      let score = 0;
      keywords.forEach(keyword => {
        if (query.includes(keyword)) {
          score += 3;
        }
      });
      return score;
    }

    function displaySearchResults(results, query) {
      const container = document.getElementById('searchResults');

      if (results.length === 0) {
        container.innerHTML = `
      <div class="no-results">
        <i class="fas fa-search"></i>
        <p>No direct matches found for "${query}"</p>
        <p style="font-size: 14px; margin-top: 15px;">Try searching for:</p>
        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; justify-content: center;">
          <span style="background: var(--card-bg); padding: 8px 15px; border-radius: 20px; font-size: 13px;">attendance</span>
          <span style="background: var(--card-bg); padding: 8px 15px; border-radius: 20px; font-size: 13px;">mess menu</span>
          <span style="background: var(--card-bg); padding: 8px 15px; border-radius: 20px; font-size: 13px;">library</span>
          <span style="background: var(--card-bg); padding: 8px 15px; border-radius: 20px; font-size: 13px;">emergency</span>
        </div>
      </div>
    `;
        return;
      }

      let html = '<div class="search-results">';

      results.slice(0, 5).forEach((result, index) => {
        html += `
      <div class="search-result-item" onclick="navigateToResult('${result.page}', '${result.title}')">
        <h4><i class="${result.icon}"></i> ${result.title}</h4>
        <p>${result.description}</p>
        <div class="result-meta">
          <span><i class="fas fa-layer-group"></i> ${result.type === 'section' ? 'Page Section' : 'Campus Location'}</span>
          <span><i class="fas fa-star"></i> ${result.relevance}/10 match</span>
          <span><i class="fas fa-external-link-alt"></i> Click to navigate</span>
        </div>
      </div>
    `;
      });

      html += '</div>';
      container.innerHTML = html;
    }

    async function queryGeminiAPI(query) {
      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: `You are NERIST One Campus Assistant. A student is asking about: "${query}"
            
            Available campus sections:
            1. Attendance - Track attendance records
            2. Mess - View meal menus and book meals
            3. Navigation - Campus map and directions
            4. Career - Internships and scholarships
            5. Safety - Emergency contacts and SOS
            6. Home - Dashboard with schedule
            7. Results - Academic results (students only)
            
            Respond with:
            - If it's about a specific campus location/section, direct them there
            - If it's a general question, provide helpful answer
            - Keep response under 100 words
            - Be friendly and helpful
            - End with suggestion to click relevant section
            
            User query: "${query}"`
              }]
            }]
          })
        });

        const data = await response.json();

        if (data.candidates && data.candidates[0].content.parts[0].text) {
          return data.candidates[0].content.parts[0].text;
        } else {
          throw new Error('No response from AI');
        }
      } catch (error) {
        console.error('Gemini API error:', error);
        return `I can help you find things on campus. Try asking about specific sections like:
    • "Where is the library?"
    • "Show me attendance"
    • "What's for lunch?"
    • "Emergency contacts"
    
    Or navigate using the menu above.`;
      }
    }

    function displayGeminiResponse(response, query) {
      const container = document.getElementById('searchResults');

      // Extract suggested section if mentioned
      let suggestedSection = '';
      if (response.toLowerCase().includes('attendance')) suggestedSection = 'attendance';
      else if (response.toLowerCase().includes('mess') || response.toLowerCase().includes('meal') || response.toLowerCase().includes('food')) suggestedSection = 'mess';
      else if (response.toLowerCase().includes('map') || response.toLowerCase().includes('navigate') || response.toLowerCase().includes('location')) suggestedSection = 'navigation';
      else if (response.toLowerCase().includes('career') || response.toLowerCase().includes('internship') || response.toLowerCase().includes('scholarship')) suggestedSection = 'career';
      else if (response.toLowerCase().includes('safety') || response.toLowerCase().includes('emergency') || response.toLowerCase().includes('sos')) suggestedSection = 'safety';
      else if (response.toLowerCase().includes('result') || response.toLowerCase().includes('grade') || response.toLowerCase().includes('gpa')) suggestedSection = 'results';

      container.innerHTML = `
    <div class="search-results">
      <div class="search-result-item" style="cursor: default;">
        <h4><i class="fas fa-robot"></i> AI Assistant Response</h4>
        <p style="color: var(--light); line-height: 1.6; margin-bottom: 20px;">${response.replace(/\n/g, '<br>')}</p>
        
        ${suggestedSection ? `
          <div style="background: rgba(99, 102, 241, 0.1); padding: 15px; border-radius: 10px; margin-top: 20px; border-left: 4px solid var(--primary);">
            <p style="color: var(--light); margin-bottom: 10px;"><strong>Suggested Action:</strong></p>
            <button onclick="navigateToResult('${suggestedSection}', '${getSectionName(suggestedSection)}')" 
                    style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
                           color: white; 
                           border: none; 
                           padding: 10px 20px; 
                           border-radius: 8px; 
                           cursor: pointer;
                           display: flex;
                           align-items: center;
                           gap: 10px;
                           font-weight: 600;">
              <i class="fas fa-external-link-alt"></i>
              Go to ${getSectionName(suggestedSection)}
            </button>
          </div>
        ` : ''}
      </div>
    </div>
  `;
    }

    function getSectionName(sectionId) {
      const sections = {
        'attendance': 'Attendance',
        'mess': 'Mess System',
        'navigation': 'Campus Navigation',
        'career': 'Career Portal',
        'safety': 'Safety & SOS',
        'home': 'Dashboard',
        'results': 'Academic Results'
      };
      return sections[sectionId] || sectionId;
    }

    function navigateToResult(pageId, title) {
      // Close search modal
      closeModal('aiSearchModal');

      // Navigate to the page
      showPage(pageId);

      // Show notification
      showNotification(`Navigating to ${title}...`, 'success');

      // Clear search input
      document.getElementById('aiSearchInput').value = '';

      // If it's navigation page and looking for a specific location, try to highlight it
      if (pageId === 'navigation') {
        setTimeout(() => {
          const searchTerm = document.getElementById('aiSearchInput').value || title.toLowerCase();
          if (searchTerm) {
            document.getElementById('locationSearch').value = searchTerm;
            searchLocations();
          }
        }, 500);
      }
    }

    // Add keyboard shortcut for search
    document.addEventListener('keydown', function (e) {
      // Ctrl+K or Cmd+K to open search
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        openAISearch();
      }

      // Escape to close search modal
      if (e.key === 'Escape' && document.getElementById('aiSearchModal').classList.contains('active')) {
        closeModal('aiSearchModal');
      }

      // Enter to search when in search input
      if (e.key === 'Enter' && document.activeElement.id === 'aiSearchInput') {
        performAISearch();
      }
    });

    // Initialize search on page load
    document.addEventListener('DOMContentLoaded', function () {
      // Add shortcut hint
      const searchInput = document.getElementById('aiSearchInput');
      if (searchInput) {
        searchInput.placeholder = "Ask anything (Press Ctrl+K)";
      }
    });

// ===== BACKEND ENHANCEMENTS (NON-BREAKING) =====

// 1. Add backend session check on startup
document.addEventListener('DOMContentLoaded', async function() {
  // After your existing initialization, add this check:
  setTimeout(async () => {
    if (window.neristBackend) {
      try {
        const user = await neristBackend.getCurrentUser();
        if (user && !currentUser) {
          console.log('Found backend session:', user.name);
          // Optionally use backend user instead of localStorage
          currentUser = user;
          currentUserRole = user.role;
          updateUserDisplay();
        }
      } catch (e) {
        // Silent fail - use frontend mode
      }
    }
  }, 1000);
});

// 2. Enhanced login (try backend first, fallback to frontend)
window.enhancedLogin = async function() {
  const username = document.getElementById('loginUserId')?.value;
  const password = document.getElementById('loginUserPassword')?.value;
  
  if (!username || !password) return false;
  
  // Try backend first
  if (window.neristBackend) {
    try {
      const backendUser = await neristBackend.login(username, password);
      if (backendUser) {
        console.log('Backend login successful!');
        currentUser = backendUser;
        currentUserRole = backendUser.role;
        updateUserDisplay();
        updateRoleBasedUI();
        document.body.classList.add('logged-in');
        hideLoginPage();
        showNotification(`Welcome back, ${backendUser.name}!`, 'success');
        return true;
      }
    } catch (error) {
      console.log('Backend login failed, using frontend:', error);
    }
  }
  
  // Fallback to your existing frontend login
  performLoginFromPage();
  return true;
};

// 3. Optional: Save attendance data to backend when admin marks it
window.saveAttendanceToBackend = async function(attendanceRecord) {
  if (!window.neristBackend || !currentUser) return;
  
  try {
    // Save to backend for persistence
    await neristBackend.markAttendance(attendanceRecord);
    console.log('Attendance saved to backend');
  } catch (error) {
    console.log('Could not save to backend:', error);
  }
};


  </script>

  <!-- AI Search Button -->
  <button class="ai-search-button" onclick="openAISearch()">
    <i class="fas fa-search"></i>
  </button>

  <!-- AI Search Modal -->
  <div class="modal ai-search-modal" id="aiSearchModal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal('aiSearchModal')">
        <i class="fas fa-times"></i>
      </div>
      <h2 class="modal-title">Gemini Powered Campus Search</h2>
      <p class="section-subtitle" style="margin-bottom: 25px;">Find anything on campus with AI assistance</p>

      <div class="search-input-container">
        <input type="text" id="aiSearchInput"
          placeholder="Ask anything like 'Where is the library?' or 'Find attendance section'...">
        <button onclick="performAISearch()" id="searchButton">
          <i class="fas fa-search"></i>
        </button>
      </div>

      <div id="searchResultsContainer">
        <div id="searchResults"></div>
      </div>
    </div>
  </div>
 

  <!-- Your frontend JavaScript that uses the backend -->
  <script>
    // Wait for backend to initialize
    document.addEventListener('DOMContentLoaded', async function () {
      // The backend is now available as window.neristBackend
      // It auto-initializes when the script loads

      // Add a small delay to ensure full initialization
      setTimeout(async () => {
        const backend = window.neristBackend;

        if (!backend) {
          console.error('Backend system not loaded!');
          return;
        }

        console.log('NERIST Backend ready!');

        // ============================================
        // CONNECT YOUR UI ELEMENTS TO BACKEND FUNCTIONS
        // ============================================

        // Example: Login Function
        window.performLogin = async function () {
          const username = document.getElementById('username').value;
          const password = document.getElementById('password').value;

          try {
            const user = await backend.login(username, password);
            alert(`Welcome, ${user.name}!`);
            showDashboard(user);
          } catch (error) {
            alert('Login failed: ' + error.message);
          }
        };

        // Example: Check if user is already logged in
        async function checkExistingSession() {
          const user = await backend.getCurrentUser();
          if (user) {
            showDashboard(user);
          } else {
            showLoginScreen();
          }
        }

        // Example: Load and display attendance
        window.loadAttendance = async function () {
          const currentUser = await backend.getCurrentUser();
          if (!currentUser) return;

          const attendance = await backend.getAttendanceForStudent(currentUser.id);
          displayAttendanceTable(attendance);
        };

        // Example: Get today's mess menu
        window.loadTodaysMessMenu = async function () {
          const today = new Date().toISOString().split('T')[0];
          const menu = await backend.getMessMenu(today);
          displayMessMenu(menu);
        };

        // Initialize the app
        checkExistingSession();

      }, 100); // Short delay for backend initialization
    });

    // Your existing frontend helper functions
    function showDashboard(user) {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      document.getElementById('user-name').textContent = user.name;
    }

    function showLoginScreen() {
      document.getElementById('dashboard').style.display = 'none';
      document.getElementById('login-screen').style.display = 'block';
    }

    // ... rest of your existing frontend functions
  </script>

</body>

</html>
